var Ne=Object.create,q=Object.defineProperty,Ie=Object.getPrototypeOf,De=Object.prototype.hasOwnProperty,Te=Object.getOwnPropertyNames,Se=Object.getOwnPropertyDescriptor;var re=c=>q(c,"__esModule",{value:!0});var Ae=(c,e)=>{for(var t in e)q(c,t,{get:e[t],enumerable:!0})},Ce=(c,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Te(e))!De.call(c,o)&&o!=="default"&&q(c,o,{get:()=>e[o],enumerable:!(t=Se(e,o))||t.enumerable});return c},z=c=>Ce(re(q(c!=null?Ne(Ie(c)):{},"default",c&&c.__esModule&&"default"in c?{get:()=>c.default,enumerable:!0}:{value:c,enumerable:!0})),c);re(exports);Ae(exports,{NotelertPlugin:()=>Z,default:()=>He});var ke=z(require("obsidian"));var B="https://us-central1-notalert-2a44a.cloudfunctions.net",G=`${B}/pluginGeocode`,ie=`${B}/pluginScheduleEmail`;var ne={autoProcess:!1,processOnSave:!1,processOnOpen:!1,debugMode:!1,language:"es",customPatterns:[],excludedFolders:["Templates","Archive","Trash"],debounceDelay:3e3,useDebounce:!1,showConfirmationModal:!1,addVisualIndicators:!1,visualIndicatorIcon:"\u23F0",useNewSyntax:!0,enableDatePicker:!0,savedLocations:[{name:"Casa",latitude:0,longitude:0,radius:100},{name:"Trabajo",latitude:0,longitude:0,radius:100},{name:"Supermercado",latitude:0,longitude:0,radius:200}],geocodingProvider:"google",googleMapsApiKey:"",useFirebaseProxy:!0,firebaseGeocodingUrl:G,mapboxApiKey:"",locationiqApiKey:"",opencageApiKey:"",algoliaApiKey:"",algoliaAppId:"",userEmail:"",userId:"",pluginToken:"",scheduledEmails:[]};var k=z(require("obsidian"));var se=[{code:"es",name:"Spanish",nativeName:"Espa\xF1ol",keywords:["Recordar:","Notificar:","Alerta:","Recordatorio:","Aviso:","Reminder:","Notify:","Alert:"],datePatterns:{today:["hoy"],tomorrow:["ma\xF1ana"],yesterday:["ayer"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"ca",name:"Catalan",nativeName:"Catal\xE0",keywords:["Recordar:","Notificar:","Alerta:","Recordatori:","Av\xEDs:","Reminder:","Notify:","Alert:"],datePatterns:{today:["avui"],tomorrow:["dem\xE0"],yesterday:["ahir"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"en",name:"English",nativeName:"English",keywords:["Remember:","Notify:","Alert:","Reminder:","Notice:","Remind:","Alert:","Warning:"],datePatterns:{today:["today"],tomorrow:["tomorrow"],yesterday:["yesterday"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"fr",name:"French",nativeName:"Fran\xE7ais",keywords:["Rappeler:","Notifier:","Alerte:","Rappel:","Avis:","Reminder:","Notify:","Alert:"],datePatterns:{today:["aujourd'hui","aujourd hui"],tomorrow:["demain"],yesterday:["hier"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"de",name:"German",nativeName:"Deutsch",keywords:["Erinnern:","Benachrichtigen:","Alarm:","Erinnerung:","Hinweis:","Reminder:","Notify:","Alert:"],datePatterns:{today:["heute"],tomorrow:["morgen"],yesterday:["gestern"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"it",name:"Italian",nativeName:"Italiano",keywords:["Ricordare:","Notificare:","Allerta:","Promemoria:","Avviso:","Reminder:","Notify:","Alert:"],datePatterns:{today:["oggi"],tomorrow:["domani"],yesterday:["ieri"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"pt",name:"Portuguese",nativeName:"Portugu\xEAs",keywords:["Lembrar:","Notificar:","Alerta:","Lembrete:","Aviso:","Reminder:","Notify:","Alert:"],datePatterns:{today:["hoje"],tomorrow:["amanh\xE3","amanha"],yesterday:["ontem"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"ru",name:"Russian",nativeName:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",keywords:["\u041D\u0430\u043F\u043E\u043C\u043D\u0438\u0442\u044C:","\u0423\u0432\u0435\u0434\u043E\u043C\u0438\u0442\u044C:","\u0422\u0440\u0435\u0432\u043E\u0433\u0430:","\u041D\u0430\u043F\u043E\u043C\u0438\u043D\u0430\u043D\u0438\u0435:","\u0423\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0435:","Reminder:","Notify:","Alert:"],datePatterns:{today:["\u0441\u0435\u0433\u043E\u0434\u043D\u044F"],tomorrow:["\u0437\u0430\u0432\u0442\u0440\u0430"],yesterday:["\u0432\u0447\u0435\u0440\u0430"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"ja",name:"Japanese",nativeName:"\u65E5\u672C\u8A9E",keywords:["\u899A\u3048\u3066:","\u901A\u77E5:","\u30A2\u30E9\u30FC\u30C8:","\u30EA\u30DE\u30A4\u30F3\u30C0\u30FC:","\u304A\u77E5\u3089\u305B:","Reminder:","Notify:","Alert:"],datePatterns:{today:["\u4ECA\u65E5","\u304D\u3087\u3046"],tomorrow:["\u660E\u65E5","\u3042\u3057\u305F"],yesterday:["\u6628\u65E5","\u304D\u306E\u3046"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"zh",name:"Chinese",nativeName:"\u4E2D\u6587",keywords:["\u8BB0\u4F4F:","\u901A\u77E5:","\u8B66\u62A5:","\u63D0\u9192:","\u6CE8\u610F:","Reminder:","Notify:","Alert:"],datePatterns:{today:["\u4ECA\u5929"],tomorrow:["\u660E\u5929"],yesterday:["\u6628\u5929"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"ar",name:"Arabic",nativeName:"\u0627\u0644\u0639\u0631\u0628\u064A\u0629",keywords:["\u062A\u0630\u0643\u0631:","\u0625\u0634\u0639\u0627\u0631:","\u062A\u0646\u0628\u064A\u0647:","\u062A\u0630\u0643\u064A\u0631:","\u062A\u0646\u0628\u064A\u0647:","Reminder:","Notify:","Alert:"],datePatterns:{today:["\u0627\u0644\u064A\u0648\u0645"],tomorrow:["\u063A\u062F\u0627\u064B","\u063A\u062F\u0627"],yesterday:["\u0623\u0645\u0633"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}}],ce={es:{settings:{title:"Configuraci\xF3n de Notelert",autoProcess:"Procesamiento autom\xE1tico",autoProcessDesc:"Activar el procesamiento autom\xE1tico de patrones",processOnSave:"Procesar al guardar",processOnSaveDesc:"Procesar autom\xE1ticamente cuando se guarda una nota",processOnOpen:"Procesar al abrir",processOnOpenDesc:"Procesar autom\xE1ticamente cuando se abre una nota",debugMode:"Modo debug",debugModeDesc:"Mostrar mensajes de debug en la consola",language:"Idioma",languageDesc:"Seleccionar idioma para detecci\xF3n de patrones",excludedFolders:"Carpetas excluidas",excludedFoldersDesc:"Carpetas que no se procesar\xE1n (separadas por comas)",customPatterns:"Palabras clave personalizadas",customPatternsDesc:"Palabras que activan el procesamiento (separadas por comas)",useDebounce:"Usar retraso inteligente",useDebounceDesc:"Esperar a que termines de escribir antes de procesar (evita notificaciones duplicadas)",debounceDelay:"Tiempo de espera (segundos)",debounceDelayDesc:"Tiempo a esperar despu\xE9s del \xFAltimo cambio antes de procesar",showConfirmationModal:"Mostrar modal de confirmaci\xF3n",showConfirmationModalDesc:"Preguntar antes de crear cada notificaci\xF3n",addVisualIndicators:"A\xF1adir iconos visuales",addVisualIndicatorsDesc:"A\xF1adir iconos a los recordatorios procesados para identificarlos visualmente",visualIndicatorIcon:"Icono visual",visualIndicatorIconDesc:"Icono a a\xF1adir al final de los recordatorios procesados",useNewSyntax:"Usar nuevo sistema",useNewSyntaxDesc:"Usar el nuevo formato :@fecha, hora en lugar del sistema anterior",enableDatePicker:"Activar date picker",enableDatePickerDesc:"Abrir autom\xE1ticamente el selector de fecha al escribir :@",supportedPatterns:"Patrones Soportados",keywords:"Palabras clave",dates:"Fechas:",times:"Horas:",examples:"Ejemplos:"},commands:{processCurrentNote:"Procesar nota actual para Notelert",processAllNotes:"Procesar todas las notas para Notelert",clearProcessedHistory:"Limpiar historial de procesamiento"},notices:{noActiveNote:"No hay ninguna nota abierta para procesar",processedNotes:"Procesadas {count} notas para Notelert",processedNote:"Procesada: {filename} ({count} notificaciones)",clearedHistory:"Historial de procesamiento limpiado",errorCreatingNotification:"Error creando notificaci\xF3n: {title}",defaultTitle:"Recordatorio",desktopConfigRequired:"\u274C Configura tu email y API Key en Settings para usar Notelert en desktop",locationNotSupportedDesktop:"\u274C Las notificaciones de ubicaci\xF3n solo est\xE1n disponibles en m\xF3vil",emailScheduled:"\u2705 Email programado correctamente"},modal:{title:"\xBFCrear notificaci\xF3n en Notelert?",titleLabel:"T\xEDtulo:",dateLabel:"Fecha:",timeLabel:"Hora:",messageLabel:"Mensaje:",confirmButton:"S\xED, crear notificaci\xF3n",cancelButton:"Cancelar"},datePicker:{title:"Seleccionar fecha y hora",dateLabel:"Fecha:",timeLabel:"Hora:",quickActions:"Acciones r\xE1pidas:",today:"Hoy",tomorrow:"Ma\xF1ana",in1Hour:"En 1 hora",in2Hours:"En 2 horas",confirmButton:"Confirmar notificaci\xF3n",cancelButton:"Cancelar",selectDateTime:"Por favor, selecciona una fecha y hora",notificationType:"Tipo de notificaci\xF3n:",timeNotification:"Tiempo",locationNotification:"Ubicaci\xF3n",noSavedLocations:"No hay ubicaciones guardadas. Ve a Settings para a\xF1adir ubicaciones.",selectSavedLocation:"Seleccionar Ubicaci\xF3n Guardada"},locationPicker:{title:"Seleccionar Ubicaci\xF3n",searchPlaceholder:"Buscar direcci\xF3n o lugar...",radius:"Radio (metros):",favorites:"Ubicaciones Favoritas",cancelButton:"Cancelar",confirmButton:"Confirmar",noFavorites:"No hay ubicaciones guardadas",selectButton:"Seleccionar",deleteButton:"Eliminar",saveFavorite:"\u2B50 Guardar",saved:"\u2713 Guardado",searching:"Buscando...",noResults:"No se encontraron resultados",error:"Error al buscar ubicaciones",connectionError:"Error de conexi\xF3n. Verifica tu conexi\xF3n a internet.",rateLimit:"Demasiadas solicitudes. Espera un momento antes de buscar de nuevo.",apiKeyError:"Error: API key no configurada o inv\xE1lida. Verifica la configuraci\xF3n.",selectLocation:"Selecciona una ubicaci\xF3n de los resultados o de tus favoritas",locationSelected:"Ubicaci\xF3n seleccionada",loadingMap:"Cargando mapa..."}},en:{settings:{title:"Notelert Settings",autoProcess:"Automatic processing",autoProcessDesc:"Enable automatic pattern processing",processOnSave:"Process on save",processOnSaveDesc:"Automatically process when saving a note",processOnOpen:"Process on open",processOnOpenDesc:"Automatically process when opening a note",debugMode:"Debug mode",debugModeDesc:"Show debug messages in console",language:"Language",languageDesc:"Select language for pattern detection",excludedFolders:"Excluded folders",excludedFoldersDesc:"Folders that will not be processed (comma separated)",customPatterns:"Custom keywords",customPatternsDesc:"Words that trigger processing (comma separated)",useDebounce:"Use smart delay",useDebounceDesc:"Wait for you to finish typing before processing (prevents duplicate notifications)",debounceDelay:"Wait time (seconds)",debounceDelayDesc:"Time to wait after last change before processing",showConfirmationModal:"Show confirmation modal",showConfirmationModalDesc:"Ask before creating each notification",addVisualIndicators:"Add visual indicators",addVisualIndicatorsDesc:"Add icons to processed reminders to identify them visually",visualIndicatorIcon:"Visual icon",visualIndicatorIconDesc:"Icon to add at the end of processed reminders",useNewSyntax:"Use new system",useNewSyntaxDesc:"Use the new :@date, time format instead of the previous system",enableDatePicker:"Enable date picker",enableDatePickerDesc:"Automatically open date selector when typing :@",supportedPatterns:"Supported Patterns",keywords:"Keywords",dates:"Dates:",times:"Times:",examples:"Examples:"},commands:{processCurrentNote:"Process current note for Notelert",processAllNotes:"Process all notes for Notelert",clearProcessedHistory:"Clear processing history"},notices:{noActiveNote:"No active note to process",processedNotes:"Processed {count} notes for Notelert",processedNote:"Processed: {filename} ({count} notifications)",clearedHistory:"Processing history cleared",errorCreatingNotification:"Error creating notification: {title}",defaultTitle:"Reminder",desktopConfigRequired:"\u274C Configure your email and API Key in Settings to use Notelert on desktop",locationNotSupportedDesktop:"\u274C Location notifications are only available on mobile",emailScheduled:"\u2705 Email scheduled successfully"},modal:{title:"Create notification in Notelert?",titleLabel:"Title:",dateLabel:"Date:",timeLabel:"Time:",messageLabel:"Message:",confirmButton:"Yes, create notification",cancelButton:"Cancel"},datePicker:{title:"Select date and time",dateLabel:"Date:",timeLabel:"Time:",quickActions:"Quick actions:",today:"Today",tomorrow:"Tomorrow",in1Hour:"In 1 hour",in2Hours:"In 2 hours",confirmButton:"Confirm notification",cancelButton:"Cancel",selectDateTime:"Please select a date and time",notificationType:"Notification type:",timeNotification:"Time",locationNotification:"Location",noSavedLocations:"No saved locations. Go to Settings to add locations.",selectSavedLocation:"Select Saved Location"},locationPicker:{title:"Select Location",searchPlaceholder:"Search address or place...",radius:"Radius (meters):",favorites:"Favorite Locations",cancelButton:"Cancel",confirmButton:"Confirm",noFavorites:"No saved locations",selectButton:"Select",deleteButton:"Delete",saveFavorite:"\u2B50 Save",saved:"\u2713 Saved",searching:"Searching...",noResults:"No results found",error:"Error searching locations",connectionError:"Connection error. Check your internet connection.",rateLimit:"Too many requests. Wait a moment before searching again.",apiKeyError:"Error: API key not configured or invalid. Check your settings.",selectLocation:"Select a location from results or your favorites",locationSelected:"Location selected",loadingMap:"Loading map..."}},ca:{settings:{title:"Configuraci\xF3 de Notelert",autoProcess:"Processament autom\xE0tic",autoProcessDesc:"Activar el processament autom\xE0tic de patrons",processOnSave:"Processar en desar",processOnSaveDesc:"Processar autom\xE0ticament quan es desa una nota",processOnOpen:"Processar en obrir",processOnOpenDesc:"Processar autom\xE0ticament quan s'obre una nota",debugMode:"Mode debug",debugModeDesc:"Mostrar missatges de debug a la consola",language:"Idioma",languageDesc:"Seleccionar idioma per a la detecci\xF3 de patrons",excludedFolders:"Carpetes excloses",excludedFoldersDesc:"Carpetes que no es processaran (separades per comes)",customPatterns:"Paraules clau personalitzades",customPatternsDesc:"Paraules que activen el processament (separades per comes)",useDebounce:"Usar retard intel\xB7ligent",useDebounceDesc:"Esperar que acabis d'escriure abans de processar (evita notificacions duplicades)",debounceDelay:"Temps d'espera (segons)",debounceDelayDesc:"Temps a esperar despr\xE9s del darrer canvi abans de processar",showConfirmationModal:"Mostrar modal de confirmaci\xF3",showConfirmationModalDesc:"Preguntar abans de crear cada notificaci\xF3",addVisualIndicators:"Afegir indicadors visuals",addVisualIndicatorsDesc:"Afegir icones als recordatoris processats per identificar-los visualment",visualIndicatorIcon:"Icona visual",visualIndicatorIconDesc:"Icona a afegir al final dels recordatoris processats",useNewSyntax:"Usar nou sistema",useNewSyntaxDesc:"Usar el nou format :@data, hora en lloc del sistema anterior",enableDatePicker:"Activar selector de data",enableDatePickerDesc:"Obrir autom\xE0ticament el selector de data en escriure :@",supportedPatterns:"Patrons Suportats",keywords:"Paraules clau",dates:"Dates:",times:"Hores:",examples:"Exemples:"},commands:{processCurrentNote:"Processar nota actual per a Notelert",processAllNotes:"Processar totes les notes per a Notelert",clearProcessedHistory:"Netejar historial de processament"},notices:{noActiveNote:"No hi ha cap nota oberta per processar",processedNotes:"Processades {count} notes per a Notelert",processedNote:"Processada: {filename} ({count} notificacions)",clearedHistory:"Historial de processament netejat",errorCreatingNotification:"Error creant notificaci\xF3: {title}",defaultTitle:"Recordatori",desktopConfigRequired:"\u274C Configura el teu email i API Key a Settings per usar Notelert a desktop",locationNotSupportedDesktop:"\u274C Les notificacions d'ubicaci\xF3 nom\xE9s estan disponibles a m\xF2bil",emailScheduled:"\u2705 Email programat correctament"},modal:{title:"Crear notificaci\xF3 a Notelert?",titleLabel:"T\xEDtol:",dateLabel:"Data:",timeLabel:"Hora:",messageLabel:"Missatge:",confirmButton:"S\xED, crear notificaci\xF3",cancelButton:"Cancel\xB7lar"},datePicker:{title:"Seleccionar data i hora",dateLabel:"Data:",timeLabel:"Hora:",quickActions:"Accions r\xE0pides:",today:"Avui",tomorrow:"Dem\xE0",in1Hour:"En 1 hora",in2Hours:"En 2 hores",confirmButton:"Confirmar notificaci\xF3",cancelButton:"Cancel\xB7lar",selectDateTime:"Si us plau, selecciona una data i hora",notificationType:"Tipus de notificaci\xF3:",timeNotification:"Temps",locationNotification:"Ubicaci\xF3",noSavedLocations:"No hi ha ubicacions guardades. Ves a Settings per afegir ubicacions.",selectSavedLocation:"Seleccionar Ubicaci\xF3 Guardada"},locationPicker:{title:"Seleccionar Ubicaci\xF3",searchPlaceholder:"Buscar adre\xE7a o lloc...",radius:"Radi (metres):",favorites:"Ubicacions Favorites",cancelButton:"Cancel\xB7lar",confirmButton:"Confirmar",noFavorites:"No hi ha ubicacions guardades",selectButton:"Seleccionar",deleteButton:"Eliminar",saveFavorite:"\u2B50 Guardar",saved:"\u2713 Guardat",searching:"Buscant...",noResults:"No s'han trobat resultats",error:"Error en buscar ubicacions",connectionError:"Error de connexi\xF3. Verifica la teva connexi\xF3 a internet.",rateLimit:"Massa sol\xB7licituds. Espera un moment abans de buscar de nou.",apiKeyError:"Error: API key no configurada o inv\xE0lida. Verifica la configuraci\xF3.",selectLocation:"Selecciona una ubicaci\xF3 dels resultats o de les teves favorites",locationSelected:"Ubicaci\xF3 seleccionada",loadingMap:"Carregant mapa..."}},fr:{settings:{title:"Param\xE8tres Notelert",autoProcess:"Traitement automatique",autoProcessDesc:"Activer le traitement automatique des motifs",processOnSave:"Traiter \xE0 la sauvegarde",processOnSaveDesc:"Traiter automatiquement lors de la sauvegarde d'une note",processOnOpen:"Traiter \xE0 l'ouverture",processOnOpenDesc:"Traiter automatiquement lors de l'ouverture d'une note",debugMode:"Mode debug",debugModeDesc:"Afficher les messages de debug dans la console",language:"Langue",languageDesc:"S\xE9lectionner la langue pour la d\xE9tection de motifs",excludedFolders:"Dossiers exclus",excludedFoldersDesc:"Dossiers qui ne seront pas trait\xE9s (s\xE9par\xE9s par des virgules)",customPatterns:"Mots-cl\xE9s personnalis\xE9s",customPatternsDesc:"Mots qui d\xE9clenchent le traitement (s\xE9par\xE9s par des virgules)",supportedPatterns:"Motifs Support\xE9s",keywords:"Mots-cl\xE9s",dates:"Dates:",times:"Heures:",examples:"Exemples:"},commands:{processCurrentNote:"Traiter la note actuelle pour Notelert",processAllNotes:"Traiter toutes les notes pour Notelert",clearProcessedHistory:"Effacer l'historique de traitement"},notices:{noActiveNote:"Aucune note active \xE0 traiter",processedNotes:"Trait\xE9es {count} notes pour Notelert",processedNote:"Trait\xE9: {filename} ({count} notifications)",clearedHistory:"Historique de traitement effac\xE9",errorCreatingNotification:"Erreur lors de la cr\xE9ation de la notification: {title}",defaultTitle:"Rappel"}},de:{settings:{title:"Notelert Einstellungen",autoProcess:"Automatische Verarbeitung",autoProcessDesc:"Automatische Musterverarbeitung aktivieren",processOnSave:"Beim Speichern verarbeiten",processOnSaveDesc:"Automatisch verarbeiten beim Speichern einer Notiz",processOnOpen:"Beim \xD6ffnen verarbeiten",processOnOpenDesc:"Automatisch verarbeiten beim \xD6ffnen einer Notiz",debugMode:"Debug-Modus",debugModeDesc:"Debug-Nachrichten in der Konsole anzeigen",language:"Sprache",languageDesc:"Sprache f\xFCr Mustererkennung ausw\xE4hlen",excludedFolders:"Ausgeschlossene Ordner",excludedFoldersDesc:"Ordner, die nicht verarbeitet werden (durch Kommas getrennt)",customPatterns:"Benutzerdefinierte Schl\xFCsselw\xF6rter",customPatternsDesc:"W\xF6rter, die die Verarbeitung ausl\xF6sen (durch Kommas getrennt)",supportedPatterns:"Unterst\xFCtzte Muster",keywords:"Schl\xFCsselw\xF6rter",dates:"Daten:",times:"Zeiten:",examples:"Beispiele:"},commands:{processCurrentNote:"Aktuelle Notiz f\xFCr Notelert verarbeiten",processAllNotes:"Alle Notizen f\xFCr Notelert verarbeiten",clearProcessedHistory:"Verarbeitungshistorie l\xF6schen"},notices:{noActiveNote:"Keine aktive Notiz zum Verarbeiten",processedNotes:"Verarbeitet {count} Notizen f\xFCr Notelert",processedNote:"Verarbeitet: {filename} ({count} Benachrichtigungen)",clearedHistory:"Verarbeitungshistorie gel\xF6scht",errorCreatingNotification:"Fehler beim Erstellen der Benachrichtigung: {title}",defaultTitle:"Erinnerung"}},it:{settings:{title:"Impostazioni Notelert",autoProcess:"Elaborazione automatica",autoProcessDesc:"Abilita l'elaborazione automatica dei pattern",processOnSave:"Elabora al salvare",processOnSaveDesc:"Elabora automaticamente quando si salva una nota",processOnOpen:"Elabora all'apertura",processOnOpenDesc:"Elabora automaticamente quando si apre una nota",debugMode:"Modalit\xE0 debug",debugModeDesc:"Mostra i messaggi di debug nella console",language:"Lingua",languageDesc:"Seleziona la lingua per il rilevamento dei pattern",excludedFolders:"Cartelle escluse",excludedFoldersDesc:"Cartelle che non verranno elaborate (separate da virgole)",customPatterns:"Parole chiave personalizzate",customPatternsDesc:"Parole che attivano l'elaborazione (separate da virgole)",supportedPatterns:"Pattern Supportati",keywords:"Parole chiave",dates:"Date:",times:"Orari:",examples:"Esempi:"},commands:{processCurrentNote:"Elabora nota corrente per Notelert",processAllNotes:"Elabora tutte le note per Notelert",clearProcessedHistory:"Cancella cronologia elaborazione"},notices:{noActiveNote:"Nessuna nota attiva da elaborare",processedNotes:"Elaborate {count} note per Notelert",processedNote:"Elaborata: {filename} ({count} notifiche)",clearedHistory:"Cronologia elaborazione cancellata",errorCreatingNotification:"Errore nella creazione della notifica: {title}",defaultTitle:"Promemoria"}},pt:{settings:{title:"Configura\xE7\xF5es Notelert",autoProcess:"Processamento autom\xE1tico",autoProcessDesc:"Ativar processamento autom\xE1tico de padr\xF5es",processOnSave:"Processar ao salvar",processOnSaveDesc:"Processar automaticamente ao salvar uma nota",processOnOpen:"Processar ao abrir",processOnOpenDesc:"Processar automaticamente ao abrir uma nota",debugMode:"Modo debug",debugModeDesc:"Mostrar mensagens de debug no console",language:"Idioma",languageDesc:"Selecionar idioma para detec\xE7\xE3o de padr\xF5es",excludedFolders:"Pastas exclu\xEDdas",excludedFoldersDesc:"Pastas que n\xE3o ser\xE3o processadas (separadas por v\xEDrgulas)",customPatterns:"Palavras-chave personalizadas",customPatternsDesc:"Palavras que ativam o processamento (separadas por v\xEDrgulas)",supportedPatterns:"Padr\xF5es Suportados",keywords:"Palavras-chave",dates:"Datas:",times:"Hor\xE1rios:",examples:"Exemplos:"},commands:{processCurrentNote:"Processar nota atual para Notelert",processAllNotes:"Processar todas as notas para Notelert",clearProcessedHistory:"Limpar hist\xF3rico de processamento"},notices:{noActiveNote:"Nenhuma nota ativa para processar",processedNotes:"Processadas {count} notas para Notelert",processedNote:"Processada: {filename} ({count} notifica\xE7\xF5es)",clearedHistory:"Hist\xF3rico de processamento limpo",errorCreatingNotification:"Erro ao criar notifica\xE7\xE3o: {title}",defaultTitle:"Lembrete"}},ru:{settings:{title:"\u041D\u0430\u0441\u0442\u0440\u043E\u0439\u043A\u0438 Notelert",autoProcess:"\u0410\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0430\u044F \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0430",autoProcessDesc:"\u0412\u043A\u043B\u044E\u0447\u0438\u0442\u044C \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0443\u044E \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0443 \u0448\u0430\u0431\u043B\u043E\u043D\u043E\u0432",processOnSave:"\u041E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0442\u044C \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438",processOnSaveDesc:"\u0410\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438 \u043E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0442\u044C \u043F\u0440\u0438 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0438 \u0437\u0430\u043C\u0435\u0442\u043A\u0438",processOnOpen:"\u041E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0442\u044C \u043F\u0440\u0438 \u043E\u0442\u043A\u0440\u044B\u0442\u0438\u0438",processOnOpenDesc:"\u0410\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438 \u043E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0442\u044C \u043F\u0440\u0438 \u043E\u0442\u043A\u0440\u044B\u0442\u0438\u0438 \u0437\u0430\u043C\u0435\u0442\u043A\u0438",debugMode:"\u0420\u0435\u0436\u0438\u043C \u043E\u0442\u043B\u0430\u0434\u043A\u0438",debugModeDesc:"\u041F\u043E\u043A\u0430\u0437\u044B\u0432\u0430\u0442\u044C \u0441\u043E\u043E\u0431\u0449\u0435\u043D\u0438\u044F \u043E\u0442\u043B\u0430\u0434\u043A\u0438 \u0432 \u043A\u043E\u043D\u0441\u043E\u043B\u0438",language:"\u042F\u0437\u044B\u043A",languageDesc:"\u0412\u044B\u0431\u0440\u0430\u0442\u044C \u044F\u0437\u044B\u043A \u0434\u043B\u044F \u043E\u0431\u043D\u0430\u0440\u0443\u0436\u0435\u043D\u0438\u044F \u0448\u0430\u0431\u043B\u043E\u043D\u043E\u0432",excludedFolders:"\u0418\u0441\u043A\u043B\u044E\u0447\u0435\u043D\u043D\u044B\u0435 \u043F\u0430\u043F\u043A\u0438",excludedFoldersDesc:"\u041F\u0430\u043F\u043A\u0438, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u043D\u0435 \u0431\u0443\u0434\u0443\u0442 \u043E\u0431\u0440\u0430\u0431\u0430\u0442\u044B\u0432\u0430\u0442\u044C\u0441\u044F (\u0440\u0430\u0437\u0434\u0435\u043B\u0435\u043D\u043D\u044B\u0435 \u0437\u0430\u043F\u044F\u0442\u044B\u043C\u0438)",customPatterns:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C\u0441\u043A\u0438\u0435 \u043A\u043B\u044E\u0447\u0435\u0432\u044B\u0435 \u0441\u043B\u043E\u0432\u0430",customPatternsDesc:"\u0421\u043B\u043E\u0432\u0430, \u043A\u043E\u0442\u043E\u0440\u044B\u0435 \u0437\u0430\u043F\u0443\u0441\u043A\u0430\u044E\u0442 \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0443 (\u0440\u0430\u0437\u0434\u0435\u043B\u0435\u043D\u043D\u044B\u0435 \u0437\u0430\u043F\u044F\u0442\u044B\u043C\u0438)",supportedPatterns:"\u041F\u043E\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u043C\u044B\u0435 \u0428\u0430\u0431\u043B\u043E\u043D\u044B",keywords:"\u041A\u043B\u044E\u0447\u0435\u0432\u044B\u0435 \u0441\u043B\u043E\u0432\u0430",dates:"\u0414\u0430\u0442\u044B:",times:"\u0412\u0440\u0435\u043C\u0435\u043D\u0430:",examples:"\u041F\u0440\u0438\u043C\u0435\u0440\u044B:"},commands:{processCurrentNote:"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u0442\u0435\u043A\u0443\u0449\u0443\u044E \u0437\u0430\u043C\u0435\u0442\u043A\u0443 \u0434\u043B\u044F Notelert",processAllNotes:"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u0430\u0442\u044C \u0432\u0441\u0435 \u0437\u0430\u043C\u0435\u0442\u043A\u0438 \u0434\u043B\u044F Notelert",clearProcessedHistory:"\u041E\u0447\u0438\u0441\u0442\u0438\u0442\u044C \u0438\u0441\u0442\u043E\u0440\u0438\u044E \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0438"},notices:{noActiveNote:"\u041D\u0435\u0442 \u0430\u043A\u0442\u0438\u0432\u043D\u043E\u0439 \u0437\u0430\u043C\u0435\u0442\u043A\u0438 \u0434\u043B\u044F \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0438",processedNotes:"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u0430\u043D\u043E {count} \u0437\u0430\u043C\u0435\u0442\u043E\u043A \u0434\u043B\u044F Notelert",processedNote:"\u041E\u0431\u0440\u0430\u0431\u043E\u0442\u0430\u043D\u043E: {filename} ({count} \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u0439)",clearedHistory:"\u0418\u0441\u0442\u043E\u0440\u0438\u044F \u043E\u0431\u0440\u0430\u0431\u043E\u0442\u043A\u0438 \u043E\u0447\u0438\u0449\u0435\u043D\u0430",errorCreatingNotification:"\u041E\u0448\u0438\u0431\u043A\u0430 \u0441\u043E\u0437\u0434\u0430\u043D\u0438\u044F \u0443\u0432\u0435\u0434\u043E\u043C\u043B\u0435\u043D\u0438\u044F: {title}",defaultTitle:"\u041D\u0430\u043F\u043E\u043C\u0438\u043D\u0430\u043D\u0438\u0435"}},ja:{settings:{title:"Notelert\u8A2D\u5B9A",autoProcess:"\u81EA\u52D5\u51E6\u7406",autoProcessDesc:"\u30D1\u30BF\u30FC\u30F3\u306E\u81EA\u52D5\u51E6\u7406\u3092\u6709\u52B9\u306B\u3059\u308B",processOnSave:"\u4FDD\u5B58\u6642\u306B\u51E6\u7406",processOnSaveDesc:"\u30CE\u30FC\u30C8\u3092\u4FDD\u5B58\u3059\u308B\u969B\u306B\u81EA\u52D5\u51E6\u7406\u3059\u308B",processOnOpen:"\u958B\u304F\u6642\u306B\u51E6\u7406",processOnOpenDesc:"\u30CE\u30FC\u30C8\u3092\u958B\u304F\u969B\u306B\u81EA\u52D5\u51E6\u7406\u3059\u308B",debugMode:"\u30C7\u30D0\u30C3\u30B0\u30E2\u30FC\u30C9",debugModeDesc:"\u30B3\u30F3\u30BD\u30FC\u30EB\u306B\u30C7\u30D0\u30C3\u30B0\u30E1\u30C3\u30BB\u30FC\u30B8\u3092\u8868\u793A",language:"\u8A00\u8A9E",languageDesc:"\u30D1\u30BF\u30FC\u30F3\u691C\u51FA\u306E\u8A00\u8A9E\u3092\u9078\u629E",excludedFolders:"\u9664\u5916\u30D5\u30A9\u30EB\u30C0",excludedFoldersDesc:"\u51E6\u7406\u3055\u308C\u306A\u3044\u30D5\u30A9\u30EB\u30C0\uFF08\u30AB\u30F3\u30DE\u533A\u5207\u308A\uFF09",customPatterns:"\u30AB\u30B9\u30BF\u30E0\u30AD\u30FC\u30EF\u30FC\u30C9",customPatternsDesc:"\u51E6\u7406\u3092\u30C8\u30EA\u30AC\u30FC\u3059\u308B\u5358\u8A9E\uFF08\u30AB\u30F3\u30DE\u533A\u5207\u308A\uFF09",supportedPatterns:"\u30B5\u30DD\u30FC\u30C8\u3055\u308C\u308B\u30D1\u30BF\u30FC\u30F3",keywords:"\u30AD\u30FC\u30EF\u30FC\u30C9",dates:"\u65E5\u4ED8:",times:"\u6642\u9593:",examples:"\u4F8B:"},commands:{processCurrentNote:"\u73FE\u5728\u306E\u30CE\u30FC\u30C8\u3092Notelert\u7528\u306B\u51E6\u7406",processAllNotes:"\u3059\u3079\u3066\u306E\u30CE\u30FC\u30C8\u3092Notelert\u7528\u306B\u51E6\u7406",clearProcessedHistory:"\u51E6\u7406\u5C65\u6B74\u3092\u30AF\u30EA\u30A2"},notices:{noActiveNote:"\u51E6\u7406\u3059\u308B\u30A2\u30AF\u30C6\u30A3\u30D6\u306A\u30CE\u30FC\u30C8\u304C\u3042\u308A\u307E\u305B\u3093",processedNotes:"Notelert\u7528\u306B{count}\u500B\u306E\u30CE\u30FC\u30C8\u3092\u51E6\u7406\u3057\u307E\u3057\u305F",processedNote:"\u51E6\u7406\u6E08\u307F: {filename} ({count}\u500B\u306E\u901A\u77E5)",clearedHistory:"\u51E6\u7406\u5C65\u6B74\u3092\u30AF\u30EA\u30A2\u3057\u307E\u3057\u305F",errorCreatingNotification:"\u901A\u77E5\u306E\u4F5C\u6210\u30A8\u30E9\u30FC: {title}",defaultTitle:"\u30EA\u30DE\u30A4\u30F3\u30C0\u30FC"}},zh:{settings:{title:"Notelert\u8BBE\u7F6E",autoProcess:"\u81EA\u52A8\u5904\u7406",autoProcessDesc:"\u542F\u7528\u6A21\u5F0F\u81EA\u52A8\u5904\u7406",processOnSave:"\u4FDD\u5B58\u65F6\u5904\u7406",processOnSaveDesc:"\u4FDD\u5B58\u7B14\u8BB0\u65F6\u81EA\u52A8\u5904\u7406",processOnOpen:"\u6253\u5F00\u65F6\u5904\u7406",processOnOpenDesc:"\u6253\u5F00\u7B14\u8BB0\u65F6\u81EA\u52A8\u5904\u7406",debugMode:"\u8C03\u8BD5\u6A21\u5F0F",debugModeDesc:"\u5728\u63A7\u5236\u53F0\u663E\u793A\u8C03\u8BD5\u6D88\u606F",language:"\u8BED\u8A00",languageDesc:"\u9009\u62E9\u6A21\u5F0F\u68C0\u6D4B\u8BED\u8A00",excludedFolders:"\u6392\u9664\u6587\u4EF6\u5939",excludedFoldersDesc:"\u4E0D\u4F1A\u5904\u7406\u7684\u6587\u4EF6\u5939\uFF08\u9017\u53F7\u5206\u9694\uFF09",customPatterns:"\u81EA\u5B9A\u4E49\u5173\u952E\u8BCD",customPatternsDesc:"\u89E6\u53D1\u5904\u7406\u7684\u5355\u8BCD\uFF08\u9017\u53F7\u5206\u9694\uFF09",supportedPatterns:"\u652F\u6301\u7684\u6A21\u5F0F",keywords:"\u5173\u952E\u8BCD",dates:"\u65E5\u671F:",times:"\u65F6\u95F4:",examples:"\u793A\u4F8B:"},commands:{processCurrentNote:"\u5904\u7406\u5F53\u524D\u7B14\u8BB0\u7528\u4E8ENotelert",processAllNotes:"\u5904\u7406\u6240\u6709\u7B14\u8BB0\u7528\u4E8ENotelert",clearProcessedHistory:"\u6E05\u9664\u5904\u7406\u5386\u53F2"},notices:{noActiveNote:"\u6CA1\u6709\u8981\u5904\u7406\u7684\u6D3B\u8DC3\u7B14\u8BB0",processedNotes:"\u4E3ANotelert\u5904\u7406\u4E86{count}\u4E2A\u7B14\u8BB0",processedNote:"\u5DF2\u5904\u7406: {filename} ({count}\u4E2A\u901A\u77E5)",clearedHistory:"\u5904\u7406\u5386\u53F2\u5DF2\u6E05\u9664",errorCreatingNotification:"\u521B\u5EFA\u901A\u77E5\u9519\u8BEF: {title}",defaultTitle:"\u63D0\u9192"}},ar:{settings:{title:"\u0625\u0639\u062F\u0627\u062F\u0627\u062A Notelert",autoProcess:"\u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629 \u0627\u0644\u062A\u0644\u0642\u0627\u0626\u064A\u0629",autoProcessDesc:"\u062A\u0641\u0639\u064A\u0644 \u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629 \u0627\u0644\u062A\u0644\u0642\u0627\u0626\u064A\u0629 \u0644\u0644\u0623\u0646\u0645\u0627\u0637",processOnSave:"\u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629 \u0639\u0646\u062F \u0627\u0644\u062D\u0641\u0638",processOnSaveDesc:"\u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629 \u0627\u0644\u062A\u0644\u0642\u0627\u0626\u064A\u0629 \u0639\u0646\u062F \u062D\u0641\u0638 \u0645\u0644\u0627\u062D\u0638\u0629",processOnOpen:"\u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629 \u0639\u0646\u062F \u0627\u0644\u0641\u062A\u062D",processOnOpenDesc:"\u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629 \u0627\u0644\u062A\u0644\u0642\u0627\u0626\u064A\u0629 \u0639\u0646\u062F \u0641\u062A\u062D \u0645\u0644\u0627\u062D\u0638\u0629",debugMode:"\u0648\u0636\u0639 \u0627\u0644\u062A\u0635\u062D\u064A\u062D",debugModeDesc:"\u0639\u0631\u0636 \u0631\u0633\u0627\u0626\u0644 \u0627\u0644\u062A\u0635\u062D\u064A\u062D \u0641\u064A \u0648\u062D\u062F\u0629 \u0627\u0644\u062A\u062D\u0643\u0645",language:"\u0627\u0644\u0644\u063A\u0629",languageDesc:"\u0627\u062E\u062A\u064A\u0627\u0631 \u0644\u063A\u0629 \u0627\u0643\u062A\u0634\u0627\u0641 \u0627\u0644\u0623\u0646\u0645\u0627\u0637",excludedFolders:"\u0627\u0644\u0645\u062C\u0644\u062F\u0627\u062A \u0627\u0644\u0645\u0633\u062A\u0628\u0639\u062F\u0629",excludedFoldersDesc:"\u0627\u0644\u0645\u062C\u0644\u062F\u0627\u062A \u0627\u0644\u062A\u064A \u0644\u0646 \u064A\u062A\u0645 \u0645\u0639\u0627\u0644\u062C\u062A\u0647\u0627 (\u0645\u0641\u0635\u0648\u0644\u0629 \u0628\u0641\u0648\u0627\u0635\u0644)",customPatterns:"\u0627\u0644\u0643\u0644\u0645\u0627\u062A \u0627\u0644\u0645\u0641\u062A\u0627\u062D\u064A\u0629 \u0627\u0644\u0645\u062E\u0635\u0635\u0629",customPatternsDesc:"\u0627\u0644\u0643\u0644\u0645\u0627\u062A \u0627\u0644\u062A\u064A \u062A\u0628\u062F\u0623 \u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629 (\u0645\u0641\u0635\u0648\u0644\u0629 \u0628\u0641\u0648\u0627\u0635\u0644)",supportedPatterns:"\u0627\u0644\u0623\u0646\u0645\u0627\u0637 \u0627\u0644\u0645\u062F\u0639\u0648\u0645\u0629",keywords:"\u0627\u0644\u0643\u0644\u0645\u0627\u062A \u0627\u0644\u0645\u0641\u062A\u0627\u062D\u064A\u0629",dates:"\u0627\u0644\u062A\u0648\u0627\u0631\u064A\u062E:",times:"\u0627\u0644\u0623\u0648\u0642\u0627\u062A:",examples:"\u0623\u0645\u062B\u0644\u0629:"},commands:{processCurrentNote:"\u0645\u0639\u0627\u0644\u062C\u0629 \u0627\u0644\u0645\u0644\u0627\u062D\u0638\u0629 \u0627\u0644\u062D\u0627\u0644\u064A\u0629 \u0644\u0640 Notelert",processAllNotes:"\u0645\u0639\u0627\u0644\u062C\u0629 \u062C\u0645\u064A\u0639 \u0627\u0644\u0645\u0644\u0627\u062D\u0638\u0627\u062A \u0644\u0640 Notelert",clearProcessedHistory:"\u0645\u0633\u062D \u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629"},notices:{noActiveNote:"\u0644\u0627 \u062A\u0648\u062C\u062F \u0645\u0644\u0627\u062D\u0638\u0629 \u0646\u0634\u0637\u0629 \u0644\u0644\u0645\u0639\u0627\u0644\u062C\u0629",processedNotes:"\u062A\u0645 \u0645\u0639\u0627\u0644\u062C\u0629 {count} \u0645\u0644\u0627\u062D\u0638\u0629 \u0644\u0640 Notelert",processedNote:"\u062A\u0645 \u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629: {filename} ({count} \u0625\u0634\u0639\u0627\u0631)",clearedHistory:"\u062A\u0645 \u0645\u0633\u062D \u062A\u0627\u0631\u064A\u062E \u0627\u0644\u0645\u0639\u0627\u0644\u062C\u0629",errorCreatingNotification:"\u062E\u0637\u0623 \u0641\u064A \u0625\u0646\u0634\u0627\u0621 \u0627\u0644\u0625\u0634\u0639\u0627\u0631: {title}",defaultTitle:"\u062A\u0630\u0643\u064A\u0631"}}};function d(c,e,t){let r=ce[c]||ce.en,i=e.split("."),a=r;for(let n of i)a=a?.[n];if(typeof a!="string")return e;if(t)for(let[n,s]of Object.entries(t))a=a.replace(`{${n}}`,String(s));return a}var je=`${B}/scheduleEmailReminder`,$e=`${B}/cancelScheduledEmail`,le=25e3;async function de(c,e,t){let o=new AbortController,r=setTimeout(()=>o.abort(),le);try{let i=await fetch($e,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":e},body:JSON.stringify({notificationId:c,userId:t||null}),signal:o.signal,keepalive:!0});if(clearTimeout(r),!i.ok){let a;try{let n=await i.text();a=n?JSON.parse(n):{error:`HTTP ${i.status}`}}catch(n){a={error:`HTTP ${i.status}: ${i.statusText}`}}return i.status===401?{success:!1,error:a.error||a.message||"API Key inv\xE1lida o faltante"}:i.status===404?{success:!1,error:a.error||a.message||"Email programado no encontrado"}:i.status===408||i.status===504?{success:!1,error:"El servidor tard\xF3 demasiado en responder. Intenta de nuevo."}:{success:!1,error:a.error||a.message||`HTTP ${i.status}`}}return{success:!0}}catch(i){return clearTimeout(r),i.name==="AbortError"?{success:!1,error:"Timeout: El servidor no respondi\xF3 en 25 segundos. Puede ser un cold start. Intenta de nuevo."}:i.message?.includes("Failed to fetch")||i.message?.includes("NetworkError")?{success:!1,error:"Error de conexi\xF3n. Verifica tu internet e intenta de nuevo."}:{success:!1,error:i.message||"Error de red al cancelar email"}}}async function ue(c,e,t,o,r,i){let a=new AbortController,n=setTimeout(()=>a.abort(),le);try{let s={to:c,title:e,message:t,scheduledDate:o.toISOString(),notificationId:r,userId:userId||null,userEmail:c};if(!i||i.trim()==="")return{success:!1,error:"Token del plugin requerido. Configura tu token en Settings > Notelert > Plugin Token."};let p=await fetch(ie,{method:"POST",headers:{"Content-Type":"application/json","X-Plugin-Token":i},body:JSON.stringify(s),signal:a.signal,keepalive:!0});if(clearTimeout(n),!p.ok){let u;try{let g=await p.text();u=g?JSON.parse(g):{error:`HTTP ${p.status}`}}catch(g){u={error:`HTTP ${p.status}: ${p.statusText}`}}return p.status===400?{success:!1,error:u.message||u.error||"Datos inv\xE1lidos"}:p.status===403?{success:!1,error:u.message||u.error||"Usuario no es premium o suscripci\xF3n expirada"}:p.status===404?{success:!1,error:u.message||u.error||"Usuario no encontrado. Debes registrarte primero en la app m\xF3vil."}:p.status===429?{success:!1,error:u.message||u.error||"L\xEDmite de emails alcanzado (m\xE1ximo 100)"}:{success:!1,error:u.message||u.error||`HTTP ${p.status}`}}let l;try{let u=await p.text();l=u?JSON.parse(u):{}}catch(u){l={notificationId:r}}return{success:!0,notificationId:l.notificationId||r}}catch(s){return clearTimeout(n),s.name==="AbortError"?{success:!1,error:"Timeout: El servidor no respondi\xF3 en 25 segundos. Puede ser un cold start. Intenta de nuevo."}:s.message?.includes("Failed to fetch")||s.message?.includes("NetworkError")?{success:!1,error:"Error de conexi\xF3n. Verifica tu internet e intenta de nuevo."}:{success:!1,error:s.message||"Error de red al programar email"}}}function pe(){return`obsidian-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}var C=z(require("obsidian"));var ge=class{async search(e,t){let o=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=5&addressdetails=1&extratags=1&accept-language=${t}`,r=await fetch(o,{method:"GET",headers:{"User-Agent":"Notelert-Obsidian-Plugin/1.0",Accept:"application/json","Accept-Language":t},referrerPolicy:"no-referrer"});if(!r.ok)throw new Error(`Nominatim error: ${r.status}`);let i=await r.json();return Array.isArray(i)?i.map(a=>{let n=a.address||{};return{name:n.road||n.city||n.town||n.village||a.display_name?.split(",")[0]||"Ubicaci\xF3n",latitude:parseFloat(a.lat),longitude:parseFloat(a.lon),address:a.display_name||a.name||"",displayName:a.display_name||a.name||"Ubicaci\xF3n sin nombre"}}):[]}},J=class{constructor(e="",t=!0,o="",r,i,a){this.apiKey=e;this.useProxy=t;this.proxyUrl=o;this.userId=r;this.userEmail=i;this.pluginToken=a}async search(e,t){let o,r={};if(this.useProxy&&this.proxyUrl){if(!this.pluginToken||this.pluginToken.trim()==="")throw new Error("Token del plugin requerido para usar geocodificaci\xF3n premium. Configura tu token en Settings.");o=this.proxyUrl,r={method:"POST",headers:{"Content-Type":"application/json","X-Plugin-Token":this.pluginToken},body:JSON.stringify({query:e,language:t})}}else{if(!this.apiKey||this.apiKey.trim()==="")throw new Error("Google Maps API key requerida para llamada directa. Usa el proxy de Firebase en su lugar.");o=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(e)}&key=${this.apiKey}&language=${t}`}let i=await fetch(o,r);if(!i.ok){let n=await i.json().catch(()=>({}));throw new Error(`Google Maps error: ${i.status} ${i.statusText} - ${n.message||""}`)}let a=await i.json();if(this.useProxy&&this.proxyUrl){if(a.status==="ZERO_RESULTS"||a.results&&a.results.length===0)return[];if(a.status!=="OK"&&a.error)throw new Error(`Geocoding API error: ${a.error} - ${a.message||""}`);return(a.results||[]).map(n=>({name:n.name,latitude:n.latitude,longitude:n.longitude,address:n.address,displayName:n.displayName}))}if(a.status==="ZERO_RESULTS")return[];if(a.status!=="OK")throw new Error(`Google Maps API error: ${a.status} - ${a.error_message||"Unknown error"}`);return!a.results||a.results.length===0?[]:a.results.slice(0,5).map(n=>{let s=n.address_components||[];return{name:s.find(l=>l.types.includes("route"))?.long_name||s.find(l=>l.types.includes("locality"))?.long_name||n.formatted_address?.split(",")[0]||"Ubicaci\xF3n",latitude:n.geometry.location.lat,longitude:n.geometry.location.lng,address:n.formatted_address,displayName:n.formatted_address}})}},me=class{constructor(e){this.apiKey=e}async search(e,t){let o=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(e)}.json?access_token=${this.apiKey}&limit=5&language=${t}`,r=await fetch(o);if(!r.ok)throw new Error(`Mapbox error: ${r.status}`);let i=await r.json();return i.features?i.features.slice(0,5).map(a=>{let[n,s]=a.center;return{name:a.text||a.place_name?.split(",")[0]||"Ubicaci\xF3n",latitude:s,longitude:n,address:a.place_name||a.text||"",displayName:a.place_name||a.text||"Ubicaci\xF3n"}}):[]}},fe=class{constructor(e){this.apiKey=e}async search(e,t){let o=`https://us1.locationiq.com/v1/search.php?key=${this.apiKey}&q=${encodeURIComponent(e)}&format=json&limit=5&addressdetails=1&accept-language=${t}`,r=await fetch(o);if(!r.ok)throw new Error(`LocationIQ error: ${r.status}`);let i=await r.json();return Array.isArray(i)?i.map(a=>{let n=a.address||{};return{name:n.road||n.city||n.town||n.village||a.display_name?.split(",")[0]||"Ubicaci\xF3n",latitude:parseFloat(a.lat),longitude:parseFloat(a.lon),address:a.display_name||a.name||"",displayName:a.display_name||a.name||"Ubicaci\xF3n"}}):[]}},he=class{constructor(e){this.apiKey=e}async search(e,t){let o=`https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(e)}&key=${this.apiKey}&limit=5&language=${t}`,r=await fetch(o);if(!r.ok)throw new Error(`OpenCage error: ${r.status}`);let i=await r.json();return i.status.code!==200||!i.results?[]:i.results.slice(0,5).map(a=>{let n=a.components||{};return{name:n.road||n.city||n.town||n.village||a.formatted?.split(",")[0]||"Ubicaci\xF3n",latitude:a.geometry.lat,longitude:a.geometry.lng,address:a.formatted||"",displayName:a.formatted||"Ubicaci\xF3n"}})}},be=class{constructor(e,t){this.apiKey=e;this.appId=t}async search(e,t){let r=await fetch("https://places-dsn.algolia.net/1/places/query",{method:"POST",headers:{"Content-Type":"application/json","X-Algolia-Application-Id":this.appId,"X-Algolia-API-Key":this.apiKey},body:JSON.stringify({query:e,language:t,hitsPerPage:5})});if(!r.ok)throw new Error(`Algolia Places error: ${r.status}`);let i=await r.json();return i.hits?i.hits.map(a=>({name:a.locale_names?.[0]||a.name||a.value||"Ubicaci\xF3n",latitude:a._geoloc?.lat||a.latlng?.lat,longitude:a._geoloc?.lng||a.latlng?.lng,address:a.value||a.name||"",displayName:a.value||a.name||"Ubicaci\xF3n"})):[]}};async function ye(c,e,t,o){let r=e.geocodingProvider||"nominatim";o?.(`Proveedor configurado: ${r}`);let i=[r,"nominatim"].filter((a,n,s)=>s.indexOf(a)===n);o?.(`Proveedores a intentar: ${i.join(", ")}`);for(let a of i)try{let n;switch(a){case"google":let p=e.useFirebaseProxy!==!1,l=e.firebaseGeocodingUrl||G;if(p&&l){if(o?.("Google Maps: Usando proxy Firebase (requiere token del plugin)"),!e.pluginToken||e.pluginToken.trim()===""){o?.("Google Maps: Token del plugin no configurado. Usando Nominatim como fallback.");continue}n=new J("",!0,l,void 0,void 0,e.pluginToken)}else{let P=e.googleMapsApiKey?.trim()||"";if(!P){o?.("Google Maps: API key no configurada y proxy no disponible. Usando Nominatim como fallback.");continue}o?.("Google Maps: Usando API key del usuario (llamada directa)"),n=new J(P,!1)}break;case"mapbox":let u=e.mapboxApiKey;if(!u||u.trim()===""){o?.("Mapbox: API key no configurada");continue}n=new me(u);break;case"locationiq":let g=e.locationiqApiKey;if(!g||g.trim()===""){o?.("LocationIQ: API key no configurada");continue}n=new fe(g);break;case"opencage":let y=e.opencageApiKey;if(!y||y.trim()===""){o?.("OpenCage: API key no configurada");continue}n=new he(y);break;case"algolia":let h=e.algoliaApiKey,f=e.algoliaAppId;if(!h||!f||h.trim()===""||f.trim()===""){o?.("Algolia: API key o App ID no configurados");continue}n=new be(h,f);break;default:n=new ge}o?.(`Buscando con ${a}...`);let s=await n.search(c,t);if(s.length>0)return o?.(`\u2705 Encontrados ${s.length} resultados con ${a}`),s;o?.(`\u26A0\uFE0F ${a} no devolvi\xF3 resultados, intentando siguiente proveedor...`)}catch(n){let s=n?.message||String(n);o?.(`\u274C Error con ${a}: ${s}`);continue}return o?.("\u274C Todos los proveedores fallaron"),[]}var U=class extends C.Modal{constructor(e,t,o,r,i,a,n){super(e);this.selectedLocation=null;this.searchTimeout=null;this.searchResults=[];this.map=null;this.mapMarker=null;this.mapLoaded=!1;this.plugin=t,this.language=o,this.editor=r,this.cursor=i,this.originalText=a,this.onCancel=n}onOpen(){let{contentEl:e}=this;e.empty(),e.setAttribute("style",`
      min-width: 320px; 
      max-width: 700px; 
      width: 90vw;
      max-height: 90vh; 
      overflow: hidden;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      margin: 0 auto;
    `);let t=e.createEl("div",{attr:{style:`
          flex: 1;
          overflow-y: auto;
          overflow-x: hidden;
          padding-right: 5px;
          margin-bottom: 10px;
        `}});t.id="notelert-modal-scroll-container",t.createEl("h2",{text:d(this.language,"locationPicker.title")||"Seleccionar Ubicaci\xF3n",attr:{style:"margin: 0 0 15px 0; font-size: 20px; font-weight: 600;"}}),t.createEl("p",{text:d(this.language,"locationPicker.selectLocation")||"Busca una direcci\xF3n o haz clic en el mapa para seleccionar una ubicaci\xF3n",attr:{style:"color: var(--text-muted); font-size: 13px; margin-bottom: 15px; font-style: italic; line-height: 1.4;"}});let o=t.createEl("div",{attr:{style:`
          margin: 15px 0;
          padding: 15px;
          background: var(--background-secondary);
          border: 2px solid var(--background-modifier-border);
          border-radius: 8px;
          font-size: 12px;
          height: 250px;
          min-height: 250px;
          overflow-y: auto;
          overflow-x: hidden;
          font-family: 'Courier New', monospace;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
          flex-shrink: 0;
        `}});o.id="notelert-debug-container",o.innerHTML=`
      <div style="font-weight: 700; margin-bottom: 12px; color: var(--text-accent); font-size: 14px; border-bottom: 1px solid var(--background-modifier-border); padding-bottom: 8px;">
        \u{1F50D} Debug del Mapa
      </div>
      <div id="map-debug-info" style="color: var(--text-normal); line-height: 1.8; word-wrap: break-word; min-height: 200px;"></div>
    `;let r=t.createEl("div",{cls:"notelert-location-search"});r.setAttribute("style",`
      margin-bottom: 15px; 
      position: relative;
      z-index: 1000;
    `);let i=r.createEl("input",{type:"text",placeholder:d(this.language,"locationPicker.searchPlaceholder")||"Buscar direcci\xF3n...",cls:"notelert-location-input"});i.setAttribute("style",`
      width: 100%; 
      padding: 12px; 
      border: 1px solid var(--background-modifier-border); 
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
      background: var(--background-primary);
      color: var(--text-normal);
    `);let a=r.createEl("div",{cls:"notelert-location-results"});a.setAttribute("style",`
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      right: 0;
      max-height: 200px; 
      overflow-y: auto; 
      border: 1px solid var(--background-modifier-border); 
      border-radius: 6px; 
      display: none;
      background: var(--background-primary);
      z-index: 1001;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    `),a.id="location-results-container";let n=t.createEl("div",{cls:"notelert-map-container"});n.setAttribute("style",`
      width: 100%;
      height: 250px;
      min-height: 200px;
      margin: 15px 0;
      border: 1px solid var(--background-modifier-border);
      border-radius: 6px;
      overflow: hidden;
      background: var(--background-secondary);
      position: relative;
    `),n.id="notelert-map-container";let s=n.createEl("div",{attr:{style:`
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          color: var(--text-muted);
          font-size: 14px;
          z-index: 1000;
          text-align: center;
          padding: 15px;
          background: var(--background-primary);
          border: 2px solid var(--text-error);
          border-radius: 6px;
          max-width: 90%;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        `}});s.id="map-loading",s.innerHTML=`
      <div style="font-weight: 500; margin-bottom: 8px;">${d(this.language,"locationPicker.loadingMap")||"Cargando mapa..."}</div>
    `,this.plugin.settings.debugMode&&e.createEl("button",{text:"\u{1F50D} Debug Mapa",attr:{style:`
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 6px 12px;
            font-size: 11px;
            background: var(--background-secondary);
            border: 1px solid var(--background-modifier-border);
            border-radius: 4px;
            cursor: pointer;
            z-index: 2000;
          `}}).addEventListener("click",()=>{let x=document.getElementById("map-debug-info");x&&(x.style.display=x.style.display==="none"?"block":"none")});let p=t.createEl("div",{cls:"notelert-location-selected"});p.setAttribute("style",`
      margin: 15px 0; 
      padding: 15px; 
      background: var(--background-secondary); 
      border-radius: 6px; 
      display: none; 
      word-wrap: break-word;
      border: 2px solid var(--interactive-accent);
    `),p.id="location-selected-container";let l=t.createEl("div",{cls:"notelert-location-favorites"});l.setAttribute("style","margin: 15px 0;"),l.createEl("div",{attr:{style:`
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 10px;
          cursor: pointer;
        `}}).createEl("h3",{text:d(this.language,"locationPicker.favorites")||"Ubicaciones Favoritas",attr:{style:"font-size: 16px; font-weight: 500; margin: 0;"}});let g=l.createEl("div",{cls:"notelert-location-favorites-list"});g.setAttribute("style",`
      max-height: 150px; 
      overflow-y: auto;
      margin-top: 10px;
    `),this.renderFavorites(g);let y=e.createEl("div",{cls:"notelert-locationpicker-buttons"});y.setAttribute("style",`
      display: flex; 
      gap: 10px; 
      justify-content: flex-end; 
      margin-top: 10px; 
      flex-wrap: wrap;
      flex-shrink: 0;
      padding-top: 10px;
      border-top: 1px solid var(--background-modifier-border);
    `);let h=y.createEl("button",{text:d(this.language,"locationPicker.cancelButton")||"Cancelar",cls:"mod-secondary"});h.setAttribute("style",`
      flex: 1; 
      min-width: 100px; 
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 6px;
    `),h.addEventListener("click",()=>{this.onCancel(),this.close()});let f=y.createEl("button",{text:d(this.language,"locationPicker.confirmButton")||"Confirmar",cls:"mod-cta"});f.id="confirm-location-button",f.setAttribute("disabled","true"),f.setAttribute("style",`
      flex: 1; 
      min-width: 100px; 
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 6px;
      opacity: 0.5;
      cursor: not-allowed;
    `),f.addEventListener("click",()=>{this.selectedLocation&&(this.createNotificationFromLocation(this.selectedLocation.name,this.selectedLocation.latitude,this.selectedLocation.longitude,100),this.close())}),i.addEventListener("input",P=>{let x=P.target.value.trim();if(this.searchTimeout&&clearTimeout(this.searchTimeout),x.length<3){a.style.display="none";let A=i.parentElement;A&&A.style.position!=="relative"&&(A.style.position="relative");return}this.searchTimeout=window.setTimeout(()=>{this.searchLocations(x,a)},500)}),this.loadGoogleMap()}loadGoogleMap(){if(this.addDebugInfo("Iniciando carga de Google Maps..."),window.google&&window.google.maps){this.addDebugInfo("\u2705 Google Maps ya est\xE1 cargado"),this.mapLoaded=!0,setTimeout(()=>this.initMap(),100);return}if(document.querySelector('script[src*="maps.googleapis.com"]')){this.addDebugInfo("\u23F3 Script de Google Maps ya est\xE1 siendo cargado, esperando...");let a=0,n=50,s=setInterval(()=>{a++,window.google&&window.google.maps?(clearInterval(s),this.addDebugInfo("\u2705 Google Maps cargado despu\xE9s de esperar"),this.mapLoaded=!0,setTimeout(()=>this.initMap(),100)):a>=n&&(clearInterval(s),this.addDebugInfo("\u274C Timeout esperando que se cargue el script existente"),this.showMapError("Timeout esperando que se cargue Google Maps","El script estaba carg\xE1ndose pero no se complet\xF3. Intenta recargar la p\xE1gina."))},100);return}let t=`initNotelertMap_${Date.now()}`;this.addDebugInfo(`\u{1F4DD} Creando callback: ${t}`);let o=this.plugin.settings.googleMapsApiKey?.trim()||"";if(!o){this.addDebugInfo("\u26A0\uFE0F API key de Google Maps no configurada"),this.addDebugInfo("\u2139\uFE0F El mapa interactivo no estar\xE1 disponible, pero puedes buscar ubicaciones usando el campo de b\xFAsqueda"),this.showMapError("Mapa no disponible","Para usar el mapa interactivo, configura tu API key de Google Maps en Settings.<br><br>La b\xFAsqueda de ubicaciones seguir\xE1 funcionando usando el proxy de Firebase.");return}let r=document.createElement("script"),i=`https://maps.googleapis.com/maps/api/js?key=${o}&libraries=places&callback=${t}`;r.src=i,r.async=!0,r.defer=!0,this.addDebugInfo(`\u{1F4E1} Cargando script: ${i.substring(0,80)}...`),r.onerror=a=>{this.addDebugInfo("\u274C Error en script.onerror");let n=`
        <strong>Error cargando script:</strong><br>
        URL: ${i.substring(0,100)}...<br>
        API Key: ${o.substring(0,10)}...<br>
        Verifica:<br>
        - Tu conexi\xF3n a internet<br>
        - Que la API key sea v\xE1lida<br>
        - Que la Geocoding API est\xE9 habilitada en Google Cloud
      `;this.showMapError("Error al cargar Google Maps. Verifica tu conexi\xF3n a internet.",n),delete window[t]},window[t]=()=>{this.addDebugInfo("\u2705 Callback ejecutado - Google Maps cargado"),this.mapLoaded=!0,delete window[t],setTimeout(()=>this.initMap(),100)},document.head.appendChild(r),this.addDebugInfo("\u{1F4E6} Script a\xF1adido al DOM"),setTimeout(()=>{if(!this.mapLoaded&&!this.map){this.addDebugInfo("\u23F1\uFE0F Timeout despu\xE9s de 10 segundos");let a=`
          <strong>Timeout cargando el mapa:</strong><br>
          Estado: mapLoaded=${this.mapLoaded}, map=${this.map?"existe":"null"}<br>
          Google disponible: ${window.google?"s\xED":"no"}<br>
          Verifica:<br>
          - Tu conexi\xF3n a internet<br>
          - Que no haya bloqueadores de scripts<br>
          - La consola del navegador para m\xE1s detalles
        `;this.showMapError("Timeout cargando el mapa. Intenta recargar.",a)}},1e4)}showMapError(e,t){let o=document.getElementById("map-loading"),r=document.getElementById("map-debug-info");o&&(o.innerHTML=`
        <div style="color: var(--text-error); font-weight: 500; margin-bottom: 8px;">\u26A0\uFE0F Error</div>
        <div style="color: var(--text-muted); font-size: 12px; margin-bottom: 8px;">${e}</div>
        ${t?`<div id="map-debug-info" style="font-size: 11px; color: var(--text-muted); text-align: left; max-height: 100px; overflow-y: auto; background: var(--background-secondary); padding: 8px; border-radius: 4px; margin-top: 8px;">${t}</div>`:""}
      `),r&&t&&(r.innerHTML=t,r.style.display="block")}addDebugInfo(e){let t=document.getElementById("map-debug-info");if(t){let o=new Date().toLocaleTimeString(),r=t.innerHTML||"",i=e.includes("\u274C")||e.includes("Error")||e.includes("Excepci\xF3n")?"var(--text-error)":e.includes("\u2705")?"var(--text-success)":e.includes("\u26A0\uFE0F")?"var(--text-warning)":"var(--text-normal)",a=e.includes("\u274C")||e.includes("Error")||e.includes("Excepci\xF3n")?"rgba(255, 0, 0, 0.1)":e.includes("\u2705")?"rgba(0, 255, 0, 0.1)":"transparent";t.innerHTML=`${r}<div style="margin: 4px 0; padding: 6px 8px; font-size: 11px; color: ${i}; background: ${a}; border-left: 3px solid ${i}; border-radius: 3px; word-wrap: break-word; white-space: pre-wrap;"><span style="opacity: 0.7;">[${o}]</span> ${e}</div>`;let n=document.getElementById("notelert-debug-container");n&&(n.scrollTop=n.scrollHeight)}this.plugin.log(`[Mapa] ${e}`)}initMap(){try{this.addDebugInfo("\u{1F5FA}\uFE0F Iniciando inicializaci\xF3n del mapa...");let e=document.getElementById("notelert-map-container");if(!e){this.addDebugInfo("\u274C Contenedor del mapa no encontrado"),this.showMapError("Contenedor del mapa no encontrado","El elemento #notelert-map-container no existe en el DOM");return}if(this.addDebugInfo("\u2705 Contenedor encontrado"),!window.google){this.addDebugInfo("\u274C window.google no existe"),this.showMapError("Google Maps no est\xE1 disponible","window.google no est\xE1 definido. El script no se carg\xF3 correctamente.");return}if(!window.google.maps){this.addDebugInfo("\u274C window.google.maps no existe"),this.showMapError("Google Maps API no disponible","window.google.maps no est\xE1 definido. Verifica que el script se carg\xF3 correctamente.");return}this.addDebugInfo("\u2705 Google Maps API disponible");let t=document.getElementById("map-loading");t&&(t.style.display="none",this.addDebugInfo("\u2705 Mensaje de carga ocultado"));let o=this.selectedLocation?{lat:this.selectedLocation.latitude,lng:this.selectedLocation.longitude}:{lat:40.4168,lng:-3.7038};this.addDebugInfo(`\u{1F4CD} Centro: ${o.lat}, ${o.lng}`),this.addDebugInfo("\u{1F528} Creando instancia del mapa...");try{this.map=new window.google.maps.Map(e,{center:o,zoom:13,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,zoomControl:!1,disableDefaultUI:!1,gestureHandling:"cooperative"}),this.addDebugInfo("\u2705 Mapa creado"),setTimeout(()=>{let r=document.getElementById("map-loading");r&&(r.style.display="none",this.addDebugInfo("\u2705 Mensaje de carga ocultado"))},500);try{this.map.addListener("error",r=>{this.addDebugInfo(`\u274C Error en el mapa (listener): ${r?.message||JSON.stringify(r)}`),this.showMapError("Error al cargar el mapa",`Error del mapa: ${r?.message||"Error desconocido"}`)})}catch(r){this.addDebugInfo(`\u26A0\uFE0F No se pudo a\xF1adir listener de errores: ${r}`)}setTimeout(()=>{this.checkMapStatus()},2e3)}catch(r){throw this.addDebugInfo(`\u274C Excepci\xF3n al crear mapa: ${r?.message||r}`),this.addDebugInfo(`Stack: ${r?.stack?.substring(0,200)||"No stack"}`),r}this.map.addListener("click",r=>{let i=r.latLng.lat(),a=r.latLng.lng();this.addDebugInfo(`\u{1F5B1}\uFE0F Click en mapa: ${i}, ${a}`),this.reverseGeocode(i,a)}),this.selectedLocation&&(this.addDebugInfo(`\u{1F4CD} Mostrando ubicaci\xF3n seleccionada: ${this.selectedLocation.name}`),this.updateMapMarker(this.selectedLocation.latitude,this.selectedLocation.longitude)),this.addDebugInfo("\u2705 Mapa inicializado correctamente")}catch(e){let t=e?.message||String(e),o=e?.stack||"No hay stack trace";this.addDebugInfo(`\u274C Excepci\xF3n: ${t}`),this.addDebugInfo(`Stack: ${o.substring(0,300)}`);let r=`
        <strong>Error al inicializar el mapa:</strong><br>
        Mensaje: ${t}<br>
        Stack: ${o.substring(0,200)}...<br>
        Tipo: ${e?.name||"Unknown"}
      `;this.showMapError(`Error: ${t}`,r)}}checkMapStatus(){this.addDebugInfo("\u{1F50D} Verificando estado del mapa...");let e=document.getElementById("notelert-map-container");if(!e){this.addDebugInfo("\u274C Contenedor no encontrado en verificaci\xF3n");return}this.addDebugInfo(`\u{1F4E6} Contenedor encontrado, tama\xF1o: ${e.offsetWidth}x${e.offsetHeight}`);let t=null,o="",r=e.querySelectorAll("div");this.addDebugInfo(`\u{1F50E} Buscando en ${r.length} elementos div...`);for(let a of Array.from(r)){let n=a.innerText||a.textContent||"",s=n.toLowerCase();if(s.includes("no ha cargado")||s.includes("no se ha podido cargar")||s.includes("something went wrong")||s.includes("error")||s.includes("forbidden")||s.includes("unauthorized")||s.includes("api key")){t=a,o=n,this.addDebugInfo(`\u274C Error encontrado: "${n.substring(0,100)}"`);break}}if(!t){let a=e.querySelectorAll('div[style*="error"], div[style*="Error"], div[class*="error"]');a.length>0&&(t=a[0],o=t.innerText||t.textContent||"",this.addDebugInfo(`\u274C Error encontrado por estilo: "${o.substring(0,100)}"`))}let i=e.querySelectorAll("iframe");if(this.addDebugInfo(`\u{1F5BC}\uFE0F Iframes encontrados: ${i.length}`),i.length>0)for(let a of Array.from(i))this.addDebugInfo(`  - Iframe src: ${a.src.substring(0,80)}...`);if(t){this.addDebugInfo(`\u274C Error de Google Maps detectado: ${o}`),this.showMapError("Google Maps no se carg\xF3 correctamente",`
        <strong>Error detectado:</strong><br>
        ${o}<br><br>
        <strong>Posibles causas:</strong><br>
        - API key inv\xE1lida o sin permisos<br>
        - Maps JavaScript API no habilitada (no solo Geocoding)<br>
        - Restricciones de la API key muy estrictas<br>
        - L\xEDmite de uso excedido<br>
        - Problema de conexi\xF3n<br><br>
        <strong>Verifica en Google Cloud Console:</strong><br>
        1. Que "Maps JavaScript API" est\xE9 habilitada<br>
        2. Que la API key tenga permisos para Maps JavaScript API<br>
        3. Que las restricciones de la API key permitan tu uso
      `);return}if(this.map){this.addDebugInfo("\u{1F5FA}\uFE0F Mapa existe, verificando tiles...");let a=e.querySelectorAll('img[src*="maps.googleapis.com"], img[src*="googleapis"], img[src*="gstatic"]');if(this.addDebugInfo(`\u{1F5BC}\uFE0F Tiles encontrados: ${a.length}`),a.length===0){this.addDebugInfo("\u26A0\uFE0F No se detectaron tiles del mapa cargados"),this.addDebugInfo("\u{1F50D} Buscando cualquier imagen en el contenedor...");let n=e.querySelectorAll("img");this.addDebugInfo(`\u{1F4F8} Total im\xE1genes: ${n.length}`);for(let p of Array.from(n))this.addDebugInfo(`  - Imagen src: ${p.src.substring(0,80)}...`);let s=e.innerHTML.substring(0,500);this.addDebugInfo(`\u{1F4C4} Primeros 500 chars del HTML: ${s}`),this.showMapError("El mapa no muestra tiles",'El mapa se cre\xF3 pero no se est\xE1n cargando las im\xE1genes. Verifica tu conexi\xF3n y la API key. Aseg\xFArate de que "Maps JavaScript API" est\xE9 habilitada en Google Cloud.')}else{this.addDebugInfo(`\u2705 Mapa verificado: ${a.length} tiles cargados`);let n=document.getElementById("map-loading");n&&(n.style.display="none")}}else this.addDebugInfo("\u26A0\uFE0F Mapa no est\xE1 definido en verificaci\xF3n");setTimeout(()=>{this.addDebugInfo("\u{1F50D} Verificaci\xF3n adicional despu\xE9s de 3 segundos..."),this.checkMapStatusDelayed()},3e3)}checkMapStatusDelayed(){let e=document.getElementById("notelert-map-container");if(!e)return;let t=e.innerText||e.textContent||"";t.toLowerCase().includes("error")||t.toLowerCase().includes("no ha cargado")||t.toLowerCase().includes("forbidden")?(this.addDebugInfo(`\u274C Error detectado en verificaci\xF3n tard\xEDa: ${t.substring(0,200)}`),this.showMapError("Error detectado en el mapa",t.substring(0,300))):this.addDebugInfo("\u2705 No se detectaron errores en verificaci\xF3n tard\xEDa")}async reverseGeocode(e,t){try{new window.google.maps.Geocoder().geocode({location:{lat:e,lng:t}},(r,i)=>{if(i==="OK"&&r[0]){let a=r[0],n=a.formatted_address,s=a.address_components[0]?.long_name||a.address_components[1]?.long_name||"Ubicaci\xF3n seleccionada";this.selectLocation({name:s,latitude:e,longitude:t,radius:100,address:n}),this.updateMapMarker(e,t)}else this.selectLocation({name:`Ubicaci\xF3n (${e.toFixed(6)}, ${t.toFixed(6)})`,latitude:e,longitude:t,radius:100}),this.updateMapMarker(e,t)})}catch(o){this.plugin.log(`Error en geocodificaci\xF3n inversa: ${o}`),this.selectLocation({name:`Ubicaci\xF3n (${e.toFixed(6)}, ${t.toFixed(6)})`,latitude:e,longitude:t,radius:100}),this.updateMapMarker(e,t)}}updateMapMarker(e,t){!this.map||(this.mapMarker&&this.mapMarker.setMap(null),this.mapMarker=new window.google.maps.Marker({position:{lat:e,lng:t},map:this.map,draggable:!0,animation:window.google.maps.Animation.DROP}),this.mapMarker.addListener("dragend",o=>{let r=o.latLng.lat(),i=o.latLng.lng();this.reverseGeocode(r,i)}),this.map.setCenter({lat:e,lng:t}))}onClose(){let{contentEl:e}=this;e.empty(),this.searchTimeout&&clearTimeout(this.searchTimeout),this.mapMarker&&(this.mapMarker.setMap(null),this.mapMarker=null),this.map=null,this.mapLoaded=!1}async searchLocations(e,t){try{let o=this.plugin.settings.useFirebaseProxy!==!1,r=this.plugin.settings.geocodingProvider||"nominatim";if((r==="google"&&o||r==="google")&&(!this.plugin.settings.pluginToken||this.plugin.settings.pluginToken.trim()==="")){t.style.display="block",t.innerHTML=`
            <div style='padding: 20px; text-align: center;'>
              <div style='color: var(--text-error); margin-bottom: 12px; font-weight: 600;'>
                \u{1F511} Token del plugin requerido
              </div>
              <div style='color: var(--text-muted); font-size: 13px; line-height: 1.6;'>
                Para usar geocodificaci\xF3n premium (Google Maps), necesitas:<br/>
                1. Tener plan Premium activo<br/>
                2. Generar tu token en la app m\xF3vil (Settings > Token del Plugin)<br/>
                3. Pegar el token en Settings > Notelert > Plugin Token<br/><br/>
                <em>Nota: Puedes usar Nominatim (gratis) cambiando el proveedor en Settings.</em>
              </div>
            </div>
          `,new C.Notice("\u{1F511} Token del plugin requerido para geocodificaci\xF3n premium");return}t.style.display="block",t.innerHTML=`<div style='padding: 20px; text-align: center; color: var(--text-muted);'>${d(this.language,"locationPicker.searching")||"Buscando..."}</div>`,this.plugin.log(`Buscando ubicaciones: ${e}`);let i=await ye(e,this.plugin.settings,this.language||"es",a=>this.plugin.log(a));if(this.plugin.log(`Resultados encontrados: ${i.length}`),i.length===0){t.innerHTML=`<div style='padding: 20px; text-align: center; color: var(--text-muted);'>${d(this.language,"locationPicker.noResults")||"No se encontraron resultados"}</div>`;return}t.innerHTML="",i.forEach(a=>{try{let n=t.createEl("div",{cls:"notelert-location-result-item"});n.setAttribute("style","padding: 12px; margin: 5px 0; border: 1px solid var(--background-modifier-border); border-radius: 4px; cursor: pointer; transition: background 0.2s; word-wrap: break-word;"),n.addEventListener("mouseenter",()=>{n.style.background="var(--background-modifier-hover)"}),n.addEventListener("mouseleave",()=>{n.style.background=""}),n.createEl("div",{text:a.name,attr:{style:"font-weight: 500; margin-bottom: 4px;"}}),n.createEl("div",{text:a.displayName.length>80?a.displayName.substring(0,80)+"...":a.displayName,attr:{style:"font-size: 11px; color: var(--text-muted);"}}),n.addEventListener("click",()=>{if(isNaN(a.latitude)||isNaN(a.longitude)){this.plugin.log(`Coordenadas inv\xE1lidas: lat=${a.latitude}, lon=${a.longitude}`),new C.Notice(d(this.language,"locationPicker.error")||"Error: Coordenadas inv\xE1lidas");return}this.selectLocation({name:a.name,latitude:a.latitude,longitude:a.longitude,radius:100,address:a.displayName}),this.map&&this.updateMapMarker(a.latitude,a.longitude)})}catch(n){this.plugin.log(`Error procesando resultado: ${n}`)}})}catch(o){let r=o?.message||String(o);this.plugin.log(`Error buscando ubicaciones: ${r}`),this.plugin.log(`Stack: ${o?.stack||"No stack trace"}`);let i=d(this.language,"locationPicker.error")||"Error al buscar ubicaciones";r.includes("CORS")||r.includes("Failed to fetch")?i=d(this.language,"locationPicker.connectionError")||"Error de conexi\xF3n. Verifica tu conexi\xF3n a internet.":r.includes("429")?i=d(this.language,"locationPicker.rateLimit")||"Demasiadas solicitudes. Espera un momento antes de buscar de nuevo.":r.includes("API key")?i=d(this.language,"locationPicker.apiKeyError")||"Error: API key no configurada o inv\xE1lida. Verifica la configuraci\xF3n.":r&&(i=`${d(this.language,"locationPicker.error")||"Error"}: ${r}`),t.innerHTML=`<div style='padding: 20px; text-align: center; color: var(--text-error);'>${i}</div>`}}selectLocation(e){this.selectedLocation=e;let t=document.getElementById("location-selected-container"),o=document.getElementById("confirm-location-button"),r=document.getElementById("location-results-container");if(t&&o){t.style.display="block";let i=d(this.language,"locationPicker.saveFavorite")||"\u2B50 Guardar";t.innerHTML=`
        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;">
          <div style="flex: 1; min-width: 200px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <span style="font-size: 18px;">\u{1F4CD}</span>
              <strong style="word-wrap: break-word; font-size: 15px;">${e.name}</strong>
            </div>
            <small style="color: var(--text-muted); word-wrap: break-word; display: block; margin-bottom: 4px;">${e.address||""}</small>
            <small style="color: var(--text-muted); font-size: 10px;">Lat: ${e.latitude.toFixed(6)}, Lon: ${e.longitude.toFixed(6)}</small>
          </div>
          <button id="save-favorite-btn" class="mod-secondary" style="padding: 4px 8px; font-size: 12px; white-space: nowrap; flex-shrink: 0;">${i}</button>
        </div>
      `;let a=document.getElementById("save-favorite-btn");a&&a.addEventListener("click",async()=>{await this.saveAsFavorite(e),a.textContent=d(this.language,"locationPicker.saved")||"\u2713 Guardado",a.setAttribute("disabled","true")}),o.removeAttribute("disabled"),o.style.opacity="1",o.style.cursor="pointer"}r&&(r.style.display="none"),this.map&&this.updateMapMarker(e.latitude,e.longitude)}async saveAsFavorite(e){let t={name:e.name,latitude:e.latitude,longitude:e.longitude,radius:e.radius,address:e.address};if(!this.plugin.settings.savedLocations.some(r=>r.name===e.name&&r.latitude===e.latitude&&r.longitude===e.longitude)){this.plugin.settings.savedLocations.push(t),await this.plugin.saveSettings();let r=document.querySelector(".notelert-location-favorites-list");r&&this.renderFavorites(r)}}async deleteFavorite(e){let t=this.plugin.settings.savedLocations.findIndex(o=>o.name===e.name&&o.latitude===e.latitude&&o.longitude===e.longitude);t!==-1&&(this.plugin.settings.savedLocations.splice(t,1),await this.plugin.saveSettings(),this.plugin.log(`Ubicaci\xF3n favorita eliminada: ${e.name}`))}renderFavorites(e){e.innerHTML="";let t=this.plugin.settings.savedLocations||[];t.length===0?e.createEl("p",{text:d(this.language,"locationPicker.noFavorites")||"No hay ubicaciones guardadas",attr:{style:"color: var(--text-muted); font-size: 12px; padding: 10px; text-align: center;"}}):t.forEach((o,r)=>{let i=e.createEl("div",{cls:"notelert-location-favorite-item"});i.setAttribute("style","padding: 10px; margin: 5px 0; border: 1px solid var(--background-modifier-border); border-radius: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; flex-wrap: wrap; gap: 8px;"),i.addEventListener("mouseenter",()=>{i.style.background="var(--background-modifier-hover)"}),i.addEventListener("mouseleave",()=>{i.style.background=""});let a=i.createEl("div");a.setAttribute("style","flex: 1; min-width: 0; margin-right: 10px;"),a.createEl("div",{text:o.name,attr:{style:"font-weight: 500; margin-bottom: 4px; word-wrap: break-word;"}}),o.address&&a.createEl("div",{text:o.address.length>50?o.address.substring(0,50)+"...":o.address,attr:{style:"font-size: 11px; color: var(--text-muted); word-wrap: break-word;"}});let n=i.createEl("div");n.setAttribute("style","display: flex; gap: 6px; flex-shrink: 0;");let s=n.createEl("button",{text:d(this.language,"locationPicker.selectButton")||"Seleccionar",cls:"mod-secondary"});s.setAttribute("style","padding: 4px 12px; font-size: 12px; white-space: nowrap;"),s.addEventListener("click",l=>{l.stopPropagation(),this.selectLocation({name:o.name,latitude:o.latitude,longitude:o.longitude,radius:o.radius,address:o.address}),this.map&&this.updateMapMarker(o.latitude,o.longitude)});let p=n.createEl("button",{text:"\u{1F5D1}\uFE0F",title:d(this.language,"locationPicker.deleteButton")||"Eliminar"});p.setAttribute("style","padding: 4px 8px; font-size: 14px; background: var(--background-modifier-border); border: 1px solid var(--background-modifier-border); border-radius: 4px; cursor: pointer; color: var(--text-error);"),p.addEventListener("click",async l=>{l.stopPropagation(),await this.deleteFavorite(o),this.renderFavorites(e)})})}async createNotificationFromLocation(e,t,o,r){try{let i=`:#${e}`,a=this.editor.getLine(this.cursor.line),n=a.substring(0,this.cursor.ch-2),s=a.substring(this.cursor.ch),p=n+i+s;this.editor.setLine(this.cursor.line,p);let l={line:this.cursor.line,ch:n.length+i.length};this.editor.setCursor(l);let u={text:p.trim(),title:this.extractTitleFromText(p,i),message:p.trim(),date:new Date().toISOString().split("T")[0],time:"00:00",fullMatch:i,startIndex:0,endIndex:p.length,filePath:this.plugin.app.workspace.getActiveFile()?.path,lineNumber:this.cursor.line+1,location:e,latitude:t,longitude:o,radius:r};await this.plugin.createNotificationAndMarkProcessed(u),this.plugin.log(`Notificaci\xF3n de ubicaci\xF3n creada: ${u.title} en ${e}`)}catch(i){this.plugin.log(`Error creando notificaci\xF3n de ubicaci\xF3n: ${i}`),new C.Notice(d(this.language,"notices.errorCreatingNotification",{title:"Recordatorio de ubicaci\xF3n"}))}}extractTitleFromText(e,t){let o=e.replace(t,"").trim();return o=o.replace(/\s+/g," ").trim(),o.length>50&&(o=o.substring(0,47)+"..."),o||"Recordatorio de ubicaci\xF3n"}};var Q=class extends k.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=!k.Platform.isMobile;e.createEl("h2",{text:d(this.plugin.settings.language,"settings.title")});let o=e.createEl("div",{attr:{style:`
          padding: 15px;
          margin-bottom: 20px;
          background: var(--background-secondary);
          border-radius: 8px;
          border-left: 4px solid var(--interactive-accent);
        `}});if(t?(o.createEl("h4",{text:"\u{1F4BB} Modo Desktop",attr:{style:"margin: 0 0 8px 0; font-size: 16px; font-weight: 600;"}}),o.createEl("p",{text:"En desktop, Notelert env\xEDa notificaciones por email. Las notificaciones de ubicaci\xF3n solo est\xE1n disponibles en m\xF3vil.",attr:{style:"margin: 0; color: var(--text-muted); font-size: 13px; line-height: 1.5;"}})):(o.createEl("h4",{text:"\u{1F4F1} Modo M\xF3vil",attr:{style:"margin: 0 0 8px 0; font-size: 16px; font-weight: 600;"}}),o.createEl("p",{text:"En m\xF3vil, Notelert usa la app para enviar notificaciones push y emails. Puedes configurar ubicaciones favoritas para recordatorios basados en ubicaci\xF3n.",attr:{style:"margin: 0; color: var(--text-muted); font-size: 13px; line-height: 1.5;"}})),e.createEl("h3",{text:"Configuraci\xF3n B\xE1sica"}),new k.Setting(e).setName(d(this.plugin.settings.language,"settings.language")).setDesc(d(this.plugin.settings.language,"settings.languageDesc")).addDropdown(r=>{se.forEach(i=>{r.addOption(i.code,`${i.nativeName} (${i.name})`)}),r.setValue(this.plugin.settings.language),r.onChange(async i=>{this.plugin.settings.language=i,await this.plugin.saveSettings(),this.display()})}),new k.Setting(e).setName(d(this.plugin.settings.language,"settings.debugMode")).setDesc(d(this.plugin.settings.language,"settings.debugModeDesc")).addToggle(r=>r.setValue(this.plugin.settings.debugMode).onChange(async i=>{this.plugin.settings.debugMode=i,await this.plugin.saveSettings()})),t){e.createEl("h3",{text:"\u{1F4BB} Configuraci\xF3n Desktop"}),new k.Setting(e).setName("\u{1F511} Token del Plugin").setDesc("Token de autenticaci\xF3n para usar geocodificaci\xF3n y emails premium. Obt\xE9n tu token desde la app m\xF3vil en Settings > Plugin Token.").addText(a=>{a.setPlaceholder("Pega tu token aqu\xED...").setValue(this.plugin.settings.pluginToken||"").inputEl.type="password",a.onChange(async n=>{this.plugin.settings.pluginToken=n.trim(),await this.plugin.saveSettings()})}).addButton(a=>{a.setButtonText("Mostrar/Ocultar").setCta(!1).onClick(()=>{let n=e.querySelector('input[type="password"]');n&&(n.type=n.type==="password"?"text":"password")})}),new k.Setting(e).setName("Email del Usuario (Opcional)").setDesc("Email donde recibir\xE1s las notificaciones. Ya no es necesario si usas token del plugin.").addText(a=>{a.setPlaceholder("usuario@email.com").setValue(this.plugin.settings.userEmail||"").onChange(async n=>{this.plugin.settings.userEmail=n,await this.plugin.saveSettings()})}),e.createEl("h4",{text:"\u{1F4E7} Emails Programados"});let r=e.createEl("p",{text:"Gestiona tus emails programados. Puedes cancelarlos antes de que se env\xEDen.",attr:{style:"color: var(--text-muted); font-size: 13px; margin-bottom: 15px;"}}),i=e.createEl("div",{attr:{style:`
            margin: 15px 0;
            padding: 15px;
            background: var(--background-secondary);
            border-radius: 8px;
            border: 1px solid var(--background-modifier-border);
          `}});this.renderScheduledEmails(i)}if(!t){e.createEl("h3",{text:"\u{1F4F1} Configuraci\xF3n M\xF3vil"}),e.createEl("h4",{text:"\u{1F4CD} Ubicaciones Guardadas"});let r=e.createEl("p",{text:"Gestiona tus ubicaciones favoritas. Estas aparecer\xE1n cuando selecciones 'Ubicaci\xF3n' al crear una notificaci\xF3n.",attr:{style:"color: var(--text-muted); font-size: 13px; margin-bottom: 15px;"}});new k.Setting(e).setName("A\xF1adir Nueva Ubicaci\xF3n").setDesc("Abre el selector de ubicaciones con mapa para a\xF1adir una nueva ubicaci\xF3n").addButton(a=>{a.setButtonText("\u2795 A\xF1adir Ubicaci\xF3n").setCta().onClick(()=>{this.openLocationPicker()})});let i=e.createEl("div",{attr:{style:`
            margin: 15px 0;
            padding: 15px;
            background: var(--background-secondary);
            border-radius: 8px;
            border: 1px solid var(--background-modifier-border);
          `}});this.renderSavedLocations(i)}}renderSavedLocations(e){e.empty();let t=this.plugin.settings.savedLocations||[];if(t.length===0){e.createEl("p",{text:"No hay ubicaciones guardadas. Haz clic en 'A\xF1adir Ubicaci\xF3n' para empezar.",attr:{style:"color: var(--text-muted); text-align: center; padding: 20px;"}});return}t.forEach((o,r)=>{let i=e.createEl("div",{attr:{style:`
            padding: 12px;
            margin: 8px 0;
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            background: var(--background-primary);
          `}}),a=i.createEl("div",{attr:{style:"flex: 1; min-width: 200px;"}});a.createEl("div",{text:o.name,attr:{style:"font-weight: 500; margin-bottom: 4px; font-size: 14px;"}}),o.address&&a.createEl("div",{text:o.address.length>60?o.address.substring(0,60)+"...":o.address,attr:{style:"font-size: 12px; color: var(--text-muted); margin-bottom: 4px; word-wrap: break-word;"}}),a.createEl("div",{text:`\u{1F4CD} ${o.latitude.toFixed(6)}, ${o.longitude.toFixed(6)}`,attr:{style:"font-size: 11px; color: var(--text-muted);"}});let n=i.createEl("div",{attr:{style:"display: flex; gap: 6px; flex-shrink: 0;"}});n.createEl("button",{text:"\u270F\uFE0F Editar",attr:{style:"padding: 6px 12px; font-size: 12px; white-space: nowrap;"}}).addEventListener("click",()=>{this.editLocation(o,r)}),n.createEl("button",{text:"\u{1F5D1}\uFE0F",attr:{style:"padding: 6px 10px; font-size: 14px; color: var(--text-error);"}}).addEventListener("click",async()=>{await this.deleteLocation(r),this.display()})})}renderScheduledEmails(e){e.empty();let t=this.plugin.settings.scheduledEmails||[];if(t.length===0){e.createEl("p",{text:"No hay emails programados. Los emails que programes aparecer\xE1n aqu\xED.",attr:{style:"color: var(--text-muted); text-align: center; padding: 20px;"}});return}[...t].sort((r,i)=>new Date(r.scheduledDate).getTime()-new Date(i.scheduledDate).getTime()).forEach((r,i)=>{let a=e.createEl("div",{attr:{style:`
            padding: 12px;
            margin: 8px 0;
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            background: var(--background-primary);
          `}}),n=a.createEl("div",{attr:{style:"flex: 1; min-width: 200px;"}});n.createEl("div",{text:r.title,attr:{style:"font-weight: 500; margin-bottom: 4px; font-size: 14px;"}}),r.message&&n.createEl("div",{text:r.message.length>60?r.message.substring(0,60)+"...":r.message,attr:{style:"font-size: 12px; color: var(--text-muted); margin-bottom: 4px; word-wrap: break-word;"}});let s=new Date(r.scheduledDate),p=new Date,l=s<p;n.createEl("div",{text:`\u{1F4C5} ${s.toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})} ${l?"(Pasado)":""}`,attr:{style:`font-size: 11px; color: ${l?"var(--text-error)":"var(--text-muted)"};`}});let g=a.createEl("div",{attr:{style:"display: flex; gap: 6px; flex-shrink: 0;"}}).createEl("button",{text:"\u{1F5D1}\uFE0F Cancelar",attr:{style:"padding: 6px 12px; font-size: 12px; white-space: nowrap; color: var(--text-error);",id:`cancel-email-btn-${r.notificationId}`}});g.addEventListener("click",async()=>{let y=t.findIndex(h=>h.notificationId===r.notificationId);await this.cancelScheduledEmail(r,y,g)})})}async cancelScheduledEmail(e,t,o){let r=this.plugin.settings.notelertApiKey;if(!r){new k.Notice("\u274C Para cancelar emails, necesitas configurar una API key en Settings (o esperar a que se env\xEDe autom\xE1ticamente).");return}o&&this.showLoadingState(o);let i=new k.Notice("\u23F3 Cancelando email...",0);try{let a=await de(e.notificationId,r);i.hide(),o&&this.hideLoadingState(o),a.success?(this.plugin.settings.scheduledEmails.splice(t,1),await this.plugin.saveSettings(),this.display(),new k.Notice("\u2705 Email cancelado correctamente")):new k.Notice(`\u274C Error: ${a.error||"Error al cancelar email"}`)}catch(a){i.hide(),o&&this.hideLoadingState(o),new k.Notice(`\u274C Error: ${a instanceof Error?a.message:"Error al cancelar email"}`)}}showLoadingState(e){if(e.__originalText=e.textContent,e.disabled=!0,e.style.opacity="0.6",e.style.cursor="not-allowed",e.innerHTML=`
      <span style="display: inline-block; margin-right: 6px;">
        <svg width="14" height="14" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"/>
          <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" opacity="0.75"/>
        </svg>
      </span>
      Cancelando...
    `,!document.getElementById("notelert-spinner-style")){let t=document.createElement("style");t.id="notelert-spinner-style",t.textContent=`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `,document.head.appendChild(t)}}hideLoadingState(e){let t=e.__originalText||"\u{1F5D1}\uFE0F Cancelar";e.textContent=t,e.disabled=!1,e.style.opacity="1",e.style.cursor="pointer"}openLocationPicker(){new U(this.app,this.plugin,this.plugin.settings.language,async t=>{this.plugin.settings.savedLocations||(this.plugin.settings.savedLocations=[]),this.plugin.settings.savedLocations.push(t),await this.plugin.saveSettings(),this.display()}).open()}editLocation(e,t){new U(this.app,this.plugin,this.plugin.settings.language,async r=>{this.plugin.settings.savedLocations[t]=r,await this.plugin.saveSettings(),this.display()},e).open()}async deleteLocation(e){this.plugin.settings.savedLocations.splice(e,1),await this.plugin.saveSettings()}};var E=z(require("obsidian"));var W=class extends E.Modal{constructor(e,t,o,r,i,a,n){super(e);this.notificationType="time";this.selectedLocation=null;this.plugin=t,this.language=o,this.editor=r,this.cursor=i,this.originalText=a,this.onCancel=n}onOpen(){let{contentEl:e}=this;e.empty();let t=!E.Platform.isMobile;e.setAttribute("style",`
      min-width: ${t?"400px":"300px"}; 
      max-width: ${t?"500px":"600px"}; 
      width: ${t?"auto":"95vw"};
      max-height: ${t?"auto":"90vh"}; 
      overflow: hidden;
      padding: ${t?"25px":"20px"};
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      margin: 0 auto;
    `);let o=e.createEl("div",{attr:{style:`
          flex: 1;
          overflow-y: ${t?"visible":"auto"};
          overflow-x: hidden;
          padding-right: ${t?"0":"5px"};
          margin-bottom: 10px;
        `}});o.createEl("h2",{text:d(this.language,"datePicker.title"),attr:{style:"margin: 0 0 15px 0; font-size: 18px; font-weight: 600;"}});let r=o.createEl("div",{cls:"notelert-datepicker-container"});r.setAttribute("style","margin: 0; width: 100%;"),t&&(this.notificationType="time");let i=r.createEl("div",{cls:"notelert-date-container"});i.setAttribute("style","margin-bottom: 15px;"),i.createEl("label",{text:d(this.language,"datePicker.dateLabel")}).setAttribute("style","display: block; margin-bottom: 5px; font-weight: 500;");let n=i.createEl("input",{type:"date",cls:"notelert-date-input"});n.setAttribute("style","width: 100%; padding: 10px; border: 1px solid var(--background-modifier-border); border-radius: 6px; box-sizing: border-box; font-size: 14px;");let s=r.createEl("div",{cls:"notelert-time-container"});s.setAttribute("style","margin-bottom: 20px;"),s.createEl("label",{text:d(this.language,"datePicker.timeLabel")}).setAttribute("style","display: block; margin-bottom: 10px; font-weight: 500;");let l=s.createEl("div",{attr:{style:`
          display: flex;
          align-items: center;
          justify-content: center;
          gap: ${t?"20px":"15px"};
          padding: ${t?"20px":"15px"};
          background: var(--background-secondary);
          border-radius: 8px;
          border: 1px solid var(--background-modifier-border);
        `}}),u=l.createEl("div",{attr:{style:`
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 8px;
        `}});u.createEl("div",{text:"Horas",attr:{style:"font-size: 11px; color: var(--text-muted); text-transform: uppercase; font-weight: 500; letter-spacing: 0.5px;"}});let g=u.createEl("div",{text:"12",attr:{style:`
          font-size: ${t?"32px":"28px"};
          font-weight: 600;
          color: var(--text-normal);
          min-width: ${t?"60px":"50px"};
          text-align: center;
          padding: ${t?"10px 15px":"8px 12px"};
          background: var(--background-primary);
          border-radius: 6px;
          border: 2px solid var(--interactive-accent);
        `}});g.id="hours-display";let y=u.createEl("div",{attr:{style:`
          display: flex;
          gap: 8px;
          align-items: center;
        `}}),h=y.createEl("button",{text:"\u2212",attr:{style:`
          width: ${t?"36px":"32px"};
          height: ${t?"36px":"32px"};
          border-radius: 6px;
          border: 1px solid var(--background-modifier-border);
          background: var(--background-primary);
          font-size: ${t?"20px":"18px"};
          font-weight: 600;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        `}});h.addEventListener("mouseenter",()=>{h.style.background="var(--background-modifier-hover)",h.style.borderColor="var(--interactive-accent)"}),h.addEventListener("mouseleave",()=>{h.style.background="var(--background-primary)",h.style.borderColor="var(--background-modifier-border)"});let f=y.createEl("button",{text:"+",attr:{style:`
          width: ${t?"36px":"32px"};
          height: ${t?"36px":"32px"};
          border-radius: 6px;
          border: 1px solid var(--background-modifier-border);
          background: var(--background-primary);
          font-size: ${t?"20px":"18px"};
          font-weight: 600;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        `}});f.addEventListener("mouseenter",()=>{f.style.background="var(--background-modifier-hover)",f.style.borderColor="var(--interactive-accent)"}),f.addEventListener("mouseleave",()=>{f.style.background="var(--background-primary)",f.style.borderColor="var(--background-modifier-border)"}),l.createEl("div",{text:":",attr:{style:`
          font-size: ${t?"32px":"28px"};
          font-weight: 600;
          color: var(--text-normal);
          margin: 0 ${t?"10px":"5px"};
        `}});let P=l.createEl("div",{attr:{style:`
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 8px;
        `}});P.createEl("div",{text:"Minutos",attr:{style:"font-size: 11px; color: var(--text-muted); text-transform: uppercase; font-weight: 500; letter-spacing: 0.5px;"}});let x=P.createEl("div",{text:"00",attr:{style:`
          font-size: ${t?"32px":"28px"};
          font-weight: 600;
          color: var(--text-normal);
          min-width: ${t?"60px":"50px"};
          text-align: center;
          padding: ${t?"10px 15px":"8px 12px"};
          background: var(--background-primary);
          border-radius: 6px;
          border: 2px solid var(--interactive-accent);
        `}});x.id="minutes-display";let A=P.createEl("div",{attr:{style:`
          display: flex;
          gap: 8px;
          align-items: center;
        `}}),D=A.createEl("button",{text:"\u2212",attr:{style:`
          width: ${t?"36px":"32px"};
          height: ${t?"36px":"32px"};
          border-radius: 6px;
          border: 1px solid var(--background-modifier-border);
          background: var(--background-primary);
          font-size: ${t?"20px":"18px"};
          font-weight: 600;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        `}});D.addEventListener("mouseenter",()=>{D.style.background="var(--background-modifier-hover)",D.style.borderColor="var(--interactive-accent)"}),D.addEventListener("mouseleave",()=>{D.style.background="var(--background-primary)",D.style.borderColor="var(--background-modifier-border)"});let T=A.createEl("button",{text:"+",attr:{style:`
          width: ${t?"36px":"32px"};
          height: ${t?"36px":"32px"};
          border-radius: 6px;
          border: 1px solid var(--background-modifier-border);
          background: var(--background-primary);
          font-size: ${t?"20px":"18px"};
          font-weight: 600;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        `}});T.addEventListener("mouseenter",()=>{T.style.background="var(--background-modifier-hover)",T.style.borderColor="var(--interactive-accent)"}),T.addEventListener("mouseleave",()=>{T.style.background="var(--background-primary)",T.style.borderColor="var(--background-modifier-border)"});let M=s.createEl("input",{type:"time",cls:"notelert-time-input"});if(M.setAttribute("style","display: none;"),M.id="hidden-time-input",t){let L=s.createEl("div",{attr:{style:`
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 15px;
            justify-content: center;
          `}});[{label:"9:00",hours:9,minutes:0},{label:"12:00",hours:12,minutes:0},{label:"15:00",hours:15,minutes:0},{label:"18:00",hours:18,minutes:0},{label:"21:00",hours:21,minutes:0}].forEach(v=>{let m=L.createEl("button",{text:v.label,attr:{style:`
              padding: 6px 12px;
              font-size: 12px;
              border-radius: 4px;
              border: 1px solid var(--background-modifier-border);
              background: var(--background-primary);
              cursor: pointer;
              transition: all 0.2s;
            `}});m.addEventListener("click",()=>{this.updateTimeDisplay(v.hours,v.minutes,g,x,M)}),m.addEventListener("mouseenter",()=>{m.style.background="var(--background-modifier-hover)",m.style.borderColor="var(--interactive-accent)"}),m.addEventListener("mouseleave",()=>{m.style.background="var(--background-primary)",m.style.borderColor="var(--background-modifier-border)"})})}let Y=L=>{let b=parseInt(g.textContent||"12"),v=parseInt(x.textContent||"0"),m=b+L;m<0&&(m=23),m>23&&(m=0),this.updateTimeDisplay(m,v,g,x,M)},ee=L=>{let b=parseInt(g.textContent||"12"),m=parseInt(x.textContent||"0")+L,w=b;m<0?(m=59,w=w-1,w<0&&(w=23)):m>59&&(m=0,w=w+1,w>23&&(w=0)),this.updateTimeDisplay(w,m,g,x,M)};h.addEventListener("click",()=>Y(-1)),f.addEventListener("click",()=>Y(1)),D.addEventListener("click",()=>ee(-5)),T.addEventListener("click",()=>ee(5));let R=new Date;R.setHours(R.getHours()+1);let Ee=R.getHours(),Pe=Math.ceil(R.getMinutes()/5)*5;this.updateTimeDisplay(Ee,Pe,g,x,M);let _=r.createEl("div",{cls:"notelert-type-container"});_.setAttribute("style",`margin-bottom: 20px; padding: 15px; background: var(--background-secondary); border-radius: 6px; width: 100%; box-sizing: border-box; ${t?"display: none;":""}`);let Oe=_.createEl("label",{text:d(this.language,"datePicker.notificationType"),attr:{style:"display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;"}}),K=_.createEl("div");K.setAttribute("style","display: flex; gap: 10px; flex-wrap: wrap; width: 100%;");let $=K.createEl("button",{text:"\u23F0 "+d(this.language,"datePicker.timeNotification"),cls:"mod-cta"});$.setAttribute("style","flex: 1; min-width: 120px; padding: 10px; font-size: 14px; white-space: nowrap;"),$.id="notification-type-time";let H=K.createEl("button",{text:"\u{1F4CD} "+d(this.language,"datePicker.locationNotification"),cls:"mod-secondary"});H.setAttribute("style","flex: 1; min-width: 120px; padding: 10px; font-size: 14px; white-space: nowrap;"),H.id="notification-type-location";let j=()=>{this.notificationType==="time"?($.className="mod-cta",H.className="mod-secondary"):($.className="mod-secondary",H.className="mod-cta")};$.addEventListener("click",()=>{this.notificationType="time",this.selectedLocation=null,j(),this.updateModalContent(r,n,M)}),H.addEventListener("click",()=>{this.notificationType="location",this.selectedLocation=null,j(),this.updateModalContent(r,n,M)}),j();let F=r.createEl("div",{cls:"notelert-quick-actions"});F.setAttribute("style","margin-bottom: 20px; width: 100%; box-sizing: border-box;"),F.id="quick-actions-container",F.createEl("p",{text:d(this.language,"datePicker.quickActions")}).setAttribute("style","margin-bottom: 10px; font-weight: 500;");let te=F.createEl("div");te.setAttribute("style","display: flex; gap: 8px; flex-wrap: wrap; width: 100%;"),[{label:d(this.language,"datePicker.today"),date:this.getToday(),time:"09:00"},{label:d(this.language,"datePicker.tomorrow"),date:this.getTomorrow(),time:"09:00"},{label:d(this.language,"datePicker.in1Hour"),date:this.getToday(),time:this.getTimeInHours(1)},{label:d(this.language,"datePicker.in2Hours"),date:this.getToday(),time:this.getTimeInHours(2)}].forEach(L=>{let b=te.createEl("button",{text:L.label,cls:"mod-secondary"});b.setAttribute("style","padding: 4px 8px; font-size: 12px;"),b.addEventListener("click",()=>{n.value=L.date,M.value=L.time;let v=document.getElementById("hours-display"),m=document.getElementById("minutes-display");if(v&&m){let[w,S]=L.time.split(":").map(Number);this.updateTimeDisplay(w,S,v,m,M)}})});let V=e.createEl("div",{cls:"notelert-datepicker-buttons"});V.setAttribute("style",`
      display: flex; 
      gap: 10px; 
      justify-content: flex-end; 
      margin-top: 10px; 
      flex-wrap: wrap;
      flex-shrink: 0;
      padding-top: 10px;
      border-top: 1px solid var(--background-modifier-border);
      width: 100%;
      box-sizing: border-box;
    `);let ae=V.createEl("button",{text:d(this.language,"datePicker.cancelButton"),cls:"mod-secondary"});ae.setAttribute("style","flex: 1; min-width: 120px; padding: 12px 20px; font-size: 14px; box-sizing: border-box;"),ae.addEventListener("click",()=>{this.onCancel(),this.close()});let I=V.createEl("button",{text:d(this.language,"datePicker.confirmButton"),cls:"mod-cta"});I.setAttribute("style","flex: 1; min-width: 120px; padding: 12px 20px; font-size: 14px; box-sizing: border-box;"),I.id="datepicker-confirm-button",I.addEventListener("click",async()=>{this.showLoadingState(I);let L=b=>{let v=document.getElementById("datepicker-debug-info");if(v){let m=new Date().toLocaleTimeString(),w=v.innerHTML||"",S=b.includes("\u274C")||b.includes("Error")?"var(--text-error)":b.includes("\u2705")?"var(--text-success)":"var(--text-normal)";v.innerHTML=`${w}<div style="margin: 4px 0; padding: 4px 8px; font-size: 11px; color: ${S}; border-left: 3px solid ${S}; background: var(--background-secondary); border-radius: 3px; word-wrap: break-word; white-space: pre-wrap;"><span style="opacity: 0.7;">[${m}]</span> ${b}</div>`;let O=document.getElementById("datepicker-debug-container");O&&(O.scrollTop=O.scrollHeight)}};try{if(this.notificationType==="location"){if(!this.selectedLocation){this.hideLoadingState(I),new E.Notice(d(this.language,"datePicker.selectSavedLocation")||"Por favor, selecciona una ubicaci\xF3n");return}let b=await this.createNotificationFromLocation(this.selectedLocation);this.hideLoadingState(I),b&&this.close()}else{let b=n.value,v=M.value;if(b&&v){let m=`:@${b}, ${v}`,w=this.editor.getLine(this.cursor.line),S=w.substring(0,this.cursor.ch-2),O=w.substring(this.cursor.ch),oe=S+m+O;this.editor.setLine(this.cursor.line,oe);let Me={line:this.cursor.line,ch:S.length+m.length};this.editor.setCursor(Me);let Le=await this.createNotificationFromDatePicker(b,v,oe);this.hideLoadingState(I),Le&&this.close()}else this.hideLoadingState(I),new E.Notice(d(this.language,"datePicker.selectDateTime"))}}catch(b){this.hideLoadingState(I),this.plugin.log(`Error en confirmaci\xF3n: ${b}`),new E.Notice(`\u274C Error: ${b instanceof Error?b.message:"Error desconocido"}`)}}),n.value=this.getToday(),M.value=this.getTimeInHours(1)}onClose(){let{contentEl:e}=this;e.empty()}getToday(){return new Date().toISOString().split("T")[0]}getTomorrow(){let e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]}getTimeInHours(e){let t=new Date;return t.setHours(t.getHours()+e),t.toTimeString().slice(0,5)}updateTimeDisplay(e,t,o,r,i){e<0&&(e=0),e>23&&(e=23),t<0&&(t=0),t>59&&(t=59),o.textContent=String(e).padStart(2,"0"),r.textContent=String(t).padStart(2,"0");let a=`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}`;i.value=a}async createNotificationFromDatePicker(e,t,o){try{let r=this.plugin.app.workspace.getActiveFile(),i=r?r.basename:"Nota",n=this.editor.getLine(this.cursor.line).replace(/:@[^,\s]+,\s*[^\s]+/g,"").trim(),s={text:o.trim(),title:i,message:n,date:e,time:t,fullMatch:`:@${e}, ${t}`,startIndex:0,endIndex:o.length,filePath:r?.path,lineNumber:this.cursor.line+1,type:"time"};return!!await this.plugin.createNotificationAndMarkProcessed(s)}catch(r){return this.plugin.log(`Error creando notificaci\xF3n desde date picker: ${r}`),new E.Notice(d(this.language,"notices.errorCreatingNotification",{title:"Recordatorio"})),!1}}extractTitleFromText(e,t){let o=e.replace(t,"").trim();return o=o.replace(/\s+/g," ").trim(),o.length>50&&(o=o.substring(0,47)+"..."),o||"Recordatorio"}updateModalContent(e,t,o){let r=e.querySelector(".notelert-date-container"),i=e.querySelector(".notelert-time-container"),a=e.querySelector("#quick-actions-container"),n=e.querySelector("#location-list-container");this.notificationType==="location"?(r&&(r.style.display="none"),i&&(i.style.display="none"),a&&(a.style.display="none"),n?n.style.display="block":this.renderLocationList(e)):(r&&(r.style.display="block"),i&&(i.style.display="block"),a&&(a.style.display="block"),n&&(n.style.display="none"))}renderLocationList(e){let t=e.querySelector("#location-list-container");t&&t.remove();let o=this.plugin.settings.savedLocations||[];if(o.length===0){let a=e.createEl("div",{attr:{style:`
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
            background: var(--background-secondary);
            border-radius: 6px;
            margin: 15px 0;
          `}});a.id="location-list-container",a.textContent=d(this.language,"datePicker.noSavedLocations");return}let r=e.createEl("h3",{text:"Selecciona una ubicaci\xF3n:",attr:{style:`
          margin: 15px 0 10px 0;
          font-size: 16px;
          font-weight: 600;
          color: var(--text-normal);
          flex-shrink: 0;
        `}}),i=e.createEl("div",{attr:{style:`
          height: 400px;
          max-height: 400px;
          overflow-y: auto;
          overflow-x: hidden;
          padding: 10px;
          margin: 10px 0;
          background: var(--background-primary);
          border: 2px solid var(--interactive-accent);
          border-radius: 8px;
          box-sizing: border-box;
          flex-shrink: 0;
        `}});i.id="location-list-container",o.forEach((a,n)=>{let s=i.createEl("div",{attr:{style:`
            padding: 12px 15px;
            margin: 8px 0;
            border: 2px solid var(--background-modifier-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--background-primary);
            width: 100%;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: space-between;
          `}});s.id=`location-item-${n}`;let p=a.name||`Ubicaci\xF3n ${n+1}`,l=s.createEl("div",{text:p,attr:{style:"font-weight: 500; font-size: 14px; flex: 1;"}}),u=s.createEl("div",{text:"\u2713",attr:{style:`
            font-size: 18px;
            color: var(--interactive-accent);
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
            margin-left: 10px;
          `}});u.id=`check-icon-${n}`,s.locationData=a,s.checkIcon=u;let g=()=>{o.forEach((y,h)=>{let f=document.getElementById(`location-item-${h}`),P=document.getElementById(`check-icon-${h}`);if(f&&P){let x=f.querySelector("div:first-child");f.style.background="var(--background-primary)",f.style.borderColor="var(--background-modifier-border)",x&&(x.style.color="var(--text-normal)"),P.style.opacity="0"}}),s.style.background="var(--interactive-accent)",s.style.borderColor="var(--interactive-accent)",l.style.color="var(--text-on-accent)",u.style.opacity="1",this.selectedLocation=a};s.addEventListener("click",g),s.addEventListener("mouseenter",()=>{this.selectedLocation!==a&&(s.style.background="var(--background-modifier-hover)",s.style.borderColor="var(--interactive-accent)")}),s.addEventListener("mouseleave",()=>{this.selectedLocation!==a&&(s.style.background="var(--background-primary)",s.style.borderColor="var(--background-modifier-border)")})})}async selectLocationFromSaved(){return new Promise(async e=>{try{let t=new E.Modal(this.app);t.titleEl.setText(d(this.language,"datePicker.selectSavedLocation"));let{contentEl:o}=t;o.empty(),o.setAttribute("style",`
          min-width: 300px; 
          max-width: 600px; 
          width: 95vw;
          max-height: 85vh; 
          overflow: hidden;
          padding: 20px;
          box-sizing: border-box;
          display: flex;
          flex-direction: column;
          margin: 0 auto;
        `);let r=t.modalEl;r&&(r.style.zIndex="10000",r.style.position="fixed");let i=o.createEl("div",{attr:{style:`
              margin-bottom: 15px;
              padding: 12px;
              background: var(--background-secondary);
              border: 2px solid var(--background-modifier-border);
              border-radius: 8px;
              font-size: 11px;
              height: 150px;
              min-height: 150px;
              max-height: 200px;
              overflow-y: auto;
              overflow-x: hidden;
              font-family: 'Courier New', monospace;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
              flex-shrink: 0;
            `}});i.id="location-select-debug-container",i.innerHTML=`
          <div style="font-weight: 700; margin-bottom: 8px; color: var(--text-accent); font-size: 12px; border-bottom: 1px solid var(--background-modifier-border); padding-bottom: 6px;">
            \u{1F50D} Debug - Ubicaciones Guardadas
          </div>
          <div id="location-select-debug-info" style="color: var(--text-normal); line-height: 1.6; word-wrap: break-word; min-height: 100px;"></div>
        `;let a=l=>{let u=document.getElementById("location-select-debug-info");if(u){let g=new Date().toLocaleTimeString(),y=u.innerHTML||"",h=l.includes("\u274C")||l.includes("Error")?"var(--text-error)":l.includes("\u2705")?"var(--text-success)":"var(--text-normal)";u.innerHTML=`${y}<div style="margin: 4px 0; padding: 4px 8px; font-size: 11px; color: ${h}; border-left: 3px solid ${h}; background: var(--background-secondary); border-radius: 3px; word-wrap: break-word; white-space: pre-wrap;"><span style="opacity: 0.7;">[${g}]</span> ${l}</div>`;let f=document.getElementById("location-select-debug-container");f&&(f.scrollTop=f.scrollHeight)}};a("\u{1F50D} Iniciando b\xFAsqueda de ubicaciones guardadas..."),a("\u{1F4E5} Recargando settings..."),this.plugin.loadSettings?(await this.plugin.loadSettings(),a("\u2705 Settings recargados")):a("\u26A0\uFE0F loadSettings no disponible, usando settings actuales");let n=this.plugin.settings.savedLocations||[];if(a(`\u{1F4CA} Ubicaciones encontradas: ${n.length}`),a(`\u{1F4CB} Settings object: ${JSON.stringify(this.plugin.settings).substring(0,200)}...`),n.length>0?n.forEach((l,u)=>{a(`\u{1F4CD} [${u+1}] ${l.name||"Sin nombre"} - Lat: ${l.latitude}, Lon: ${l.longitude}`)}):(a("\u274C No se encontraron ubicaciones en savedLocations"),a(`\u{1F50D} Tipo de savedLocations: ${typeof this.plugin.settings.savedLocations}`),a(`\u{1F50D} savedLocations es null/undefined: ${this.plugin.settings.savedLocations===null||this.plugin.settings.savedLocations===void 0}`)),n.length===0){a("\u26A0\uFE0F No hay ubicaciones para mostrar"),new E.Notice(d(this.language,"datePicker.noSavedLocations")),t.open();return}let s=o.createEl("h3",{text:"Selecciona una ubicaci\xF3n:",attr:{style:`
            margin: 15px 0 10px 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-normal);
            flex-shrink: 0;
            display: block !important;
            visibility: visible !important;
          `}}),p=o.createEl("div",{attr:{style:`
            flex: 1;
            min-height: 250px;
            max-height: 450px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 15px;
            margin: 10px 0;
            background: var(--background-primary);
            border: 3px solid var(--interactive-accent);
            border-radius: 8px;
            box-sizing: border-box;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative;
            z-index: 100;
          `}});p.id="location-list-container",a("\u{1F3A8} Creando elementos de la lista..."),a("\u{1F4E6} Contenedor creado con ID: location-list-container"),a(`\u{1F4CF} Altura del contenedor: ${p.offsetHeight}px`),n.forEach((l,u)=>{a(`\u{1F4DD} Creando item ${u+1}: ${l.name||"Sin nombre"}`);let g=p.createEl("div",{attr:{style:`
              padding: 15px;
              margin: 10px 0;
              border: 2px solid var(--interactive-accent);
              border-radius: 6px;
              cursor: pointer;
              transition: all 0.2s;
              background: var(--background-primary);
              width: 100%;
              box-sizing: border-box;
              display: block !important;
              visibility: visible !important;
              opacity: 1 !important;
              position: relative;
              z-index: 10;
            `}});g.id=`location-item-${u}`,g.addEventListener("mouseenter",()=>{g.style.background="var(--background-modifier-hover)"}),g.addEventListener("mouseleave",()=>{g.style.background="var(--background-primary)"});let y=l.name||`Ubicaci\xF3n ${u+1}`;g.createEl("div",{text:y,attr:{style:"font-weight: 500; margin-bottom: 4px; font-size: 14px;"}}),l.address&&g.createEl("div",{text:l.address.length>60?l.address.substring(0,60)+"...":l.address,attr:{style:"font-size: 12px; color: var(--text-muted); margin-bottom: 4px; word-wrap: break-word;"}}),g.createEl("div",{text:`\u{1F4CD} ${l.latitude?.toFixed(6)||"0"}, ${l.longitude?.toFixed(6)||"0"}`,attr:{style:"font-size: 11px; color: var(--text-muted);"}}),g.addEventListener("click",()=>{a(`\u2705 Ubicaci\xF3n seleccionada: ${l.name}`),t.close(),e(l)}),a(`\u2705 Item ${u+1} creado con ID: location-item-${u}`)}),a(`\u2705 Lista creada con ${n.length} ubicaciones`),a(`\u{1F4CF} Altura final del contenedor: ${p.offsetHeight}px`),a(`\u{1F441}\uFE0F Elementos hijos del contenedor: ${p.children.length}`),setTimeout(()=>{let l=document.getElementById("location-list-container");l&&(a("\u{1F50D} Verificando contenedor despu\xE9s de renderizado..."),a(`  - display: ${window.getComputedStyle(l).display}`),a(`  - visibility: ${window.getComputedStyle(l).visibility}`),a(`  - opacity: ${window.getComputedStyle(l).opacity}`),a(`  - height: ${window.getComputedStyle(l).height}`),a(`  - overflow: ${window.getComputedStyle(l).overflow}`))},100),t.open()}catch(t){this.plugin.log(`Error cargando settings: ${t}`),new E.Notice("Error cargando ubicaciones guardadas"),e(null)}})}async createNotificationFromLocation(e){try{let t=`:#${e.name}`,o=this.editor.getLine(this.cursor.line),r=o.substring(0,this.cursor.ch-2),i=o.substring(this.cursor.ch),a=r+t+i;this.editor.setLine(this.cursor.line,a);let n={line:this.cursor.line,ch:r.length+t.length};this.editor.setCursor(n);let s=this.plugin.app.workspace.getActiveFile(),p=s?s.basename:"Nota",u=this.editor.getLine(this.cursor.line).replace(/:#[^\s]+/g,"").trim(),g={text:a.trim(),title:p,message:u,date:new Date().toISOString().split("T")[0],time:"00:00",fullMatch:t,startIndex:0,endIndex:a.length,filePath:s?.path,lineNumber:this.cursor.line+1,location:e.name,latitude:e.latitude,longitude:e.longitude,radius:e.radius,type:"location"};return await this.plugin.createNotificationAndMarkProcessed(g)?(this.plugin.log(`Notificaci\xF3n de ubicaci\xF3n creada: ${g.title} en ${e.name}`),!0):!1}catch(t){return this.plugin.log(`Error creando notificaci\xF3n de ubicaci\xF3n: ${t}`),new E.Notice(d(this.language,"notices.errorCreatingNotification",{title:"Recordatorio de ubicaci\xF3n"})),!1}}showLoadingState(e){if(e.__originalText=e.textContent,e.disabled=!0,e.style.opacity="0.6",e.style.cursor="not-allowed",e.innerHTML=`
      <span style="display: inline-block; margin-right: 8px;">
        <svg width="16" height="16" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"/>
          <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" opacity="0.75"/>
        </svg>
      </span>
      ${d(this.language,"datePicker.confirmButton")||"Confirmando..."}
    `,!document.getElementById("notelert-spinner-style")){let t=document.createElement("style");t.id="notelert-spinner-style",t.textContent=`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `,document.head.appendChild(t)}}hideLoadingState(e){let t=e.__originalText||d(this.language,"datePicker.confirmButton")||"Confirmar";e.textContent=t,e.disabled=!1,e.style.opacity="1",e.style.cursor="pointer"}addVisualFeedback(e,t){try{let o=t.match(/:@([^,]+),\s*([^\s]+)/);if(o){let r=o[1],i=o[2],a=`\u23F0${r}, ${i}`,n=`==${a}==`,s=e.replace(t,n);this.editor.setLine(this.cursor.line,s),this.plugin.log(`Feedback visual a\xF1adido: solo ${a} resaltado`)}}catch(o){this.plugin.log(`Error a\xF1adiendo feedback visual: ${o}`)}}};function ve(c,e,t){if(!t.settings.enableDatePicker||!t.settings.useNewSyntax)return;let o=c.getCursor(),i=c.getLine(o.line).substring(0,o.ch);if(i.endsWith(":@")){t.log("Detectado :@ - abriendo date picker"),xe(c,o,t);return}i.endsWith(":#")&&(t.log("Detectado :# - abriendo date picker"),xe(c,o,t))}function xe(c,e,t){let r=c.getLine(e.line);new W(t.app,t,t.settings.language,c,e,r,()=>{t.log("Date picker cancelado")}).open()}var N=z(require("obsidian"));function we(c,e){let t=encodeURIComponent(c.title),o=c.message;o=o.replace(/:@[^,\s]+,\s*[^\s]+/g,""),o=o.replace(/:#[^\s]+/g,""),o=o.trim().replace(/\s+/g," ");let r=encodeURIComponent(o),i=c.date,a=c.time,n=c.type||(c.location?"location":"time"),s="";c.location&&(s=`&location=${encodeURIComponent(c.location)}`,c.latitude!==void 0&&c.longitude!==void 0&&(s+=`&latitude=${c.latitude}&longitude=${c.longitude}`),c.radius!==void 0&&(s+=`&radius=${c.radius}`));let p="";if(c.filePath&&c.lineNumber){let l=`obsidian://open?vault=${encodeURIComponent(e.vault.getName())}&file=${encodeURIComponent(c.filePath)}&line=${c.lineNumber}`;p=`&returnLink=${encodeURIComponent(l)}`}return`notelert://add?title=${t}&message=${r}&date=${i}&time=${a}&type=${n}${s}${p}`}async function X(c,e,t,o,r){try{if(!N.Platform.isMobile){if(!t.pluginToken||t.pluginToken.trim()===""){new N.Notice(`\u{1F511} Token del plugin requerido

Para usar emails premium desde el plugin, necesitas:
1. Tener plan Premium activo
2. Generar tu token en la app m\xF3vil (Settings > Token del Plugin)
3. Pegar el token en Settings > Notelert > Plugin Token`);return}if(!t.userEmail){new N.Notice(d(t.language,"notices.desktopConfigRequired")||"\u274C Configura tu email en Settings para usar Notelert en desktop");return}if(c.type==="location"){new N.Notice(d(t.language,"notices.locationNotSupportedDesktop")||"\u274C Las notificaciones de ubicaci\xF3n solo est\xE1n disponibles en m\xF3vil");return}let a=`${c.date}T${c.time}:00`,n=new Date(a);if(isNaN(n.getTime())){new N.Notice(`\u274C Fecha inv\xE1lida: ${a}`),o(`Error: Fecha inv\xE1lida - ${a}`);return}let s=c.message;s=s.replace(/:@[^,\s]+,\s*[^\s]+/g,""),s=s.replace(/:#[^\s]+/g,""),s=s.trim().replace(/\s+/g," ");let p=pe();o("Programando email para desktop:"),o(`  - T\xEDtulo: ${c.title}`),o(`  - Mensaje: ${s}`),o(`  - Email: ${t.userEmail}`),o(`  - Fecha: ${n.toISOString()}`),o(`  - Notification ID: ${p}`);let l=new N.Notice("\u23F3 Programando email...",0),u=await ue(t.userEmail,c.title,s,n,p,t.pluginToken);if(l.hide(),u.success&&u.notificationId){let g={notificationId:u.notificationId,title:c.title,message:s,scheduledDate:n.toISOString(),createdAt:new Date().toISOString()};r&&r(g),new N.Notice(d(t.language,"notices.emailScheduled")||"\u2705 Email programado correctamente"),o(`Email programado: ${u.notificationId}`)}else{let g=u.error||"Error al programar email";throw new N.Notice(`\u274C ${g}`),o(`Error programando email: ${g}`),new Error(g)}}else{let a=we(c,e);o(`Ejecutando deeplink: ${a}`),typeof window!="undefined"&&(window.location.href=a)}}catch(i){throw i?.message&&i.message.includes("Error al programar email")||(o(`Error creando notificaci\xF3n: ${i}`),new N.Notice(d(t.language,"notices.errorCreatingNotification",{title:c.title}))),i}}var Z=class extends ke.Plugin{async onload(){console.log("Cargando plugin Notelert..."),await this.loadSettings(),this.addSettingTab(new Q(this.app,this)),this.addStatusBarItem().setText("Notelert: Activo"),this.settings.enableDatePicker&&this.registerEvent(this.app.workspace.on("editor-change",(e,t)=>{ve(e,t,this)})),console.log("Plugin Notelert cargado correctamente")}onunload(){console.log("Descargando plugin Notelert...")}async loadSettings(){this.settings=Object.assign({},ne,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async createNotificationInternal(e){await X(e,this.app,this.settings,t=>this.log(t),async t=>{this.settings.scheduledEmails||(this.settings.scheduledEmails=[]),this.settings.scheduledEmails.push(t),await this.saveSettings()})}async createNotificationAndMarkProcessed(e){try{return await this.createNotificationInternal(e),!0}catch(t){return this.log(`Error procesando notificaci\xF3n confirmada: ${t}`),!1}}log(e){this.settings.debugMode&&console.log(`[Notelert] ${e}`)}},He=Z;
