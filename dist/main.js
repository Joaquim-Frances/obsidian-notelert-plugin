var Me=Object.create,R=Object.defineProperty,Se=Object.getPrototypeOf,Ie=Object.prototype.hasOwnProperty,De=Object.getOwnPropertyNames,Ne=Object.getOwnPropertyDescriptor;var ne=l=>R(l,"__esModule",{value:!0});var Ae=(l,e)=>{for(var t in e)R(l,t,{get:e[t],enumerable:!0})},Ce=(l,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of De(e))!Ie.call(l,i)&&i!=="default"&&R(l,i,{get:()=>e[i],enumerable:!(t=Ne(e,i))||t.enumerable});return l},B=l=>Ce(ne(R(l!=null?Me(Se(l)):{},"default",l&&l.__esModule&&"default"in l?{get:()=>l.default,enumerable:!0}:{value:l,enumerable:!0})),l);ne(exports);Ae(exports,{NotelertPlugin:()=>Z,default:()=>He});var ke=B(require("obsidian"));var z="https://us-central1-notalert-2a44a.cloudfunctions.net",F=`${z}/pluginGeocode`,se=`${z}/pluginScheduleEmail`;var ce={autoProcess:!1,processOnSave:!1,processOnOpen:!1,debugMode:!1,language:"es",customPatterns:[],excludedFolders:["Templates","Archive","Trash"],debounceDelay:3e3,useDebounce:!1,showConfirmationModal:!1,addVisualIndicators:!1,visualIndicatorIcon:"\u23F0",useNewSyntax:!0,enableDatePicker:!0,savedLocations:[{name:"Casa",latitude:0,longitude:0,radius:100},{name:"Trabajo",latitude:0,longitude:0,radius:100},{name:"Supermercado",latitude:0,longitude:0,radius:200}],geocodingProvider:"google",googleMapsApiKey:"",useFirebaseProxy:!0,firebaseGeocodingUrl:F,mapboxApiKey:"",locationiqApiKey:"",opencageApiKey:"",algoliaApiKey:"",algoliaAppId:"",userEmail:"",userId:"",pluginToken:"",scheduledEmails:[]};var E=B(require("obsidian"));var _=[{code:"es",name:"Spanish",nativeName:"Espa\xF1ol",keywords:["Recordar:","Notificar:","Alerta:","Recordatorio:","Aviso:","Reminder:","Notify:","Alert:"],datePatterns:{today:["hoy"],tomorrow:["ma\xF1ana"],yesterday:["ayer"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"ca",name:"Catalan",nativeName:"Catal\xE0",keywords:["Recordar:","Notificar:","Alerta:","Recordatori:","Av\xEDs:","Reminder:","Notify:","Alert:"],datePatterns:{today:["avui"],tomorrow:["dem\xE0"],yesterday:["ahir"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"en",name:"English",nativeName:"English",keywords:["Remember:","Notify:","Alert:","Reminder:","Notice:","Remind:","Alert:","Warning:"],datePatterns:{today:["today"],tomorrow:["tomorrow"],yesterday:["yesterday"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"fr",name:"French",nativeName:"Fran\xE7ais",keywords:["Rappeler:","Notifier:","Alerte:","Rappel:","Avis:","Reminder:","Notify:","Alert:"],datePatterns:{today:["aujourd'hui","aujourd hui"],tomorrow:["demain"],yesterday:["hier"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"de",name:"German",nativeName:"Deutsch",keywords:["Erinnern:","Benachrichtigen:","Alarm:","Erinnerung:","Hinweis:","Reminder:","Notify:","Alert:"],datePatterns:{today:["heute"],tomorrow:["morgen"],yesterday:["gestern"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}},{code:"pt",name:"Portuguese",nativeName:"Portugu\xEAs",keywords:["Lembrar:","Notificar:","Alerta:","Lembrete:","Aviso:","Reminder:","Notify:","Alert:"],datePatterns:{today:["hoje"],tomorrow:["amanh\xE3","amanha"],yesterday:["ontem"]},timePatterns:{format24h:["HH:MM","H:MM"],format12h:["HH:MM AM/PM","H:MM AM/PM"]}}];var O={es:{settings:{title:"Configuraci\xF3n de Notelert",autoProcess:"Procesamiento autom\xE1tico",autoProcessDesc:"Activar el procesamiento autom\xE1tico de patrones",processOnSave:"Procesar al guardar",processOnSaveDesc:"Procesar autom\xE1ticamente cuando se guarda una nota",processOnOpen:"Procesar al abrir",processOnOpenDesc:"Procesar autom\xE1ticamente cuando se abre una nota",debugMode:"Modo debug",debugModeDesc:"Mostrar mensajes de debug en la consola",language:"Idioma",languageDesc:"Seleccionar idioma para detecci\xF3n de patrones",excludedFolders:"Carpetas excluidas",excludedFoldersDesc:"Carpetas que no se procesar\xE1n (separadas por comas)",customPatterns:"Palabras clave personalizadas",customPatternsDesc:"Palabras que activan el procesamiento (separadas por comas)",useDebounce:"Usar retraso inteligente",useDebounceDesc:"Esperar a que termines de escribir antes de procesar (evita notificaciones duplicadas)",debounceDelay:"Tiempo de espera (segundos)",debounceDelayDesc:"Tiempo a esperar despu\xE9s del \xFAltimo cambio antes de procesar",showConfirmationModal:"Mostrar modal de confirmaci\xF3n",showConfirmationModalDesc:"Preguntar antes de crear cada notificaci\xF3n",addVisualIndicators:"A\xF1adir iconos visuales",addVisualIndicatorsDesc:"A\xF1adir iconos a los recordatorios procesados para identificarlos visualmente",visualIndicatorIcon:"Icono visual",visualIndicatorIconDesc:"Icono a a\xF1adir al final de los recordatorios procesados",useNewSyntax:"Usar nuevo sistema",useNewSyntaxDesc:"Usar el nuevo formato :@fecha, hora en lugar del sistema anterior",enableDatePicker:"Activar date picker",enableDatePickerDesc:"Abrir autom\xE1ticamente el selector de fecha al escribir :@",supportedPatterns:"Patrones Soportados",keywords:"Palabras clave",dates:"Fechas:",times:"Horas:",examples:"Ejemplos:",platformInfo:{desktopTitle:"\u{1F4BB} Modo Desktop",desktopDesc:"En desktop, Notelert env\xEDa notificaciones por email. Las notificaciones de ubicaci\xF3n solo est\xE1n disponibles en m\xF3vil.",mobileTitle:"\u{1F4F1} Modo M\xF3vil",mobileDesc:"En m\xF3vil, Notelert usa la app para enviar notificaciones push y emails. Puedes configurar ubicaciones favoritas para recordatorios basados en ubicaci\xF3n."},basicSettings:"Configuraci\xF3n B\xE1sica",pluginToken:{title:"\u{1F511} Token del Plugin",descDesktop:"Token de autenticaci\xF3n para usar geocodificaci\xF3n y emails premium. Obt\xE9n tu token desde la app m\xF3vil en Settings > Plugin Token.",descMobile:"Token de autenticaci\xF3n para usar geocodificaci\xF3n premium. Obt\xE9n tu token desde la app m\xF3vil en Settings > Plugin Token.",placeholder:"Pega tu token aqu\xED...",showHide:"Mostrar/Ocultar"},desktopSettings:{title:"\u{1F4BB} Configuraci\xF3n Desktop",userEmailTitle:"Email del Usuario (Opcional)",userEmailDesc:"Email donde recibir\xE1s las notificaciones. Ya no es necesario si usas token del plugin.",userEmailPlaceholder:"usuario@email.com"},scheduledEmails:{title:"\u{1F4E7} Emails Programados",desc:"Gestiona tus emails programados. Puedes cancelarlos antes de que se env\xEDen.",empty:"No hay emails programados. Los emails que programes aparecer\xE1n aqu\xED.",cancelButton:"\u{1F5D1}\uFE0F Cancelar",canceling:"Cancelando...",cancelSuccess:"\u2705 Email cancelado correctamente",cancelError:"\u274C Error al cancelar email",past:"(Pasado)"},mobileSettings:{title:"\u{1F4F1} Configuraci\xF3n M\xF3vil"},savedLocations:{title:"\u{1F4CD} Ubicaciones Guardadas",desc:"Gestiona tus ubicaciones favoritas. Estas aparecer\xE1n cuando selecciones 'Ubicaci\xF3n' al crear una notificaci\xF3n.",addTitle:"A\xF1adir Nueva Ubicaci\xF3n",addDesc:"Abre el selector de ubicaciones con mapa para a\xF1adir una nueva ubicaci\xF3n",addButton:"\u2795 A\xF1adir Ubicaci\xF3n",empty:"No hay ubicaciones guardadas. Haz clic en 'A\xF1adir Ubicaci\xF3n' para empezar.",editButton:"\u270F\uFE0F Editar",deleteButton:"\u{1F5D1}\uFE0F"}},commands:{processCurrentNote:"Procesar nota actual para Notelert",processAllNotes:"Procesar todas las notas para Notelert",clearProcessedHistory:"Limpiar historial de procesamiento"},notices:{noActiveNote:"No hay ninguna nota abierta para procesar",processedNotes:"Procesadas {count} notas para Notelert",processedNote:"Procesada: {filename} ({count} notificaciones)",clearedHistory:"Historial de procesamiento limpiado",errorCreatingNotification:"Error creando notificaci\xF3n: {title}",defaultTitle:"Recordatorio",desktopConfigRequired:"\u274C Configura tu email y API Key en Settings para usar Notelert en desktop",locationNotSupportedDesktop:"\u274C Las notificaciones de ubicaci\xF3n solo est\xE1n disponibles en m\xF3vil",emailScheduled:"\u2705 Email programado correctamente"},modal:{title:"\xBFCrear notificaci\xF3n en Notelert?",titleLabel:"T\xEDtulo:",dateLabel:"Fecha:",timeLabel:"Hora:",messageLabel:"Mensaje:",confirmButton:"S\xED, crear notificaci\xF3n",cancelButton:"Cancelar"},datePicker:{title:"Seleccionar fecha y hora",dateLabel:"Fecha:",timeLabel:"Hora:",quickActions:"Acciones r\xE1pidas:",today:"Hoy",tomorrow:"Ma\xF1ana",in1Hour:"En 1 hora",in2Hours:"En 2 horas",confirmButton:"Confirmar notificaci\xF3n",cancelButton:"Cancelar",selectDateTime:"Por favor, selecciona una fecha y hora",notificationType:"Tipo de notificaci\xF3n:",timeNotification:"Tiempo",locationNotification:"Ubicaci\xF3n",noSavedLocations:"No hay ubicaciones guardadas. Ve a Settings para a\xF1adir ubicaciones.",selectSavedLocation:"Seleccionar Ubicaci\xF3n Guardada",hours:"Horas",minutes:"Minutos",selectLocationTitle:"Selecciona una ubicaci\xF3n:"},locationPicker:{title:"Seleccionar Ubicaci\xF3n",searchPlaceholder:"Buscar direcci\xF3n o lugar...",radius:"Radio (metros):",favorites:"Ubicaciones Favoritas",cancelButton:"Cancelar",confirmButton:"Confirmar",noFavorites:"No hay ubicaciones guardadas",selectButton:"Seleccionar",deleteButton:"Eliminar",saveFavorite:"\u2B50 Guardar",saved:"\u2713 Guardado",searching:"Buscando...",noResults:"No se encontraron resultados",error:"Error al buscar ubicaciones",connectionError:"Error de conexi\xF3n. Verifica tu conexi\xF3n a internet.",rateLimit:"Demasiadas solicitudes. Espera un momento antes de buscar de nuevo.",apiKeyError:"Error: API key no configurada o inv\xE1lida. Verifica la configuraci\xF3n.",selectLocation:"Selecciona una ubicaci\xF3n de los resultados o de tus favoritas",locationSelected:"Ubicaci\xF3n seleccionada",loadingMap:"Cargando mapa...",debugMap:"\u{1F50D} Debug Mapa",mapError:"\u26A0\uFE0F Error",mapErrorTitle:"Error al cargar el mapa",googleMapsError:"Google Maps no se carg\xF3 correctamente",nameLocationTitle:"Nombrar ubicaci\xF3n",nameLocationPlaceholder:"Introduce un nombre para esta ubicaci\xF3n",nameLocationConfirm:"Guardar",nameLocationCancel:"Cancelar"}},en:{settings:{title:"Notelert Settings",autoProcess:"Automatic processing",autoProcessDesc:"Enable automatic pattern processing",processOnSave:"Process on save",processOnSaveDesc:"Automatically process when saving a note",processOnOpen:"Process on open",processOnOpenDesc:"Automatically process when opening a note",debugMode:"Debug mode",debugModeDesc:"Show debug messages in console",language:"Language",languageDesc:"Select language for pattern detection",excludedFolders:"Excluded folders",excludedFoldersDesc:"Folders that will not be processed (comma separated)",customPatterns:"Custom keywords",customPatternsDesc:"Words that trigger processing (comma separated)",useDebounce:"Use smart delay",useDebounceDesc:"Wait for you to finish typing before processing (prevents duplicate notifications)",debounceDelay:"Wait time (seconds)",debounceDelayDesc:"Time to wait after last change before processing",showConfirmationModal:"Show confirmation modal",showConfirmationModalDesc:"Ask before creating each notification",addVisualIndicators:"Add visual indicators",addVisualIndicatorsDesc:"Add icons to processed reminders to identify them visually",visualIndicatorIcon:"Visual icon",visualIndicatorIconDesc:"Icon to add at the end of processed reminders",useNewSyntax:"Use new system",useNewSyntaxDesc:"Use the new :@date, time format instead of the previous system",enableDatePicker:"Enable date picker",enableDatePickerDesc:"Automatically open date selector when typing :@",supportedPatterns:"Supported Patterns",keywords:"Keywords",dates:"Dates:",times:"Times:",examples:"Examples:",platformInfo:{desktopTitle:"\u{1F4BB} Desktop Mode",desktopDesc:"On desktop, Notelert sends email notifications. Location notifications are only available on mobile.",mobileTitle:"\u{1F4F1} Mobile Mode",mobileDesc:"On mobile, Notelert uses the app to send push notifications and emails. You can configure favorite locations for location-based reminders."},basicSettings:"Basic Settings",pluginToken:{title:"\u{1F511} Plugin Token",descDesktop:"Authentication token for premium geocoding and emails. Get your token from the mobile app in Settings > Plugin Token.",descMobile:"Authentication token for premium geocoding. Get your token from the mobile app in Settings > Plugin Token.",placeholder:"Paste your token here...",showHide:"Show/Hide"},desktopSettings:{title:"\u{1F4BB} Desktop Settings",userEmailTitle:"User Email (Optional)",userEmailDesc:"Email where you will receive notifications. No longer needed if using plugin token.",userEmailPlaceholder:"user@email.com"},scheduledEmails:{title:"\u{1F4E7} Scheduled Emails",desc:"Manage your scheduled emails. You can cancel them before they are sent.",empty:"No scheduled emails. Emails you schedule will appear here.",cancelButton:"\u{1F5D1}\uFE0F Cancel",canceling:"Canceling...",cancelSuccess:"\u2705 Email canceled successfully",cancelError:"\u274C Error canceling email",past:"(Past)"},mobileSettings:{title:"\u{1F4F1} Mobile Settings"},savedLocations:{title:"\u{1F4CD} Saved Locations",desc:"Manage your favorite locations. These will appear when you select 'Location' when creating a notification.",addTitle:"Add New Location",addDesc:"Open location picker with map to add a new location",addButton:"\u2795 Add Location",empty:"No saved locations. Click 'Add Location' to start.",editButton:"\u270F\uFE0F Edit",deleteButton:"\u{1F5D1}\uFE0F"}},commands:{processCurrentNote:"Process current note for Notelert",processAllNotes:"Process all notes for Notelert",clearProcessedHistory:"Clear processing history"},notices:{noActiveNote:"No active note to process",processedNotes:"Processed {count} notes for Notelert",processedNote:"Processed: {filename} ({count} notifications)",clearedHistory:"Processing history cleared",errorCreatingNotification:"Error creating notification: {title}",defaultTitle:"Reminder",desktopConfigRequired:"\u274C Configure your email and API Key in Settings to use Notelert on desktop",locationNotSupportedDesktop:"\u274C Location notifications are only available on mobile",emailScheduled:"\u2705 Email scheduled successfully"},modal:{title:"Create notification in Notelert?",titleLabel:"Title:",dateLabel:"Date:",timeLabel:"Time:",messageLabel:"Message:",confirmButton:"Yes, create notification",cancelButton:"Cancel"},datePicker:{title:"Select date and time",dateLabel:"Date:",timeLabel:"Time:",quickActions:"Quick actions:",today:"Today",tomorrow:"Tomorrow",in1Hour:"In 1 hour",in2Hours:"In 2 hours",confirmButton:"Confirm notification",cancelButton:"Cancel",selectDateTime:"Please select a date and time",notificationType:"Notification type:",timeNotification:"Time",locationNotification:"Location",noSavedLocations:"No saved locations. Go to Settings to add locations.",selectSavedLocation:"Select Saved Location",hours:"Hours",minutes:"Minutes",selectLocationTitle:"Select a location:"},locationPicker:{title:"Select Location",searchPlaceholder:"Search address or place...",radius:"Radius (meters):",favorites:"Favorite Locations",cancelButton:"Cancel",confirmButton:"Confirm",noFavorites:"No saved locations",selectButton:"Select",deleteButton:"Delete",saveFavorite:"\u2B50 Save",saved:"\u2713 Saved",searching:"Searching...",noResults:"No results found",error:"Error searching locations",connectionError:"Connection error. Check your internet connection.",rateLimit:"Too many requests. Wait a moment before searching again.",apiKeyError:"Error: API key not configured or invalid. Check your settings.",selectLocation:"Select a location from results or your favorites",locationSelected:"Location selected",loadingMap:"Loading map...",debugMap:"\u{1F50D} Debug Map",mapError:"\u26A0\uFE0F Error",mapErrorTitle:"Error loading map",googleMapsError:"Google Maps did not load correctly",nameLocationTitle:"Name Location",nameLocationPlaceholder:"Enter a name for this location",nameLocationConfirm:"Save",nameLocationCancel:"Cancel"}},ca:{settings:{title:"Configuraci\xF3 de Notelert",autoProcess:"Processament autom\xE0tic",autoProcessDesc:"Activar el processament autom\xE0tic de patrons",processOnSave:"Processar en desar",processOnSaveDesc:"Processar autom\xE0ticament quan es desa una nota",processOnOpen:"Processar en obrir",processOnOpenDesc:"Processar autom\xE0ticament quan s'obre una nota",debugMode:"Mode debug",debugModeDesc:"Mostrar missatges de debug a la consola",language:"Idioma",languageDesc:"Seleccionar idioma per a la detecci\xF3 de patrons",excludedFolders:"Carpetes excloses",excludedFoldersDesc:"Carpetes que no es processaran (separades per comes)",customPatterns:"Paraules clau personalitzades",customPatternsDesc:"Paraules que activen el processament (separades per comes)",useDebounce:"Usar retard intel\xB7ligent",useDebounceDesc:"Esperar que acabis d'escriure abans de processar (evita notificacions duplicades)",debounceDelay:"Temps d'espera (segons)",debounceDelayDesc:"Temps a esperar despr\xE9s del darrer canvi abans de processar",showConfirmationModal:"Mostrar modal de confirmaci\xF3",showConfirmationModalDesc:"Preguntar abans de crear cada notificaci\xF3",addVisualIndicators:"Afegir indicadors visuals",addVisualIndicatorsDesc:"Afegir icones als recordatoris processats per identificar-los visualment",visualIndicatorIcon:"Icona visual",visualIndicatorIconDesc:"Icona a afegir al final dels recordatoris processats",useNewSyntax:"Usar nou sistema",useNewSyntaxDesc:"Usar el nou format :@data, hora en lloc del sistema anterior",enableDatePicker:"Activar selector de data",enableDatePickerDesc:"Obrir autom\xE0ticament el selector de data en escriure :@",supportedPatterns:"Patrons Suportats",keywords:"Paraules clau",dates:"Dates:",times:"Hores:",examples:"Exemples:",platformInfo:{desktopTitle:"\u{1F4BB} Mode Escriptori",desktopDesc:"A l'escriptori, Notelert envia notificacions per correu electr\xF2nic. Les notificacions d'ubicaci\xF3 nom\xE9s estan disponibles al m\xF2bil.",mobileTitle:"\u{1F4F1} Mode M\xF2bil",mobileDesc:"Al m\xF2bil, Notelert utilitza l'aplicaci\xF3 per enviar notificacions push i correus electr\xF2nics. Pots configurar ubicacions preferides per a recordatoris basats en la ubicaci\xF3."},basicSettings:"Configuraci\xF3 B\xE0sica",pluginToken:{title:"\u{1F511} Token del Plugin",descDesktop:"Token d'autenticaci\xF3 per utilitzar geocodificaci\xF3 i correus electr\xF2nics premium. Obteniu el vostre token des de l'aplicaci\xF3 m\xF2bil a Configuraci\xF3 > Token del Plugin.",descMobile:"Token d'autenticaci\xF3 per utilitzar geocodificaci\xF3 premium. Obteniu el vostre token des de l'aplicaci\xF3 m\xF2bil a Configuraci\xF3 > Token del Plugin.",placeholder:"Enganxa el teu token aqu\xED...",showHide:"Mostra/Amaga"},desktopSettings:{title:"\u{1F4BB} Configuraci\xF3 d'Escriptori",userEmailTitle:"Correu electr\xF2nic de l'usuari (Opcional)",userEmailDesc:"Correu electr\xF2nic on rebr\xE0s les notificacions. Ja no \xE9s necessari si utilitzes el token del plugin.",userEmailPlaceholder:"usuari@email.com"},scheduledEmails:{title:"\u{1F4E7} Correus electr\xF2nics programats",desc:"Gestiona els teus correus electr\xF2nics programats. Pots cancel\xB7lar-los abans que s'envi\xEFn.",empty:"No hi ha correus electr\xF2nics programats. Els correus que programis apareixeran aqu\xED.",cancelButton:"\u{1F5D1}\uFE0F Cancel\xB7lar",canceling:"Cancel\xB7lant...",cancelSuccess:"\u2705 Correu electr\xF2nic cancel\xB7lat correctament",cancelError:"\u274C Error en cancel\xB7lar el correu electr\xF2nic",past:"(Passat)"},mobileSettings:{title:"\u{1F4F1} Configuraci\xF3 M\xF2bil"},savedLocations:{title:"\u{1F4CD} Ubicacions Guardades",desc:"Gestiona les teves ubicacions preferides. Aquestes apareixeran quan seleccionis 'Ubicaci\xF3' en crear una notificaci\xF3.",addTitle:"Afegir Nova Ubicaci\xF3",addDesc:"Obre el selector d'ubicacions amb mapa per afegir una nova ubicaci\xF3",addButton:"\u2795 Afegir Ubicaci\xF3",empty:"No hi ha ubicacions guardades. Fes clic a 'Afegir Ubicaci\xF3' per comen\xE7ar.",editButton:"\u270F\uFE0F Editar",deleteButton:"\u{1F5D1}\uFE0F"}},commands:{processCurrentNote:"Processar nota actual per a Notelert",processAllNotes:"Processar totes les notes per a Notelert",clearProcessedHistory:"Netejar historial de processament"},notices:{noActiveNote:"No hi ha cap nota oberta per processar",processedNotes:"Processades {count} notes per a Notelert",processedNote:"Processada: {filename} ({count} notificacions)",clearedHistory:"Historial de processament netejat",errorCreatingNotification:"Error creant notificaci\xF3: {title}",defaultTitle:"Recordatori",desktopConfigRequired:"\u274C Configura el teu email i API Key a Settings per usar Notelert a desktop",locationNotSupportedDesktop:"\u274C Les notificacions d'ubicaci\xF3 nom\xE9s estan disponibles a m\xF2bil",emailScheduled:"\u2705 Email programat correctament"},modal:{title:"Crear notificaci\xF3 a Notelert?",titleLabel:"T\xEDtol:",dateLabel:"Data:",timeLabel:"Hora:",messageLabel:"Missatge:",confirmButton:"S\xED, crear notificaci\xF3",cancelButton:"Cancel\xB7lar"},datePicker:{title:"Seleccionar data i hora",dateLabel:"Data:",timeLabel:"Hora:",quickActions:"Accions r\xE0pides:",today:"Avui",tomorrow:"Dem\xE0",in1Hour:"En 1 hora",in2Hours:"En 2 hores",confirmButton:"Confirmar notificaci\xF3",cancelButton:"Cancel\xB7lar",selectDateTime:"Si us plau, selecciona una data i hora",notificationType:"Tipus de notificaci\xF3:",timeNotification:"Temps",locationNotification:"Ubicaci\xF3",noSavedLocations:"No hi ha ubicacions guardades. Ves a Settings per afegir ubicacions.",selectSavedLocation:"Seleccionar Ubicaci\xF3 Guardada",hours:"Hores",minutes:"Minuts",selectLocationTitle:"Selecciona una ubicaci\xF3:"},locationPicker:{title:"Seleccionar Ubicaci\xF3",searchPlaceholder:"Buscar adre\xE7a o lloc...",radius:"Radi (metres):",favorites:"Ubicacions Favorites",cancelButton:"Cancel\xB7lar",confirmButton:"Confirmar",noFavorites:"No hi ha ubicacions guardades",selectButton:"Seleccionar",deleteButton:"Eliminar",saveFavorite:"\u2B50 Guardar",saved:"\u2713 Guardat",searching:"Buscant...",noResults:"No s'han trobat resultats",error:"Error en buscar ubicacions",connectionError:"Error de connexi\xF3. Verifica la teva connexi\xF3 a internet.",rateLimit:"Massa sol\xB7licituds. Espera un moment abans de buscar de nou.",apiKeyError:"Error: API key no configurada o inv\xE0lida. Verifica la configuraci\xF3.",selectLocation:"Selecciona una ubicaci\xF3 dels resultats o de les teves favorites",locationSelected:"Ubicaci\xF3 seleccionada",loadingMap:"Carregant mapa...",debugMap:"\u{1F50D} Debug Mapa",mapError:"\u26A0\uFE0F Error",mapErrorTitle:"Error en carregar el mapa",googleMapsError:"Google Maps no s'ha carregat correctament",nameLocationTitle:"Nomenar ubicaci\xF3",nameLocationPlaceholder:"Introdueix un nom per aquesta ubicaci\xF3",nameLocationConfirm:"Guardar",nameLocationCancel:"Cancel\xB7lar"}},fr:{settings:{title:"Param\xE8tres Notelert",autoProcess:"Traitement automatique",autoProcessDesc:"Activer le traitement automatique des motifs",processOnSave:"Traiter \xE0 la sauvegarde",processOnSaveDesc:"Traiter automatiquement lors de la sauvegarde d'une note",processOnOpen:"Traiter \xE0 l'ouverture",processOnOpenDesc:"Traiter automatiquement lors de l'ouverture d'une note",debugMode:"Mode debug",debugModeDesc:"Afficher les messages de debug dans la console",language:"Langue",languageDesc:"S\xE9lectionner la langue pour la d\xE9tection de motifs",excludedFolders:"Dossiers exclus",excludedFoldersDesc:"Dossiers qui ne seront pas trait\xE9s (s\xE9par\xE9s par des virgules)",customPatterns:"Mots-cl\xE9s personnalis\xE9s",customPatternsDesc:"Mots qui d\xE9clenchent le traitement (s\xE9par\xE9s par des virgules)",supportedPatterns:"Motifs Support\xE9s",keywords:"Mots-cl\xE9s",dates:"Dates:",times:"Heures:",examples:"Exemples:",platformInfo:{desktopTitle:"\u{1F4BB} Mode Bureau",desktopDesc:"Sur bureau, Notelert envoie des notifications par e-mail. Les notifications de localisation sont uniquement disponibles sur mobile.",mobileTitle:"\u{1F4F1} Mode Mobile",mobileDesc:"Sur mobile, Notelert utilise l'application pour envoyer des notifications push et des e-mails. Vous pouvez configurer des lieux favoris pour les rappels bas\xE9s sur la localisation."},basicSettings:"Param\xE8tres de base",pluginToken:{title:"\u{1F511} Jeton du Plugin",descDesktop:"Jeton d'authentification pour utiliser le g\xE9ocodage et les e-mails premium. Obtenez votre jeton depuis l'application mobile dans Param\xE8tres > Jeton du Plugin.",descMobile:"Jeton d'authentification pour utiliser le g\xE9ocodage premium. Obtenez votre jeton depuis l'application mobile dans Param\xE8tres > Jeton du Plugin.",placeholder:"Collez votre jeton ici...",showHide:"Afficher/Masquer"},desktopSettings:{title:"\u{1F4BB} Param\xE8tres Bureau",userEmailTitle:"E-mail utilisateur (Optionnel)",userEmailDesc:"E-mail o\xF9 vous recevrez les notifications. Plus n\xE9cessaire si vous utilisez le jeton du plugin.",userEmailPlaceholder:"utilisateur@email.com"},scheduledEmails:{title:"\u{1F4E7} E-mails programm\xE9s",desc:"G\xE9rez vos e-mails programm\xE9s. Vous pouvez les annuler avant qu'ils ne soient envoy\xE9s.",empty:"Aucun e-mail programm\xE9. Les e-mails que vous programmez appara\xEEtront ici.",cancelButton:"\u{1F5D1}\uFE0F Annuler",canceling:"Annulation...",cancelSuccess:"\u2705 E-mail annul\xE9 avec succ\xE8s",cancelError:"\u274C Erreur lors de l'annulation de l'e-mail",past:"(Pass\xE9)"},mobileSettings:{title:"\u{1F4F1} Param\xE8tres Mobile"},savedLocations:{title:"\u{1F4CD} Lieux enregistr\xE9s",desc:"G\xE9rez vos lieux favoris. Ils appara\xEEtront lorsque vous s\xE9lectionnerez 'Lieu' lors de la cr\xE9ation d'une notification.",addTitle:"Ajouter un nouveau lieu",addDesc:"Ouvrir le s\xE9lecteur de lieu avec carte pour ajouter un nouveau lieu",addButton:"\u2795 Ajouter un lieu",empty:"Aucun lieu enregistr\xE9. Cliquez sur 'Ajouter un lieu' pour commencer.",editButton:"\u270F\uFE0F Modifier",deleteButton:"\u{1F5D1}\uFE0F"}},commands:{processCurrentNote:"Traiter la note actuelle pour Notelert",processAllNotes:"Traiter toutes les notes pour Notelert",clearProcessedHistory:"Effacer l'historique de traitement"},notices:{noActiveNote:"Aucune note active \xE0 traiter",processedNotes:"Trait\xE9es {count} notes pour Notelert",processedNote:"Trait\xE9: {filename} ({count} notifications)",clearedHistory:"Historique de traitement effac\xE9",errorCreatingNotification:"Erreur lors de la cr\xE9ation de la notification: {title}",defaultTitle:"Rappel"},datePicker:{title:"S\xE9lectionner la date et l'heure",dateLabel:"Date:",timeLabel:"Heure:",quickActions:"Actions rapides:",today:"Aujourd'hui",tomorrow:"Demain",in1Hour:"Dans 1 heure",in2Hours:"Dans 2 heures",confirmButton:"Confirmer la notification",cancelButton:"Annuler",selectDateTime:"Veuillez s\xE9lectionner une date et une heure",notificationType:"Type de notification:",timeNotification:"Temps",locationNotification:"Lieu",noSavedLocations:"Aucun lieu enregistr\xE9. Allez dans Param\xE8tres pour ajouter des lieux.",selectSavedLocation:"S\xE9lectionner un lieu enregistr\xE9",hours:"Heures",minutes:"Minutes",selectLocationTitle:"S\xE9lectionnez un lieu:"},locationPicker:{title:"S\xE9lectionner un lieu",searchPlaceholder:"Rechercher une adresse ou un lieu...",radius:"Rayon (m\xE8tres):",favorites:"Lieux favoris",cancelButton:"Annuler",confirmButton:"Confirmer",noFavorites:"Aucun lieu enregistr\xE9",selectButton:"S\xE9lectionner",deleteButton:"Supprimer",saveFavorite:"\u2B50 Enregistrer",saved:"\u2713 Enregistr\xE9",searching:"Recherche...",noResults:"Aucun r\xE9sultat trouv\xE9",error:"Erreur lors de la recherche de lieux",connectionError:"Erreur de connexion. V\xE9rifiez votre connexion internet.",rateLimit:"Trop de demandes. Attendez un moment avant de rechercher \xE0 nouveau.",apiKeyError:"Erreur: Cl\xE9 API non configur\xE9e ou invalide. V\xE9rifiez vos param\xE8tres.",selectLocation:"S\xE9lectionnez un lieu parmi les r\xE9sultats ou vos favoris",locationSelected:"Lieu s\xE9lectionn\xE9",loadingMap:"Chargement de la carte...",debugMap:"\u{1F50D} Debug Carte",mapError:"\u26A0\uFE0F Erreur",mapErrorTitle:"Erreur lors du chargement de la carte",googleMapsError:"Google Maps ne s'est pas charg\xE9 correctement",nameLocationTitle:"Nommer le lieu",nameLocationPlaceholder:"Entrez un nom pour ce lieu",nameLocationConfirm:"Enregistrer",nameLocationCancel:"Annuler"}},de:{settings:{title:"Notelert Einstellungen",autoProcess:"Automatische Verarbeitung",autoProcessDesc:"Automatische Musterverarbeitung aktivieren",processOnSave:"Beim Speichern verarbeiten",processOnSaveDesc:"Automatisch verarbeiten beim Speichern einer Notiz",processOnOpen:"Beim \xD6ffnen verarbeiten",processOnOpenDesc:"Automatisch verarbeiten beim \xD6ffnen einer Notiz",debugMode:"Debug-Modus",debugModeDesc:"Debug-Nachrichten in der Konsole anzeigen",language:"Sprache",languageDesc:"Sprache f\xFCr Mustererkennung ausw\xE4hlen",excludedFolders:"Ausgeschlossene Ordner",excludedFoldersDesc:"Ordner, die nicht verarbeitet werden (durch Kommas getrennt)",customPatterns:"Benutzerdefinierte Schl\xFCsselw\xF6rter",customPatternsDesc:"W\xF6rter, die die Verarbeitung ausl\xF6sen (durch Kommas getrennt)",supportedPatterns:"Unterst\xFCtzte Muster",keywords:"Schl\xFCsselw\xF6rter",dates:"Daten:",times:"Zeiten:",examples:"Beispiele:",platformInfo:{desktopTitle:"\u{1F4BB} Desktop-Modus",desktopDesc:"Auf dem Desktop sendet Notelert E-Mail-Benachrichtigungen. Standortbenachrichtigungen sind nur auf Mobilger\xE4ten verf\xFCgbar.",mobileTitle:"\u{1F4F1} Mobil-Modus",mobileDesc:"Auf Mobilger\xE4ten verwendet Notelert die App, um Push-Benachrichtigungen und E-Mails zu senden. Sie k\xF6nnen Lieblingsorte f\xFCr standortbezogene Erinnerungen konfigurieren."},basicSettings:"Grundeinstellungen",pluginToken:{title:"\u{1F511} Plugin-Token",descDesktop:"Authentifizierungstoken f\xFCr Premium-Geocodierung und E-Mails. Holen Sie sich Ihr Token aus der mobilen App unter Einstellungen > Plugin-Token.",descMobile:"Authentifizierungstoken f\xFCr Premium-Geocodierung. Holen Sie sich Ihr Token aus der mobilen App unter Einstellungen > Plugin-Token.",placeholder:"F\xFCgen Sie Ihr Token hier ein...",showHide:"Anzeigen/Verbergen"},desktopSettings:{title:"\u{1F4BB} Desktop-Einstellungen",userEmailTitle:"Benutzer-E-Mail (Optional)",userEmailDesc:"E-Mail, an die Sie Benachrichtigungen erhalten. Nicht mehr erforderlich, wenn Sie das Plugin-Token verwenden.",userEmailPlaceholder:"benutzer@email.com"},scheduledEmails:{title:"\u{1F4E7} Geplante E-Mails",desc:"Verwalten Sie Ihre geplanten E-Mails. Sie k\xF6nnen sie stornieren, bevor sie gesendet werden.",empty:"Keine geplanten E-Mails. E-Mails, die Sie planen, werden hier angezeigt.",cancelButton:"\u{1F5D1}\uFE0F Abbrechen",canceling:"Abbrechen...",cancelSuccess:"\u2705 E-Mail erfolgreich abgebrochen",cancelError:"\u274C Fehler beim Abbrechen der E-Mail",past:"(Vergangen)"},mobileSettings:{title:"\u{1F4F1} Mobile Einstellungen"},savedLocations:{title:"\u{1F4CD} Gespeicherte Orte",desc:"Verwalten Sie Ihre Lieblingsorte. Diese erscheinen, wenn Sie 'Ort' ausw\xE4hlen, wenn Sie eine Benachrichtigung erstellen.",addTitle:"Neuen Ort hinzuf\xFCgen",addDesc:"\xD6ffnen Sie die Standortauswahl mit Karte, um einen neuen Ort hinzuzuf\xFCgen",addButton:"\u2795 Ort hinzuf\xFCgen",empty:"Keine gespeicherten Orte. Klicken Sie auf 'Ort hinzuf\xFCgen', um zu beginnen.",editButton:"\u270F\uFE0F Bearbeiten",deleteButton:"\u{1F5D1}\uFE0F"}},commands:{processCurrentNote:"Aktuelle Notiz f\xFCr Notelert verarbeiten",processAllNotes:"Alle Notizen f\xFCr Notelert verarbeiten",clearProcessedHistory:"Verarbeitungshistorie l\xF6schen"},notices:{noActiveNote:"Keine aktive Notiz zum Verarbeiten",processedNotes:"Verarbeitet {count} Notizen f\xFCr Notelert",processedNote:"Verarbeitet: {filename} ({count} Benachrichtigungen)",clearedHistory:"Verarbeitungshistorie gel\xF6scht",errorCreatingNotification:"Fehler beim Erstellen der Benachrichtigung: {title}",defaultTitle:"Erinnerung"}},pt:{settings:{title:"Configura\xE7\xF5es Notelert",autoProcess:"Processamento autom\xE1tico",autoProcessDesc:"Ativar processamento autom\xE1tico de padr\xF5es",processOnSave:"Processar ao salvar",processOnSaveDesc:"Processar automaticamente ao salvar uma nota",processOnOpen:"Processar ao abrir",processOnOpenDesc:"Processar automaticamente ao abrir uma nota",debugMode:"Modo debug",debugModeDesc:"Mostrar mensagens de debug no console",language:"Idioma",languageDesc:"Selecionar idioma para detec\xE7\xE3o de padr\xF5es",excludedFolders:"Pastas exclu\xEDdas",excludedFoldersDesc:"Pastas que n\xE3o ser\xE3o processadas (separadas por v\xEDrgulas)",customPatterns:"Palavras-chave personalizadas",customPatternsDesc:"Palavras que ativam o processamento (separadas por v\xEDrgulas)",supportedPatterns:"Padr\xF5es Suportados",keywords:"Palavras-chave",dates:"Datas:",times:"Hor\xE1rios:",examples:"Exemplos:",platformInfo:{desktopTitle:"\u{1F4BB} Modo Desktop",desktopDesc:"No desktop, Notelert envia notifica\xE7\xF5es por e-mail. As notifica\xE7\xF5es de localiza\xE7\xE3o est\xE3o dispon\xEDveis apenas no celular.",mobileTitle:"\u{1F4F1} Modo M\xF3vel",mobileDesc:"No celular, Notelert usa o aplicativo para enviar notifica\xE7\xF5es push e e-mails. Voc\xEA pode configurar locais favoritos para lembretes baseados em localiza\xE7\xE3o."},basicSettings:"Configura\xE7\xF5es B\xE1sicas",pluginToken:{title:"\u{1F511} Token do Plugin",descDesktop:"Token de autentica\xE7\xE3o para usar geocodifica\xE7\xE3o e e-mails premium. Obtenha seu token no aplicativo m\xF3vel em Configura\xE7\xF5es > Token do Plugin.",descMobile:"Token de autentica\xE7\xE3o para usar geocodifica\xE7\xE3o premium. Obtenha seu token no aplicativo m\xF3vel em Configura\xE7\xF5es > Token do Plugin.",placeholder:"Cole seu token aqui...",showHide:"Mostrar/Ocultar"},desktopSettings:{title:"\u{1F4BB} Configura\xE7\xF5es de Desktop",userEmailTitle:"E-mail do Usu\xE1rio (Opcional)",userEmailDesc:"E-mail onde voc\xEA receber\xE1 as notifica\xE7\xF5es. N\xE3o \xE9 mais necess\xE1rio se usar o token do plugin.",userEmailPlaceholder:"usuario@email.com"},scheduledEmails:{title:"\u{1F4E7} E-mails Agendados",desc:"Gerencie seus e-mails agendados. Voc\xEA pode cancel\xE1-los antes que sejam enviados.",empty:"Nenhum e-mail agendado. Os e-mails que voc\xEA agendar aparecer\xE3o aqui.",cancelButton:"\u{1F5D1}\uFE0F Cancelar",canceling:"Cancelando...",cancelSuccess:"\u2705 E-mail cancelado com sucesso",cancelError:"\u274C Erro ao cancelar e-mail",past:"(Passado)"},mobileSettings:{title:"\u{1F4F1} Configura\xE7\xF5es M\xF3veis"},savedLocations:{title:"\u{1F4CD} Locais Salvos",desc:"Gerencie seus locais favoritos. Eles aparecer\xE3o quando voc\xEA selecionar 'Localiza\xE7\xE3o' ao criar uma notifica\xE7\xE3o.",addTitle:"Adicionar Novo Local",addDesc:"Abrir seletor de localiza\xE7\xE3o com mapa para adicionar um novo local",addButton:"\u2795 Adicionar Local",empty:"Nenhum local salvo. Clique em 'Adicionar Local' para come\xE7ar.",editButton:"\u270F\uFE0F Editar",deleteButton:"\u{1F5D1}\uFE0F"}},commands:{processCurrentNote:"Processar nota atual para Notelert",processAllNotes:"Processar todas as notas para Notelert",clearProcessedHistory:"Limpar hist\xF3rico de processamento"},notices:{noActiveNote:"Nenhuma nota ativa para processar",processedNotes:"Processadas {count} notas para Notelert",processedNote:"Processada: {filename} ({count} notifica\xE7\xF5es)",clearedHistory:"Hist\xF3rico de processamento limpo",errorCreatingNotification:"Erro ao criar notifica\xE7\xE3o: {title}",defaultTitle:"Lembrete"}}};function c(l,e,t){let o=O[l]||O.en,r=O.en,a=e.split("."),n=(u,d)=>{let p=u;for(let g of d)p=p?.[g];return p},s=n(o,a);if(typeof s!="string"&&o!==r&&(s=n(r,a)),typeof s!="string")return e;if(t)for(let[u,d]of Object.entries(t))s=s.replace(`{${u}}`,String(d));return s}var et=`${z}/scheduleEmailReminder`,$e=`${z}/cancelScheduledEmail`,le=25e3;async function de(l,e,t){let i=new AbortController,o=setTimeout(()=>i.abort(),le);try{let r=await fetch($e,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":e},body:JSON.stringify({notificationId:l,userId:t||null}),signal:i.signal,keepalive:!0});if(clearTimeout(o),!r.ok){let a;try{let n=await r.text();a=n?JSON.parse(n):{error:`HTTP ${r.status}`}}catch(n){a={error:`HTTP ${r.status}: ${r.statusText}`}}return r.status===401?{success:!1,error:a.error||a.message||"API Key inv\xE1lida o faltante"}:r.status===404?{success:!1,error:a.error||a.message||"Email programado no encontrado"}:r.status===408||r.status===504?{success:!1,error:"El servidor tard\xF3 demasiado en responder. Intenta de nuevo."}:{success:!1,error:a.error||a.message||`HTTP ${r.status}`}}return{success:!0}}catch(r){return clearTimeout(o),r.name==="AbortError"?{success:!1,error:"Timeout: El servidor no respondi\xF3 en 25 segundos. Puede ser un cold start. Intenta de nuevo."}:r.message?.includes("Failed to fetch")||r.message?.includes("NetworkError")?{success:!1,error:"Error de conexi\xF3n. Verifica tu internet e intenta de nuevo."}:{success:!1,error:r.message||"Error de red al cancelar email"}}}async function ue(l,e,t,i,o,r){let a=new AbortController,n=setTimeout(()=>a.abort(),le);try{let s={to:l,title:e,message:t,scheduledDate:i.toISOString(),notificationId:o,userEmail:l};if(!r||r.trim()==="")return{success:!1,error:"Token del plugin requerido. Configura tu token en Settings > Notelert > Plugin Token."};let u=await fetch(se,{method:"POST",headers:{"Content-Type":"application/json","X-Plugin-Token":r},body:JSON.stringify(s),signal:a.signal,keepalive:!0});if(clearTimeout(n),!u.ok){let p;try{let g=await u.text();p=g?JSON.parse(g):{error:`HTTP ${u.status}`}}catch(g){p={error:`HTTP ${u.status}: ${u.statusText}`}}return u.status===400?{success:!1,error:p.message||p.error||"Datos inv\xE1lidos"}:u.status===403?{success:!1,error:p.message||p.error||"Usuario no es premium o suscripci\xF3n expirada"}:u.status===404?{success:!1,error:p.message||p.error||"Usuario no encontrado. Debes registrarte primero en la app m\xF3vil."}:u.status===429?{success:!1,error:p.message||p.error||"L\xEDmite de emails alcanzado (m\xE1ximo 100)"}:{success:!1,error:p.message||p.error||`HTTP ${u.status}`}}let d;try{let p=await u.text();d=p?JSON.parse(p):{}}catch(p){d={notificationId:o}}return{success:!0,notificationId:d.notificationId||o}}catch(s){if(clearTimeout(n),s.name==="AbortError")return{success:!1,error:"Timeout: El servidor no respondi\xF3 en 25 segundos. Puede ser un cold start. Intenta de nuevo."};let u=s.message||String(s);return u.includes("Failed to fetch")||u.includes("NetworkError")||u.includes("Network request failed")||u.includes("CORS")?u.includes("CORS")?{success:!1,error:"Error de CORS. El servidor no permite la petici\xF3n. Verifica la configuraci\xF3n del token."}:{success:!1,error:`Error de conexi\xF3n: ${u}. Verifica tu internet e intenta de nuevo.`}:{success:!1,error:u||"Error de red al programar email"}}}function pe(){return`obsidian-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}var A=B(require("obsidian"));var ge=class{async search(e,t){let i=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(e)}&limit=5&addressdetails=1&extratags=1&accept-language=${t}`,o=await fetch(i,{method:"GET",headers:{"User-Agent":"Notelert-Obsidian-Plugin/1.0",Accept:"application/json","Accept-Language":t},referrerPolicy:"no-referrer"});if(!o.ok)throw new Error(`Nominatim error: ${o.status}`);let r=await o.json();return Array.isArray(r)?r.map(a=>{let n=a.address||{};return{name:n.road||n.city||n.town||n.village||a.display_name?.split(",")[0]||"Ubicaci\xF3n",latitude:parseFloat(a.lat),longitude:parseFloat(a.lon),address:a.display_name||a.name||"",displayName:a.display_name||a.name||"Ubicaci\xF3n sin nombre"}}):[]}},Q=class{constructor(e="",t=!0,i="",o,r,a){this.apiKey=e;this.useProxy=t;this.proxyUrl=i;this.userId=o;this.userEmail=r;this.pluginToken=a}async search(e,t){let i,o={};if(this.useProxy&&this.proxyUrl){if(!this.pluginToken||this.pluginToken.trim()==="")throw new Error("Token del plugin requerido para usar geocodificaci\xF3n premium. Configura tu token en Settings.");i=this.proxyUrl,o={method:"POST",headers:{"Content-Type":"application/json","X-Plugin-Token":this.pluginToken},body:JSON.stringify({query:e,language:t})}}else{if(!this.apiKey||this.apiKey.trim()==="")throw new Error("Google Maps API key requerida para llamada directa. Usa el proxy de Firebase en su lugar.");i=`https://maps.googleapis.com/maps/api/geocode/json?address=${encodeURIComponent(e)}&key=${this.apiKey}&language=${t}`}let r=await fetch(i,o);if(!r.ok){let n=await r.json().catch(()=>({}));throw new Error(`Google Maps error: ${r.status} ${r.statusText} - ${n.message||""}`)}let a=await r.json();if(this.useProxy&&this.proxyUrl){if(a.status==="ZERO_RESULTS"||a.results&&a.results.length===0)return[];if(a.status!=="OK"&&a.error)throw new Error(`Geocoding API error: ${a.error} - ${a.message||""}`);return(a.results||[]).map(n=>({name:n.name,latitude:n.latitude,longitude:n.longitude,address:n.address,displayName:n.displayName}))}if(a.status==="ZERO_RESULTS")return[];if(a.status!=="OK")throw new Error(`Google Maps API error: ${a.status} - ${a.error_message||"Unknown error"}`);return!a.results||a.results.length===0?[]:a.results.slice(0,5).map(n=>{let s=n.address_components||[];return{name:s.find(d=>d.types.includes("route"))?.long_name||s.find(d=>d.types.includes("locality"))?.long_name||n.formatted_address?.split(",")[0]||"Ubicaci\xF3n",latitude:n.geometry.location.lat,longitude:n.geometry.location.lng,address:n.formatted_address,displayName:n.formatted_address}})}},me=class{constructor(e){this.apiKey=e}async search(e,t){let i=`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(e)}.json?access_token=${this.apiKey}&limit=5&language=${t}`,o=await fetch(i);if(!o.ok)throw new Error(`Mapbox error: ${o.status}`);let r=await o.json();return r.features?r.features.slice(0,5).map(a=>{let[n,s]=a.center;return{name:a.text||a.place_name?.split(",")[0]||"Ubicaci\xF3n",latitude:s,longitude:n,address:a.place_name||a.text||"",displayName:a.place_name||a.text||"Ubicaci\xF3n"}}):[]}},he=class{constructor(e){this.apiKey=e}async search(e,t){let i=`https://us1.locationiq.com/v1/search.php?key=${this.apiKey}&q=${encodeURIComponent(e)}&format=json&limit=5&addressdetails=1&accept-language=${t}`,o=await fetch(i);if(!o.ok)throw new Error(`LocationIQ error: ${o.status}`);let r=await o.json();return Array.isArray(r)?r.map(a=>{let n=a.address||{};return{name:n.road||n.city||n.town||n.village||a.display_name?.split(",")[0]||"Ubicaci\xF3n",latitude:parseFloat(a.lat),longitude:parseFloat(a.lon),address:a.display_name||a.name||"",displayName:a.display_name||a.name||"Ubicaci\xF3n"}}):[]}},fe=class{constructor(e){this.apiKey=e}async search(e,t){let i=`https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(e)}&key=${this.apiKey}&limit=5&language=${t}`,o=await fetch(i);if(!o.ok)throw new Error(`OpenCage error: ${o.status}`);let r=await o.json();return r.status.code!==200||!r.results?[]:r.results.slice(0,5).map(a=>{let n=a.components||{};return{name:n.road||n.city||n.town||n.village||a.formatted?.split(",")[0]||"Ubicaci\xF3n",latitude:a.geometry.lat,longitude:a.geometry.lng,address:a.formatted||"",displayName:a.formatted||"Ubicaci\xF3n"}})}},be=class{constructor(e,t){this.apiKey=e;this.appId=t}async search(e,t){let o=await fetch("https://places-dsn.algolia.net/1/places/query",{method:"POST",headers:{"Content-Type":"application/json","X-Algolia-Application-Id":this.appId,"X-Algolia-API-Key":this.apiKey},body:JSON.stringify({query:e,language:t,hitsPerPage:5})});if(!o.ok)throw new Error(`Algolia Places error: ${o.status}`);let r=await o.json();return r.hits?r.hits.map(a=>({name:a.locale_names?.[0]||a.name||a.value||"Ubicaci\xF3n",latitude:a._geoloc?.lat||a.latlng?.lat,longitude:a._geoloc?.lng||a.latlng?.lng,address:a.value||a.name||"",displayName:a.value||a.name||"Ubicaci\xF3n"})):[]}};async function ye(l,e,t,i){let o=e.geocodingProvider||"nominatim";i?.(`Proveedor configurado: ${o}`);let r=[o,"nominatim"].filter((a,n,s)=>s.indexOf(a)===n);i?.(`Proveedores a intentar: ${r.join(", ")}`);for(let a of r)try{let n;switch(a){case"google":let u=e.useFirebaseProxy!==!1,d=e.firebaseGeocodingUrl||F;if(u&&d){if(i?.("Google Maps: Usando proxy Firebase (requiere token del plugin)"),!e.pluginToken||e.pluginToken.trim()===""){i?.("Google Maps: Token del plugin no configurado. Usando Nominatim como fallback.");continue}n=new Q("",!0,d,void 0,void 0,e.pluginToken)}else{let P=e.googleMapsApiKey?.trim()||"";if(!P){i?.("Google Maps: API key no configurada y proxy no disponible. Usando Nominatim como fallback.");continue}i?.("Google Maps: Usando API key del usuario (llamada directa)"),n=new Q(P,!1)}break;case"mapbox":let p=e.mapboxApiKey;if(!p||p.trim()===""){i?.("Mapbox: API key no configurada");continue}n=new me(p);break;case"locationiq":let g=e.locationiqApiKey;if(!g||g.trim()===""){i?.("LocationIQ: API key no configurada");continue}n=new he(g);break;case"opencage":let f=e.opencageApiKey;if(!f||f.trim()===""){i?.("OpenCage: API key no configurada");continue}n=new fe(f);break;case"algolia":let h=e.algoliaApiKey,b=e.algoliaAppId;if(!h||!b||h.trim()===""||b.trim()===""){i?.("Algolia: API key o App ID no configurados");continue}n=new be(h,b);break;default:n=new ge}i?.(`Buscando con ${a}...`);let s=await n.search(l,t);if(s.length>0)return i?.(`\u2705 Encontrados ${s.length} resultados con ${a}`),s;i?.(`\u26A0\uFE0F ${a} no devolvi\xF3 resultados, intentando siguiente proveedor...`)}catch(n){let s=n?.message||String(n);i?.(`\u274C Error con ${a}: ${s}`);continue}return i?.("\u274C Todos los proveedores fallaron"),[]}var U=class extends A.Modal{constructor(e,t,i,o,r,a,n){super(e);this.selectedLocation=null;this.searchTimeout=null;this.searchResults=[];this.map=null;this.mapMarker=null;this.mapLoaded=!1;this.plugin=t,this.language=i,typeof o=="function"?(this.onSelect=o,r&&!r.line&&(this.selectedLocation=r)):(this.editor=o,this.cursor=r,this.originalText=a||"",this.onCancel=n||(()=>{}))}onOpen(){let{contentEl:e}=this;e.empty(),e.setAttribute("style",`
      min-width: 320px; 
      max-width: 700px; 
      width: 90vw;
      max-height: 90vh; 
      overflow: hidden;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      margin: 0 auto;
    `);let t=e.createEl("div",{attr:{style:`
          flex: 1;
          overflow-y: auto;
          overflow-x: hidden;
          padding-right: 5px;
          margin-bottom: 10px;
        `}});t.id="notelert-modal-scroll-container",t.createEl("h2",{text:c(this.language,"locationPicker.title")||"Seleccionar Ubicaci\xF3n",attr:{style:"margin: 0 0 15px 0; font-size: 20px; font-weight: 600;"}}),t.createEl("p",{text:c(this.language,"locationPicker.selectLocation")||"Busca una direcci\xF3n o haz clic en el mapa para seleccionar una ubicaci\xF3n",attr:{style:"color: var(--text-muted); font-size: 13px; margin-bottom: 15px; font-style: italic; line-height: 1.4;"}});let i=t.createEl("div",{cls:"notelert-location-search"});i.setAttribute("style",`
      margin-bottom: 15px; 
      position: relative;
      z-index: 1000;
    `);let o=i.createEl("input",{type:"text",placeholder:c(this.language,"locationPicker.searchPlaceholder")||"Buscar direcci\xF3n...",cls:"notelert-location-input"});o.setAttribute("style",`
      width: 100%; 
      padding: 12px; 
      border: 1px solid var(--background-modifier-border); 
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
      background: var(--background-primary);
      color: var(--text-normal);
    `);let r=i.createEl("div",{cls:"notelert-location-results"});r.setAttribute("style",`
      position: absolute;
      top: calc(100% + 4px);
      left: 0;
      right: 0;
      max-height: 200px; 
      overflow-y: auto; 
      border: 1px solid var(--background-modifier-border); 
      border-radius: 6px; 
      display: none;
      background: var(--background-primary);
      z-index: 1001;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    `),r.id="location-results-container";let a=t.createEl("div",{cls:"notelert-map-container"});a.setAttribute("style",`
      width: 100%;
      height: 250px;
      min-height: 200px;
      margin: 15px 0;
      border: 1px solid var(--background-modifier-border);
      border-radius: 6px;
      overflow: hidden;
      background: var(--background-secondary);
      position: relative;
    `),a.id="notelert-map-container";let n=a.createEl("div",{attr:{style:`
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          color: var(--text-muted);
          font-size: 14px;
          z-index: 1000;
          text-align: center;
          padding: 15px;
          background: var(--background-primary);
          border: 2px solid var(--text-error);
          border-radius: 6px;
          max-width: 90%;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        `}});n.id="map-loading",n.innerHTML=`
      <div style="font-weight: 500; margin-bottom: 8px;">${c(this.language,"locationPicker.loadingMap")}</div>
    `;let s=t.createEl("div",{cls:"notelert-location-selected"});s.setAttribute("style",`
      margin: 15px 0; 
      padding: 15px; 
      background: var(--background-secondary); 
      border-radius: 6px; 
      display: none; 
      word-wrap: break-word;
      border: 2px solid var(--interactive-accent);
    `),s.id="location-selected-container";let u=t.createEl("div",{cls:"notelert-location-favorites"});u.setAttribute("style","margin: 15px 0;"),u.createEl("div",{attr:{style:`
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 10px;
          cursor: pointer;
        `}}).createEl("h3",{text:c(this.language,"locationPicker.favorites")||"Ubicaciones Favoritas",attr:{style:"font-size: 16px; font-weight: 500; margin: 0;"}});let p=u.createEl("div",{cls:"notelert-location-favorites-list"});p.setAttribute("style",`
      max-height: 150px; 
      overflow-y: auto;
      margin-top: 10px;
    `),this.renderFavorites(p);let g=e.createEl("div",{cls:"notelert-locationpicker-buttons"});g.setAttribute("style",`
      display: flex; 
      gap: 10px; 
      justify-content: flex-end; 
      margin-top: 10px; 
      flex-wrap: wrap;
      flex-shrink: 0;
      padding-top: 10px;
      border-top: 1px solid var(--background-modifier-border);
    `);let f=g.createEl("button",{text:c(this.language,"locationPicker.cancelButton"),cls:"mod-secondary"});f.setAttribute("style",`
      flex: 1; 
      min-width: 100px; 
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 6px;
    `),f.addEventListener("click",()=>{this.onCancel&&this.onCancel(),this.close()});let h=g.createEl("button",{text:c(this.language,"locationPicker.confirmButton"),cls:"mod-cta"});h.id="confirm-location-button",h.setAttribute("disabled","true"),h.setAttribute("style",`
      flex: 1; 
      min-width: 100px; 
      padding: 10px 20px;
      font-size: 14px;
      border-radius: 6px;
      opacity: 0.5;
      cursor: not-allowed;
    `),h.addEventListener("click",()=>{this.selectedLocation&&(this.onSelect?this.onSelect(this.selectedLocation):this.createNotificationFromLocation(this.selectedLocation.name,this.selectedLocation.latitude,this.selectedLocation.longitude,100),this.close())}),o.addEventListener("input",b=>{let P=b.target.value.trim();if(this.searchTimeout&&clearTimeout(this.searchTimeout),P.length<3){r.style.display="none";let k=o.parentElement;k&&k.style.position!=="relative"&&(k.style.position="relative");return}this.searchTimeout=window.setTimeout(()=>{this.searchLocations(P,r)},500)}),this.loadGoogleMap()}loadGoogleMap(){if(this.addDebugInfo("Iniciando carga de Google Maps..."),window.google&&window.google.maps){this.addDebugInfo("\u2705 Google Maps ya est\xE1 cargado"),this.mapLoaded=!0,setTimeout(()=>this.initMap(),100);return}if(document.querySelector('script[src*="maps.googleapis.com"]')){this.addDebugInfo("\u23F3 Script de Google Maps ya est\xE1 siendo cargado, esperando...");let a=0,n=50,s=setInterval(()=>{a++,window.google&&window.google.maps?(clearInterval(s),this.addDebugInfo("\u2705 Google Maps cargado despu\xE9s de esperar"),this.mapLoaded=!0,setTimeout(()=>this.initMap(),100)):a>=n&&(clearInterval(s),this.addDebugInfo("\u274C Timeout esperando que se cargue el script existente"),this.showMapError("Timeout","El script estaba carg\xE1ndose pero no se complet\xF3. Intenta recargar la p\xE1gina."))},100);return}let t=`initNotelertMap_${Date.now()}`;this.addDebugInfo(`\u{1F4DD} Creando callback: ${t}`);let i=this.plugin.settings.googleMapsApiKey?.trim()||"";if(!i){this.addDebugInfo("\u26A0\uFE0F API key de Google Maps no configurada"),this.addDebugInfo("\u2139\uFE0F El mapa interactivo no estar\xE1 disponible, pero puedes buscar ubicaciones usando el campo de b\xFAsqueda"),this.showMapError("Mapa no disponible","Para usar el mapa interactivo, configura tu API key de Google Maps en Settings.<br><br>La b\xFAsqueda de ubicaciones seguir\xE1 funcionando usando el proxy de Firebase.");return}let o=document.createElement("script"),r=`https://maps.googleapis.com/maps/api/js?key=${i}&libraries=places&callback=${t}`;o.src=r,o.async=!0,o.defer=!0,this.addDebugInfo("\u{1F4E1} Cargando script de Google Maps..."),o.onerror=a=>{this.addDebugInfo("\u274C Error en script.onerror");let n=`
        <strong>Error cargando script:</strong><br>
        Verifica:<br>
        - Tu conexi\xF3n a internet<br>
        - Que la API key sea v\xE1lida<br>
        - Que la Geocoding API est\xE9 habilitada en Google Cloud<br>
        - Que la Maps JavaScript API est\xE9 habilitada en Google Cloud
      `;this.showMapError("Error al cargar Google Maps. Verifica tu conexi\xF3n a internet.",n),delete window[t]},window[t]=()=>{this.addDebugInfo("\u2705 Callback ejecutado - Google Maps cargado"),this.mapLoaded=!0,delete window[t],setTimeout(()=>this.initMap(),100)},document.head.appendChild(o),this.addDebugInfo("\u{1F4E6} Script a\xF1adido al DOM"),setTimeout(()=>{if(!this.mapLoaded&&!this.map){this.addDebugInfo("\u23F1\uFE0F Timeout despu\xE9s de 10 segundos");let a=`
          <strong>Timeout cargando el mapa:</strong><br>
          Estado: mapLoaded=${this.mapLoaded}, map=${this.map?"existe":"null"}<br>
          Google disponible: ${window.google?"s\xED":"no"}<br>
          Verifica:<br>
          - Tu conexi\xF3n a internet<br>
          - Que no haya bloqueadores de scripts<br>
          - La consola del navegador para m\xE1s detalles
        `;this.showMapError("Timeout cargando el mapa. Intenta recargar.",a)}},1e4)}showMapError(e,t){let i=document.getElementById("map-loading"),o=document.getElementById("map-debug-info");i&&(i.innerHTML=`
        <div style="color: var(--text-error); font-weight: 500; margin-bottom: 8px;">${c(this.language,"locationPicker.mapError")}</div>
        <div style="color: var(--text-muted); font-size: 12px; margin-bottom: 8px;">${e}</div>
        ${t?`<div id="map-debug-info" style="font-size: 11px; color: var(--text-muted); text-align: left; max-height: 100px; overflow-y: auto; background: var(--background-secondary); padding: 8px; border-radius: 4px; margin-top: 8px;">${t}</div>`:""}
      `),o&&t&&(o.innerHTML=t,o.style.display="block")}addDebugInfo(e){let t=document.getElementById("map-debug-info");if(t){let i=new Date().toLocaleTimeString(),o=t.innerHTML||"",r=e.includes("\u274C")||e.includes("Error")||e.includes("Excepci\xF3n")?"var(--text-error)":e.includes("\u2705")?"var(--text-success)":e.includes("\u26A0\uFE0F")?"var(--text-warning)":"var(--text-normal)",a=e.includes("\u274C")||e.includes("Error")||e.includes("Excepci\xF3n")?"rgba(255, 0, 0, 0.1)":e.includes("\u2705")?"rgba(0, 255, 0, 0.1)":"transparent";t.innerHTML=`${o}<div style="margin: 4px 0; padding: 6px 8px; font-size: 11px; color: ${r}; background: ${a}; border-left: 3px solid ${r}; border-radius: 3px; word-wrap: break-word; white-space: pre-wrap;"><span style="opacity: 0.7;">[${i}]</span> ${e}</div>`;let n=document.getElementById("notelert-debug-container");n&&(n.scrollTop=n.scrollHeight)}this.plugin.log(`[Mapa] ${e}`)}initMap(){try{this.addDebugInfo("\u{1F5FA}\uFE0F Iniciando inicializaci\xF3n del mapa...");let e=document.getElementById("notelert-map-container");if(!e){this.addDebugInfo("\u274C Contenedor del mapa no encontrado"),this.showMapError(c(this.language,"locationPicker.mapErrorTitle"),"El elemento #notelert-map-container no existe en el DOM");return}if(this.addDebugInfo("\u2705 Contenedor encontrado"),!window.google){this.addDebugInfo("\u274C window.google no existe"),this.showMapError("Google Maps no est\xE1 disponible","window.google no est\xE1 definido. El script no se carg\xF3 correctamente.");return}if(!window.google.maps){this.addDebugInfo("\u274C window.google.maps no existe"),this.showMapError("Google Maps API no disponible","window.google.maps no est\xE1 definido. Verifica que el script se carg\xF3 correctamente.");return}this.addDebugInfo("\u2705 Google Maps API disponible");let t=document.getElementById("map-loading");t&&(t.style.display="none",this.addDebugInfo("\u2705 Mensaje de carga ocultado"));let i=this.selectedLocation?{lat:this.selectedLocation.latitude,lng:this.selectedLocation.longitude}:{lat:40.4168,lng:-3.7038};this.addDebugInfo(`\u{1F4CD} Centro: ${i.lat}, ${i.lng}`),this.addDebugInfo("\u{1F528} Creando instancia del mapa...");try{this.map=new window.google.maps.Map(e,{center:i,zoom:13,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,zoomControl:!1,disableDefaultUI:!1,gestureHandling:"cooperative"}),this.addDebugInfo("\u2705 Mapa creado"),setTimeout(()=>{let o=document.getElementById("map-loading");o&&(o.style.display="none",this.addDebugInfo("\u2705 Mensaje de carga ocultado"))},500);try{this.map.addListener("error",o=>{this.addDebugInfo(`\u274C Error en el mapa (listener): ${o?.message||JSON.stringify(o)}`),this.showMapError("Error al cargar el mapa",`Error del mapa: ${o?.message||"Error desconocido"}`)})}catch(o){this.addDebugInfo(`\u26A0\uFE0F No se pudo a\xF1adir listener de errores: ${o}`)}setTimeout(()=>{this.checkMapStatus()},2e3)}catch(o){throw this.addDebugInfo(`\u274C Excepci\xF3n al crear mapa: ${o?.message||o}`),this.addDebugInfo(`Stack: ${o?.stack?.substring(0,200)||"No stack"}`),o}this.map.addListener("click",o=>{let r=o.latLng.lat(),a=o.latLng.lng();this.addDebugInfo(`\u{1F5B1}\uFE0F Click en mapa: ${r}, ${a}`),this.reverseGeocode(r,a)}),this.selectedLocation&&(this.addDebugInfo(`\u{1F4CD} Mostrando ubicaci\xF3n seleccionada: ${this.selectedLocation.name}`),this.updateMapMarker(this.selectedLocation.latitude,this.selectedLocation.longitude)),this.addDebugInfo("\u2705 Mapa inicializado correctamente")}catch(e){let t=e?.message||String(e),i=e?.stack||"No hay stack trace";this.addDebugInfo(`\u274C Excepci\xF3n: ${t}`),this.addDebugInfo(`Stack: ${i.substring(0,300)}`);let o=`
        <strong>Error al inicializar el mapa:</strong><br>
        Mensaje: ${t}<br>
        Stack: ${i.substring(0,200)}...<br>
        Tipo: ${e?.name||"Unknown"}
      `;this.showMapError(`Error: ${t}`,o)}}checkMapStatus(){this.addDebugInfo("\u{1F50D} Verificando estado del mapa...");let e=document.getElementById("notelert-map-container");if(!e){this.addDebugInfo("\u274C Contenedor no encontrado en verificaci\xF3n");return}this.addDebugInfo(`\u{1F4E6} Contenedor encontrado, tama\xF1o: ${e.offsetWidth}x${e.offsetHeight}`);let t=null,i="",o=e.querySelectorAll("div");this.addDebugInfo(`\u{1F50E} Buscando en ${o.length} elementos div...`);for(let a of Array.from(o)){let n=a.innerText||a.textContent||"",s=n.toLowerCase();if(s.includes("no ha cargado")||s.includes("no se ha podido cargar")||s.includes("something went wrong")||s.includes("error")||s.includes("forbidden")||s.includes("unauthorized")||s.includes("api key")){t=a,i=n,this.addDebugInfo(`\u274C Error encontrado: "${n.substring(0,100)}"`);break}}if(!t){let a=e.querySelectorAll('div[style*="error"], div[style*="Error"], div[class*="error"]');a.length>0&&(t=a[0],i=t.innerText||t.textContent||"",this.addDebugInfo(`\u274C Error encontrado por estilo: "${i.substring(0,100)}"`))}let r=e.querySelectorAll("iframe");if(this.addDebugInfo(`\u{1F5BC}\uFE0F Iframes encontrados: ${r.length}`),r.length>0)for(let a of Array.from(r))this.addDebugInfo(`  - Iframe src: ${a.src.substring(0,80)}...`);if(t){this.addDebugInfo(`\u274C Error de Google Maps detectado: ${i}`),this.showMapError(c(this.language,"locationPicker.googleMapsError"),`
        <strong>Error detectado:</strong><br>
        ${i}<br><br>
        <strong>Posibles causas:</strong><br>
        - API key inv\xE1lida o sin permisos<br>
        - Maps JavaScript API no habilitada (no solo Geocoding)<br>
        - Restricciones de la API key muy estrictas<br>
        - L\xEDmite de uso excedido<br>
        - Problema de conexi\xF3n<br><br>
        <strong>Verifica en Google Cloud Console:</strong><br>
        1. Que "Maps JavaScript API" est\xE9 habilitada<br>
        2. Que la API key tenga permisos para Maps JavaScript API<br>
        3. Que las restricciones de la API key permitan tu uso
      `);return}if(this.map){this.addDebugInfo("\u{1F5FA}\uFE0F Mapa existe, verificando tiles...");let a=e.querySelectorAll('img[src*="maps.googleapis.com"], img[src*="googleapis"], img[src*="gstatic"]');if(this.addDebugInfo(`\u{1F5BC}\uFE0F Tiles encontrados: ${a.length}`),a.length===0){this.addDebugInfo("\u26A0\uFE0F No se detectaron tiles del mapa cargados"),this.addDebugInfo("\u{1F50D} Buscando cualquier imagen en el contenedor...");let n=e.querySelectorAll("img");this.addDebugInfo(`\u{1F4F8} Total im\xE1genes: ${n.length}`);for(let u of Array.from(n))this.addDebugInfo(`  - Imagen src: ${u.src.substring(0,80)}...`);let s=e.innerHTML.substring(0,500);this.addDebugInfo(`\u{1F4C4} Primeros 500 chars del HTML: ${s}`),this.showMapError("El mapa no muestra tiles",'El mapa se cre\xF3 pero no se est\xE1n cargando las im\xE1genes. Verifica tu conexi\xF3n y la API key. Aseg\xFArate de que "Maps JavaScript API" est\xE9 habilitada en Google Cloud.')}else{this.addDebugInfo(`\u2705 Mapa verificado: ${a.length} tiles cargados`);let n=document.getElementById("map-loading");n&&(n.style.display="none")}}else this.addDebugInfo("\u26A0\uFE0F Mapa no est\xE1 definido en verificaci\xF3n");setTimeout(()=>{this.addDebugInfo("\u{1F50D} Verificaci\xF3n adicional despu\xE9s de 3 segundos..."),this.checkMapStatusDelayed()},3e3)}checkMapStatusDelayed(){let e=document.getElementById("notelert-map-container");if(!e)return;let t=e.innerText||e.textContent||"";t.toLowerCase().includes("error")||t.toLowerCase().includes("no ha cargado")||t.toLowerCase().includes("forbidden")?(this.addDebugInfo(`\u274C Error detectado en verificaci\xF3n tard\xEDa: ${t.substring(0,200)}`),this.showMapError("Error detectado en el mapa",t.substring(0,300))):this.addDebugInfo("\u2705 No se detectaron errores en verificaci\xF3n tard\xEDa")}async reverseGeocode(e,t){try{new window.google.maps.Geocoder().geocode({location:{lat:e,lng:t}},(o,r)=>{if(r==="OK"&&o[0]){let a=o[0],n=a.formatted_address,s=a.address_components[0]?.long_name||a.address_components[1]?.long_name||"Ubicaci\xF3n seleccionada";this.selectLocation({name:s,latitude:e,longitude:t,radius:100,address:n}),this.updateMapMarker(e,t)}else this.selectLocation({name:`Ubicaci\xF3n (${e.toFixed(6)}, ${t.toFixed(6)})`,latitude:e,longitude:t,radius:100}),this.updateMapMarker(e,t)})}catch(i){this.plugin.log(`Error en geocodificaci\xF3n inversa: ${i}`),this.selectLocation({name:`Ubicaci\xF3n (${e.toFixed(6)}, ${t.toFixed(6)})`,latitude:e,longitude:t,radius:100}),this.updateMapMarker(e,t)}}updateMapMarker(e,t){!this.map||(this.mapMarker&&this.mapMarker.setMap(null),this.mapMarker=new window.google.maps.Marker({position:{lat:e,lng:t},map:this.map,draggable:!0,animation:window.google.maps.Animation.DROP}),this.mapMarker.addListener("dragend",i=>{let o=i.latLng.lat(),r=i.latLng.lng();this.reverseGeocode(o,r)}),this.map.setCenter({lat:e,lng:t}))}onClose(){let{contentEl:e}=this;e.empty(),this.searchTimeout&&clearTimeout(this.searchTimeout),this.mapMarker&&(this.mapMarker.setMap(null),this.mapMarker=null),this.map=null,this.mapLoaded=!1}async searchLocations(e,t){try{let i=this.plugin.settings.useFirebaseProxy!==!1,o=this.plugin.settings.geocodingProvider||"nominatim";if((o==="google"&&i||o==="google")&&(!this.plugin.settings.pluginToken||this.plugin.settings.pluginToken.trim()==="")){t.style.display="block",t.innerHTML=`
            <div style='padding: 20px; text-align: center;'>
              <div style='color: var(--text-error); margin-bottom: 12px; font-weight: 600;'>
                \u{1F511} Token del plugin requerido
              </div>
              <div style='color: var(--text-muted); font-size: 13px; line-height: 1.6;'>
                Para usar geocodificaci\xF3n premium (Google Maps), necesitas:<br/>
                1. Tener plan Premium activo<br/>
                2. Generar tu token en la app m\xF3vil (Settings > Token del Plugin)<br/>
                3. Pegar el token en Settings > Notelert > Plugin Token<br/><br/>
                <em>Nota: Puedes usar Nominatim (gratis) cambiando el proveedor en Settings.</em>
              </div>
            </div>
          `,new A.Notice("\u{1F511} Token del plugin requerido para geocodificaci\xF3n premium");return}t.style.display="block",t.innerHTML=`<div style='padding: 20px; text-align: center; color: var(--text-muted);'>${c(this.language,"locationPicker.searching")||"Buscando..."}</div>`,this.plugin.log(`Buscando ubicaciones: ${e}`);let r=await ye(e,this.plugin.settings,this.language||"es",a=>this.plugin.log(a));if(this.plugin.log(`Resultados encontrados: ${r.length}`),r.length===0){t.innerHTML=`<div style='padding: 20px; text-align: center; color: var(--text-muted);'>${c(this.language,"locationPicker.noResults")||"No se encontraron resultados"}</div>`;return}t.innerHTML="",r.forEach(a=>{try{let n=t.createEl("div",{cls:"notelert-location-result-item"});n.setAttribute("style","padding: 12px; margin: 5px 0; border: 1px solid var(--background-modifier-border); border-radius: 4px; cursor: pointer; transition: background 0.2s; word-wrap: break-word;"),n.addEventListener("mouseenter",()=>{n.style.background="var(--background-modifier-hover)"}),n.addEventListener("mouseleave",()=>{n.style.background=""}),n.createEl("div",{text:a.name,attr:{style:"font-weight: 500; margin-bottom: 4px;"}}),n.createEl("div",{text:a.displayName.length>80?a.displayName.substring(0,80)+"...":a.displayName,attr:{style:"font-size: 11px; color: var(--text-muted);"}}),n.addEventListener("click",()=>{if(isNaN(a.latitude)||isNaN(a.longitude)){this.plugin.log(`Coordenadas inv\xE1lidas: lat=${a.latitude}, lon=${a.longitude}`),new A.Notice(c(this.language,"locationPicker.error")||"Error: Coordenadas inv\xE1lidas");return}this.selectLocation({name:a.name,latitude:a.latitude,longitude:a.longitude,radius:100,address:a.displayName}),this.map&&this.updateMapMarker(a.latitude,a.longitude)})}catch(n){this.plugin.log(`Error procesando resultado: ${n}`)}})}catch(i){let o=i?.message||String(i);this.plugin.log(`Error buscando ubicaciones: ${o}`),this.plugin.log(`Stack: ${i?.stack||"No stack trace"}`);let r=c(this.language,"locationPicker.error")||"Error al buscar ubicaciones";o.includes("CORS")||o.includes("Failed to fetch")?r=c(this.language,"locationPicker.connectionError")||"Error de conexi\xF3n. Verifica tu conexi\xF3n a internet.":o.includes("429")?r=c(this.language,"locationPicker.rateLimit")||"Demasiadas solicitudes. Espera un momento antes de buscar de nuevo.":o.includes("API key")?r=c(this.language,"locationPicker.apiKeyError")||"Error: API key no configurada o inv\xE1lida. Verifica la configuraci\xF3n.":o&&(r=`${c(this.language,"locationPicker.error")||"Error"}: ${o}`),t.innerHTML=`<div style='padding: 20px; text-align: center; color: var(--text-error);'>${r}</div>`}}selectLocation(e){this.selectedLocation=e;let t=document.getElementById("location-selected-container"),i=document.getElementById("confirm-location-button"),o=document.getElementById("location-results-container");if(t&&i){t.style.display="block";let r=c(this.language,"locationPicker.saveFavorite")||"\u2B50 Guardar";t.innerHTML=`
        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 10px;">
          <div style="flex: 1; min-width: 200px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
              <span style="font-size: 18px;">\u{1F4CD}</span>
              <strong style="word-wrap: break-word; font-size: 15px;">${e.name}</strong>
            </div>
            <small style="color: var(--text-muted); word-wrap: break-word; display: block; margin-bottom: 4px;">${e.address||""}</small>
            <small style="color: var(--text-muted); font-size: 10px;">Lat: ${e.latitude.toFixed(6)}, Lon: ${e.longitude.toFixed(6)}</small>
          </div>
          <button id="save-favorite-btn" class="mod-secondary" style="padding: 4px 8px; font-size: 12px; white-space: nowrap; flex-shrink: 0;">${r}</button>
        </div>
      `;let a=document.getElementById("save-favorite-btn");a&&a.addEventListener("click",async()=>{await this.saveAsFavorite(e)&&(a.textContent=c(this.language,"locationPicker.saved")||"\u2713 Guardado",a.setAttribute("disabled","true"))}),i.removeAttribute("disabled"),i.style.opacity="1",i.style.cursor="pointer"}o&&(o.style.display="none"),this.map&&this.updateMapMarker(e.latitude,e.longitude)}async saveAsFavorite(e){return new Promise(t=>{let i=document.createElement("div");i.setAttribute("style",`
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
      `);let o=i.createEl("div");o.setAttribute("style",`
        background: var(--background-primary);
        border: 1px solid var(--background-modifier-border);
        border-radius: 8px;
        padding: 20px;
        max-width: 400px;
        width: 90%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      `),o.createEl("h3",{text:c(this.language,"locationPicker.nameLocationTitle"),attr:{style:"margin: 0 0 15px 0; font-size: 18px;"}});let r=o.createEl("input",{type:"text",value:e.name,placeholder:c(this.language,"locationPicker.nameLocationPlaceholder"),attr:{style:`
            width: 100%;
            padding: 10px;
            border: 1px solid var(--background-modifier-border);
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
            margin-bottom: 15px;
            background: var(--background-primary);
            color: var(--text-normal);
          `}});setTimeout(()=>r.select(),50);let a=o.createEl("div");a.setAttribute("style","display: flex; gap: 10px; justify-content: flex-end;");let n=a.createEl("button",{text:c(this.language,"locationPicker.nameLocationCancel"),cls:"mod-secondary",attr:{style:"padding: 8px 16px;"}}),s=a.createEl("button",{text:c(this.language,"locationPicker.nameLocationConfirm"),cls:"mod-cta",attr:{style:"padding: 8px 16px;"}}),u=async()=>{let d=r.value.trim();if(!d){r.focus();return}let p={name:d,latitude:e.latitude,longitude:e.longitude,radius:e.radius,address:e.address};if(!this.plugin.settings.savedLocations.some(f=>f.latitude===e.latitude&&f.longitude===e.longitude)){this.plugin.settings.savedLocations.push(p),await this.plugin.saveSettings();let f=document.querySelector(".notelert-location-favorites-list");f&&this.renderFavorites(f)}document.body.removeChild(i),t(!0)};n.addEventListener("click",()=>{document.body.removeChild(i),t(!1)}),s.addEventListener("click",u),r.addEventListener("keydown",d=>{d.key==="Enter"?u():d.key==="Escape"&&(document.body.removeChild(i),t(!1))}),i.addEventListener("click",d=>{d.target===i&&(document.body.removeChild(i),t(!1))}),document.body.appendChild(i),r.focus()})}async deleteFavorite(e){let t=this.plugin.settings.savedLocations.findIndex(i=>i.name===e.name&&i.latitude===e.latitude&&i.longitude===e.longitude);t!==-1&&(this.plugin.settings.savedLocations.splice(t,1),await this.plugin.saveSettings(),this.plugin.log(`Ubicaci\xF3n favorita eliminada: ${e.name}`))}renderFavorites(e){e.innerHTML="";let t=this.plugin.settings.savedLocations||[];t.length===0?e.createEl("p",{text:c(this.language,"locationPicker.noFavorites")||"No hay ubicaciones guardadas",attr:{style:"color: var(--text-muted); font-size: 12px; padding: 10px; text-align: center;"}}):t.forEach((i,o)=>{let r=e.createEl("div",{cls:"notelert-location-favorite-item"});r.setAttribute("style","padding: 10px; margin: 5px 0; border: 1px solid var(--background-modifier-border); border-radius: 4px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; flex-wrap: wrap; gap: 8px;"),r.addEventListener("mouseenter",()=>{r.style.background="var(--background-modifier-hover)"}),r.addEventListener("mouseleave",()=>{r.style.background=""});let a=r.createEl("div");a.setAttribute("style","flex: 1; min-width: 0; margin-right: 10px;"),a.createEl("div",{text:i.name,attr:{style:"font-weight: 500; margin-bottom: 4px; word-wrap: break-word;"}}),i.address&&a.createEl("div",{text:i.address.length>50?i.address.substring(0,50)+"...":i.address,attr:{style:"font-size: 11px; color: var(--text-muted); word-wrap: break-word;"}});let n=r.createEl("div");n.setAttribute("style","display: flex; gap: 6px; flex-shrink: 0;");let s=n.createEl("button",{text:c(this.language,"locationPicker.selectButton")||"Seleccionar",cls:"mod-secondary"});s.setAttribute("style","padding: 4px 12px; font-size: 12px; white-space: nowrap;"),s.addEventListener("click",d=>{d.stopPropagation(),this.selectLocation({name:i.name,latitude:i.latitude,longitude:i.longitude,radius:i.radius,address:i.address}),this.map&&this.updateMapMarker(i.latitude,i.longitude)});let u=n.createEl("button",{text:"\u{1F5D1}\uFE0F",title:c(this.language,"locationPicker.deleteButton")||"Eliminar"});u.setAttribute("style","padding: 4px 8px; font-size: 14px; background: var(--background-modifier-border); border: 1px solid var(--background-modifier-border); border-radius: 4px; cursor: pointer; color: var(--text-error);"),u.addEventListener("click",async d=>{d.stopPropagation(),await this.deleteFavorite(i),this.renderFavorites(e)})})}async createNotificationFromLocation(e,t,i,o){try{let r=`:#${e}`,a=this.editor.getLine(this.cursor.line),n=a.substring(0,this.cursor.ch-2),s=a.substring(this.cursor.ch),u=n+r+s;this.editor.setLine(this.cursor.line,u);let d={line:this.cursor.line,ch:n.length+r.length};this.editor.setCursor(d);let p={text:u.trim(),title:this.extractTitleFromText(u,r),message:u.trim(),date:new Date().toISOString().split("T")[0],time:"00:00",fullMatch:r,startIndex:0,endIndex:u.length,filePath:this.plugin.app.workspace.getActiveFile()?.path,lineNumber:this.cursor.line+1,location:e,latitude:t,longitude:i,radius:o};await this.plugin.createNotificationAndMarkProcessed(p),this.plugin.log(`Notificaci\xF3n de ubicaci\xF3n creada: ${p.title} en ${e}`)}catch(r){this.plugin.log(`Error creando notificaci\xF3n de ubicaci\xF3n: ${r}`),new A.Notice(c(this.language,"notices.errorCreatingNotification",{title:"Recordatorio de ubicaci\xF3n"}))}}extractTitleFromText(e,t){let i=e.replace(t,"").trim();return i=i.replace(/\s+/g," ").trim(),i.length>50&&(i=i.substring(0,47)+"..."),i||"Recordatorio de ubicaci\xF3n"}};var W=class extends E.PluginSettingTab{constructor(e,t){super(e,t);this.plugin=t}display(){let{containerEl:e}=this;e.empty();let t=!E.Platform.isMobile;e.createEl("h2",{text:c(this.plugin.settings.language,"settings.title")});let i=e.createEl("div",{attr:{style:`
          padding: 15px;
          margin-bottom: 20px;
          background: var(--background-secondary);
          border-radius: 8px;
          border-left: 4px solid var(--interactive-accent);
        `}});t?(i.createEl("h4",{text:c(this.plugin.settings.language,"settings.platformInfo.desktopTitle"),attr:{style:"margin: 0 0 8px 0; font-size: 16px; font-weight: 600;"}}),i.createEl("p",{text:c(this.plugin.settings.language,"settings.platformInfo.desktopDesc"),attr:{style:"margin: 0; color: var(--text-muted); font-size: 13px; line-height: 1.5;"}})):(i.createEl("h4",{text:c(this.plugin.settings.language,"settings.platformInfo.mobileTitle"),attr:{style:"margin: 0 0 8px 0; font-size: 16px; font-weight: 600;"}}),i.createEl("p",{text:c(this.plugin.settings.language,"settings.platformInfo.mobileDesc"),attr:{style:"margin: 0; color: var(--text-muted); font-size: 13px; line-height: 1.5;"}})),e.createEl("h3",{text:c(this.plugin.settings.language,"settings.basicSettings")}),new E.Setting(e).setName(c(this.plugin.settings.language,"settings.language")).setDesc(c(this.plugin.settings.language,"settings.languageDesc")).addDropdown(r=>{_.forEach(a=>{r.addOption(a.code,`${a.nativeName} (${a.name})`)}),r.setValue(this.plugin.settings.language),r.onChange(async a=>{this.plugin.settings.language=a,await this.plugin.saveSettings(),this.display()})}),new E.Setting(e).setName(c(this.plugin.settings.language,"settings.debugMode")).setDesc(c(this.plugin.settings.language,"settings.debugModeDesc")).addToggle(r=>r.setValue(this.plugin.settings.debugMode).onChange(async a=>{this.plugin.settings.debugMode=a,await this.plugin.saveSettings()})),e.createEl("h3",{text:c(this.plugin.settings.language,"settings.pluginToken.title")});let o=t?c(this.plugin.settings.language,"settings.pluginToken.descDesktop"):c(this.plugin.settings.language,"settings.pluginToken.descMobile");if(new E.Setting(e).setName(c(this.plugin.settings.language,"settings.pluginToken.title")).setDesc(o).addText(r=>{r.setPlaceholder(c(this.plugin.settings.language,"settings.pluginToken.placeholder")).setValue(this.plugin.settings.pluginToken||"").inputEl.type="password",r.onChange(async a=>{this.plugin.settings.pluginToken=a.trim(),await this.plugin.saveSettings()})}).addButton(r=>{r.setButtonText(c(this.plugin.settings.language,"settings.pluginToken.showHide")).setCta(!1).onClick(()=>{let a=e.querySelector('input[type="password"]');a&&(a.type=a.type==="password"?"text":"password")})}),t){e.createEl("h3",{text:c(this.plugin.settings.language,"settings.desktopSettings.title")}),new E.Setting(e).setName(c(this.plugin.settings.language,"settings.desktopSettings.userEmailTitle")).setDesc(c(this.plugin.settings.language,"settings.desktopSettings.userEmailDesc")).addText(n=>{n.setPlaceholder(c(this.plugin.settings.language,"settings.desktopSettings.userEmailPlaceholder")).setValue(this.plugin.settings.userEmail||"").onChange(async s=>{this.plugin.settings.userEmail=s,await this.plugin.saveSettings()})}),e.createEl("h4",{text:c(this.plugin.settings.language,"settings.scheduledEmails.title")});let r=e.createEl("p",{text:c(this.plugin.settings.language,"settings.scheduledEmails.desc"),attr:{style:"color: var(--text-muted); font-size: 13px; margin-bottom: 15px;"}}),a=e.createEl("div",{attr:{style:`
            margin: 15px 0;
            padding: 15px;
            background: var(--background-secondary);
            border-radius: 8px;
            border: 1px solid var(--background-modifier-border);
          `}});this.renderScheduledEmails(a)}if(!t){e.createEl("h3",{text:c(this.plugin.settings.language,"settings.mobileSettings.title")}),e.createEl("h4",{text:c(this.plugin.settings.language,"settings.savedLocations.title")});let r=e.createEl("p",{text:c(this.plugin.settings.language,"settings.savedLocations.desc"),attr:{style:"color: var(--text-muted); font-size: 13px; margin-bottom: 15px;"}});new E.Setting(e).setName(c(this.plugin.settings.language,"settings.savedLocations.addTitle")).setDesc(c(this.plugin.settings.language,"settings.savedLocations.addDesc")).addButton(n=>{n.setButtonText(c(this.plugin.settings.language,"settings.savedLocations.addButton")).setCta().onClick(()=>{this.openLocationPicker()})});let a=e.createEl("div",{attr:{style:`
            margin: 15px 0;
            padding: 15px;
            background: var(--background-secondary);
            border-radius: 8px;
            border: 1px solid var(--background-modifier-border);
          `}});this.renderSavedLocations(a)}}renderSavedLocations(e){e.empty();let t=this.plugin.settings.savedLocations||[];if(t.length===0){e.createEl("p",{text:c(this.plugin.settings.language,"settings.savedLocations.empty"),attr:{style:"color: var(--text-muted); text-align: center; padding: 20px;"}});return}t.forEach((i,o)=>{let r=e.createEl("div",{attr:{style:`
            padding: 12px;
            margin: 8px 0;
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            background: var(--background-primary);
          `}}),a=r.createEl("div",{attr:{style:"flex: 1; min-width: 200px;"}});a.createEl("div",{text:i.name,attr:{style:"font-weight: 500; margin-bottom: 4px; font-size: 14px;"}}),i.address&&a.createEl("div",{text:i.address.length>60?i.address.substring(0,60)+"...":i.address,attr:{style:"font-size: 12px; color: var(--text-muted); margin-bottom: 4px; word-wrap: break-word;"}}),a.createEl("div",{text:`\u{1F4CD} ${i.latitude.toFixed(6)}, ${i.longitude.toFixed(6)}`,attr:{style:"font-size: 11px; color: var(--text-muted);"}});let n=r.createEl("div",{attr:{style:"display: flex; gap: 6px; flex-shrink: 0;"}});n.createEl("button",{text:c(this.plugin.settings.language,"settings.savedLocations.editButton"),attr:{style:"padding: 6px 12px; font-size: 12px; white-space: nowrap;"}}).addEventListener("click",()=>{this.editLocation(i,o)}),n.createEl("button",{text:"\u{1F5D1}\uFE0F",attr:{style:"padding: 6px 10px; font-size: 14px; color: var(--text-error);"}}).addEventListener("click",async()=>{await this.deleteLocation(o),this.display()})})}renderScheduledEmails(e){e.empty();let t=this.plugin.settings.scheduledEmails||[];if(t.length===0){e.createEl("p",{text:c(this.plugin.settings.language,"settings.scheduledEmails.empty"),attr:{style:"color: var(--text-muted); text-align: center; padding: 20px;"}});return}[...t].sort((o,r)=>new Date(o.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()).forEach((o,r)=>{let a=e.createEl("div",{attr:{style:`
            padding: 12px;
            margin: 8px 0;
            border: 1px solid var(--background-modifier-border);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
            background: var(--background-primary);
          `}}),n=a.createEl("div",{attr:{style:"flex: 1; min-width: 200px;"}});n.createEl("div",{text:o.title,attr:{style:"font-weight: 500; margin-bottom: 4px; font-size: 14px;"}}),o.message&&n.createEl("div",{text:o.message.length>60?o.message.substring(0,60)+"...":o.message,attr:{style:"font-size: 12px; color: var(--text-muted); margin-bottom: 4px; word-wrap: break-word;"}});let s=new Date(o.scheduledDate),u=new Date,d=s<u;n.createEl("div",{text:`\u{1F4C5} ${s.toLocaleString("es-ES",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})} ${d?c(this.plugin.settings.language,"settings.scheduledEmails.past"):""}`,attr:{style:`font-size: 11px; color: ${d?"var(--text-error)":"var(--text-muted)"};`}});let g=a.createEl("div",{attr:{style:"display: flex; gap: 6px; flex-shrink: 0;"}}).createEl("button",{text:c(this.plugin.settings.language,"settings.scheduledEmails.cancelButton"),attr:{style:"padding: 6px 12px; font-size: 12px; white-space: nowrap; color: var(--text-error);",id:`cancel-email-btn-${o.notificationId}`}});g.addEventListener("click",async()=>{let f=t.findIndex(h=>h.notificationId===o.notificationId);await this.cancelScheduledEmail(o,f,g)})})}async cancelScheduledEmail(e,t,i){let o=this.plugin.settings.notelertApiKey;if(!o){new E.Notice("\u274C Para cancelar emails, necesitas configurar una API key en Settings (o esperar a que se env\xEDe autom\xE1ticamente).");return}i&&this.showLoadingState(i);let r=new E.Notice("\u23F3 Cancelando email...",0);try{let a=await de(e.notificationId,o);r.hide(),i&&this.hideLoadingState(i),a.success?(this.plugin.settings.scheduledEmails.splice(t,1),await this.plugin.saveSettings(),this.display(),new E.Notice(c(this.plugin.settings.language,"settings.scheduledEmails.cancelSuccess"))):new E.Notice(`\u274C Error: ${a.error||c(this.plugin.settings.language,"settings.scheduledEmails.cancelError")}`)}catch(a){r.hide(),i&&this.hideLoadingState(i),new E.Notice(`\u274C Error: ${a instanceof Error?a.message:c(this.plugin.settings.language,"settings.scheduledEmails.cancelError")}`)}}showLoadingState(e){if(e.__originalText=e.textContent,e.disabled=!0,e.style.opacity="0.6",e.style.cursor="not-allowed",e.innerHTML=`
      <span style="display: inline-block; margin-right: 6px;">
        <svg width="14" height="14" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"/>
          <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" opacity="0.75"/>
        </svg>
      </span>
      ${c(this.plugin.settings.language,"settings.scheduledEmails.canceling")}
    `,!document.getElementById("notelert-spinner-style")){let t=document.createElement("style");t.id="notelert-spinner-style",t.textContent=`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `,document.head.appendChild(t)}}hideLoadingState(e){let t=e.__originalText||c(this.plugin.settings.language,"settings.scheduledEmails.cancelButton");e.textContent=t,e.disabled=!1,e.style.opacity="1",e.style.cursor="pointer"}openLocationPicker(){new U(this.app,this.plugin,this.plugin.settings.language,async t=>{this.plugin.settings.savedLocations||(this.plugin.settings.savedLocations=[]),this.plugin.settings.savedLocations.push(t),await this.plugin.saveSettings(),this.display()}).open()}editLocation(e,t){new U(this.app,this.plugin,this.plugin.settings.language,async o=>{this.plugin.settings.savedLocations[t]=o,await this.plugin.saveSettings(),this.display()},e).open()}async deleteLocation(e){this.plugin.settings.savedLocations.splice(e,1),await this.plugin.saveSettings()}};var w=B(require("obsidian"));var X=class extends w.Modal{constructor(e,t,i,o,r,a,n){super(e);this.notificationType="time";this.selectedLocation=null;this.plugin=t,this.language=i,this.editor=o,this.cursor=r,this.originalText=a,this.onCancel=n}onOpen(){let{contentEl:e}=this;e.empty();let t=!w.Platform.isMobile;e.setAttribute("style",`
      min-width: ${t?"400px":"300px"}; 
      max-width: ${t?"500px":"600px"}; 
      width: ${t?"auto":"95vw"};
      max-height: ${t?"auto":"90vh"}; 
      overflow: hidden;
      padding: ${t?"25px":"20px"};
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      margin: 0 auto;
    `);let i=e.createEl("div",{attr:{style:`
          flex: 1;
          overflow-y: ${t?"visible":"auto"};
          overflow-x: hidden;
          padding-right: ${t?"0":"5px"};
          margin-bottom: 10px;
        `}});i.createEl("h2",{text:c(this.language,"datePicker.title"),attr:{style:"margin: 0 0 15px 0; font-size: 18px; font-weight: 600;"}});let o=i.createEl("div",{cls:"notelert-datepicker-container"});o.setAttribute("style","margin: 0; width: 100%;"),t&&(this.notificationType="time");let r=o.createEl("div",{cls:"notelert-date-container"});r.setAttribute("style","margin-bottom: 15px;"),r.createEl("label",{text:c(this.language,"datePicker.dateLabel")}).setAttribute("style","display: block; margin-bottom: 5px; font-weight: 500;");let n=r.createEl("input",{type:"date",cls:"notelert-date-input"});n.setAttribute("style","width: 100%; padding: 10px; border: 1px solid var(--background-modifier-border); border-radius: 6px; box-sizing: border-box; font-size: 14px;");let s=o.createEl("div",{cls:"notelert-time-container"});s.setAttribute("style","margin-bottom: 20px;"),s.createEl("label",{text:c(this.language,"datePicker.timeLabel")}).setAttribute("style","display: block; margin-bottom: 10px; font-weight: 500;");let d=s.createEl("div",{attr:{style:`
          display: flex;
          align-items: center;
          justify-content: center;
          gap: ${t?"20px":"15px"};
          padding: ${t?"20px":"15px"};
          background: var(--background-secondary);
          border-radius: 8px;
          border: 1px solid var(--background-modifier-border);
        `}}),p=d.createEl("div",{attr:{style:`
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 8px;
        `}});p.createEl("div",{text:c(this.language,"datePicker.hours"),attr:{style:"font-size: 11px; color: var(--text-muted); text-transform: uppercase; font-weight: 500; letter-spacing: 0.5px;"}});let g=p.createEl("div",{text:"12",attr:{style:`
          font-size: ${t?"32px":"28px"};
          font-weight: 600;
          color: var(--text-normal);
          min-width: ${t?"60px":"50px"};
          text-align: center;
          padding: ${t?"10px 15px":"8px 12px"};
          background: var(--background-primary);
          border-radius: 6px;
          border: 2px solid var(--interactive-accent);
        `}});g.id="hours-display";let f=p.createEl("div",{attr:{style:`
          display: flex;
          gap: 8px;
          align-items: center;
        `}}),h=f.createEl("button",{text:"\u2212",attr:{style:`
          width: ${t?"36px":"32px"};
          height: ${t?"36px":"32px"};
          border-radius: 6px;
          border: 1px solid var(--background-modifier-border);
          background: var(--background-primary);
          font-size: ${t?"20px":"18px"};
          font-weight: 600;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        `}});h.addEventListener("mouseenter",()=>{h.style.background="var(--background-modifier-hover)",h.style.borderColor="var(--interactive-accent)"}),h.addEventListener("mouseleave",()=>{h.style.background="var(--background-primary)",h.style.borderColor="var(--background-modifier-border)"});let b=f.createEl("button",{text:"+",attr:{style:`
          width: ${t?"36px":"32px"};
          height: ${t?"36px":"32px"};
          border-radius: 6px;
          border: 1px solid var(--background-modifier-border);
          background: var(--background-primary);
          font-size: ${t?"20px":"18px"};
          font-weight: 600;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        `}});b.addEventListener("mouseenter",()=>{b.style.background="var(--background-modifier-hover)",b.style.borderColor="var(--interactive-accent)"}),b.addEventListener("mouseleave",()=>{b.style.background="var(--background-primary)",b.style.borderColor="var(--background-modifier-border)"}),d.createEl("div",{text:":",attr:{style:`
          font-size: ${t?"32px":"28px"};
          font-weight: 600;
          color: var(--text-normal);
          margin: 0 ${t?"10px":"5px"};
        `}});let P=d.createEl("div",{attr:{style:`
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 8px;
        `}});P.createEl("div",{text:c(this.language,"datePicker.minutes"),attr:{style:"font-size: 11px; color: var(--text-muted); text-transform: uppercase; font-weight: 500; letter-spacing: 0.5px;"}});let k=P.createEl("div",{text:"00",attr:{style:`
          font-size: ${t?"32px":"28px"};
          font-weight: 600;
          color: var(--text-normal);
          min-width: ${t?"60px":"50px"};
          text-align: center;
          padding: ${t?"10px 15px":"8px 12px"};
          background: var(--background-primary);
          border-radius: 6px;
          border: 2px solid var(--interactive-accent);
        `}});k.id="minutes-display";let ee=P.createEl("div",{attr:{style:`
          display: flex;
          gap: 8px;
          align-items: center;
        `}}),I=ee.createEl("button",{text:"\u2212",attr:{style:`
          width: ${t?"36px":"32px"};
          height: ${t?"36px":"32px"};
          border-radius: 6px;
          border: 1px solid var(--background-modifier-border);
          background: var(--background-primary);
          font-size: ${t?"20px":"18px"};
          font-weight: 600;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        `}});I.addEventListener("mouseenter",()=>{I.style.background="var(--background-modifier-hover)",I.style.borderColor="var(--interactive-accent)"}),I.addEventListener("mouseleave",()=>{I.style.background="var(--background-primary)",I.style.borderColor="var(--background-modifier-border)"});let D=ee.createEl("button",{text:"+",attr:{style:`
          width: ${t?"36px":"32px"};
          height: ${t?"36px":"32px"};
          border-radius: 6px;
          border: 1px solid var(--background-modifier-border);
          background: var(--background-primary);
          font-size: ${t?"20px":"18px"};
          font-weight: 600;
          cursor: pointer;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s;
        `}});D.addEventListener("mouseenter",()=>{D.style.background="var(--background-modifier-hover)",D.style.borderColor="var(--interactive-accent)"}),D.addEventListener("mouseleave",()=>{D.style.background="var(--background-primary)",D.style.borderColor="var(--background-modifier-border)"});let L=s.createEl("input",{type:"time",cls:"notelert-time-input"});if(L.setAttribute("style","display: none;"),L.id="hidden-time-input",t){let T=s.createEl("div",{attr:{style:`
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 15px;
            justify-content: center;
          `}});[{label:"9:00",hours:9,minutes:0},{label:"12:00",hours:12,minutes:0},{label:"15:00",hours:15,minutes:0},{label:"18:00",hours:18,minutes:0},{label:"21:00",hours:21,minutes:0}].forEach(v=>{let m=T.createEl("button",{text:v.label,attr:{style:`
              padding: 6px 12px;
              font-size: 12px;
              border-radius: 4px;
              border: 1px solid var(--background-modifier-border);
              background: var(--background-primary);
              cursor: pointer;
              transition: all 0.2s;
            `}});m.addEventListener("click",()=>{this.updateTimeDisplay(v.hours,v.minutes,g,k,L)}),m.addEventListener("mouseenter",()=>{m.style.background="var(--background-modifier-hover)",m.style.borderColor="var(--interactive-accent)"}),m.addEventListener("mouseleave",()=>{m.style.background="var(--background-primary)",m.style.borderColor="var(--background-modifier-border)"})})}let te=T=>{let y=parseInt(g.textContent||"12"),v=parseInt(k.textContent||"0"),m=y+T;m<0&&(m=23),m>23&&(m=0),this.updateTimeDisplay(m,v,g,k,L)},ae=T=>{let y=parseInt(g.textContent||"12"),m=parseInt(k.textContent||"0")+T,x=y;m<0?(m=59,x=x-1,x<0&&(x=23)):m>59&&(m=0,x=x+1,x>23&&(x=0)),this.updateTimeDisplay(x,m,g,k,L)};h.addEventListener("click",()=>te(-1)),b.addEventListener("click",()=>te(1)),I.addEventListener("click",()=>ae(-5)),D.addEventListener("click",()=>ae(5));let G=new Date;G.setHours(G.getHours()+1);let we=G.getHours(),Pe=Math.ceil(G.getMinutes()/5)*5;this.updateTimeDisplay(we,Pe,g,k,L);let j=o.createEl("div",{cls:"notelert-type-container"});j.setAttribute("style",`margin-bottom: 20px; padding: 15px; background: var(--background-secondary); border-radius: 6px; width: 100%; box-sizing: border-box; ${t?"display: none;":""}`);let Be=j.createEl("label",{text:c(this.language,"datePicker.notificationType"),attr:{style:"display: block; margin-bottom: 8px; font-weight: 500; font-size: 14px;"}}),K=j.createEl("div");K.setAttribute("style","display: flex; gap: 10px; flex-wrap: wrap; width: 100%;");let C=K.createEl("button",{text:"\u23F0 "+c(this.language,"datePicker.timeNotification"),cls:"mod-cta"});C.setAttribute("style","flex: 1; min-width: 120px; padding: 10px; font-size: 14px; white-space: nowrap;"),C.id="notification-type-time";let $=K.createEl("button",{text:"\u{1F4CD} "+c(this.language,"datePicker.locationNotification"),cls:"mod-secondary"});$.setAttribute("style","flex: 1; min-width: 120px; padding: 10px; font-size: 14px; white-space: nowrap;"),$.id="notification-type-location";let V=()=>{this.notificationType==="time"?(C.className="mod-cta",$.className="mod-secondary"):(C.className="mod-secondary",$.className="mod-cta")};C.addEventListener("click",()=>{this.notificationType="time",this.selectedLocation=null,V(),this.updateModalContent(o,n,L)}),$.addEventListener("click",()=>{this.notificationType="location",this.selectedLocation=null,V(),this.updateModalContent(o,n,L)}),V();let q=o.createEl("div",{cls:"notelert-quick-actions"});q.setAttribute("style","margin-bottom: 20px; width: 100%; box-sizing: border-box;"),q.id="quick-actions-container",q.createEl("p",{text:c(this.language,"datePicker.quickActions")}).setAttribute("style","margin-bottom: 10px; font-weight: 500;");let ie=q.createEl("div");ie.setAttribute("style","display: flex; gap: 8px; flex-wrap: wrap; width: 100%;"),[{label:c(this.language,"datePicker.today"),date:this.getToday(),time:"09:00"},{label:c(this.language,"datePicker.tomorrow"),date:this.getTomorrow(),time:"09:00"},{label:c(this.language,"datePicker.in1Hour"),date:this.getToday(),time:this.getTimeInHours(1)},{label:c(this.language,"datePicker.in2Hours"),date:this.getToday(),time:this.getTimeInHours(2)}].forEach(T=>{let y=ie.createEl("button",{text:T.label,cls:"mod-secondary"});y.setAttribute("style","padding: 4px 8px; font-size: 12px;"),y.addEventListener("click",()=>{n.value=T.date,L.value=T.time;let v=document.getElementById("hours-display"),m=document.getElementById("minutes-display");if(v&&m){let[x,N]=T.time.split(":").map(Number);this.updateTimeDisplay(x,N,v,m,L)}})});let J=e.createEl("div",{cls:"notelert-datepicker-buttons"});J.setAttribute("style",`
      display: flex; 
      gap: 10px; 
      justify-content: flex-end; 
      margin-top: 10px; 
      flex-wrap: wrap;
      flex-shrink: 0;
      padding-top: 10px;
      border-top: 1px solid var(--background-modifier-border);
      width: 100%;
      box-sizing: border-box;
    `);let oe=J.createEl("button",{text:c(this.language,"datePicker.cancelButton"),cls:"mod-secondary"});oe.setAttribute("style","flex: 1; min-width: 120px; padding: 12px 20px; font-size: 14px; box-sizing: border-box;"),oe.addEventListener("click",()=>{this.onCancel(),this.close()});let S=J.createEl("button",{text:c(this.language,"datePicker.confirmButton"),cls:"mod-cta"});S.setAttribute("style","flex: 1; min-width: 120px; padding: 12px 20px; font-size: 14px; box-sizing: border-box;"),S.id="datepicker-confirm-button",S.addEventListener("click",async()=>{this.showLoadingState(S);let T=y=>{let v=document.getElementById("datepicker-debug-info");if(v){let m=new Date().toLocaleTimeString(),x=v.innerHTML||"",N=y.includes("\u274C")||y.includes("Error")?"var(--text-error)":y.includes("\u2705")?"var(--text-success)":"var(--text-normal)";v.innerHTML=`${x}<div style="margin: 4px 0; padding: 4px 8px; font-size: 11px; color: ${N}; border-left: 3px solid ${N}; background: var(--background-secondary); border-radius: 3px; word-wrap: break-word; white-space: pre-wrap;"><span style="opacity: 0.7;">[${m}]</span> ${y}</div>`;let H=document.getElementById("datepicker-debug-container");H&&(H.scrollTop=H.scrollHeight)}};try{if(this.notificationType==="location"){if(!this.selectedLocation){this.hideLoadingState(S),new w.Notice(c(this.language,"datePicker.selectSavedLocation")||"Por favor, selecciona una ubicaci\xF3n");return}let y=await this.createNotificationFromLocation(this.selectedLocation);this.hideLoadingState(S),y&&this.close()}else{let y=n.value,v=L.value;if(y&&v){let m=`:@${y}, ${v}`,x=this.editor.getLine(this.cursor.line),N=x.substring(0,this.cursor.ch-2),H=x.substring(this.cursor.ch),re=N+m+H;this.editor.setLine(this.cursor.line,re);let Le={line:this.cursor.line,ch:N.length+m.length};this.editor.setCursor(Le);let Te=await this.createNotificationFromDatePicker(y,v,re);this.hideLoadingState(S),Te&&this.close()}else this.hideLoadingState(S),new w.Notice(c(this.language,"datePicker.selectDateTime"))}}catch(y){this.hideLoadingState(S),this.plugin.log(`Error en confirmaci\xF3n: ${y}`),new w.Notice(`\u274C Error: ${y instanceof Error?y.message:"Error desconocido"}`)}}),n.value=this.getToday(),L.value=this.getTimeInHours(1)}onClose(){let{contentEl:e}=this;e.empty()}getToday(){return new Date().toISOString().split("T")[0]}getTomorrow(){let e=new Date;return e.setDate(e.getDate()+1),e.toISOString().split("T")[0]}getTimeInHours(e){let t=new Date;return t.setHours(t.getHours()+e),t.toTimeString().slice(0,5)}updateTimeDisplay(e,t,i,o,r){e<0&&(e=0),e>23&&(e=23),t<0&&(t=0),t>59&&(t=59),i.textContent=String(e).padStart(2,"0"),o.textContent=String(t).padStart(2,"0");let a=`${String(e).padStart(2,"0")}:${String(t).padStart(2,"0")}`;r.value=a}async createNotificationFromDatePicker(e,t,i){try{let o=this.plugin.app.workspace.getActiveFile(),r=o?o.basename:"Nota",n=this.editor.getLine(this.cursor.line).replace(/:@[^,\s]+,\s*[^\s]+/g,"").trim(),s={text:i.trim(),title:r,message:n,date:e,time:t,fullMatch:`:@${e}, ${t}`,startIndex:0,endIndex:i.length,filePath:o?.path,lineNumber:this.cursor.line+1,type:"time"};return await this.plugin.createNotificationAndMarkProcessed(s),!0}catch(o){return this.plugin.log(`Error creando notificaci\xF3n desde date picker: ${o}`),new w.Notice(c(this.language,"notices.errorCreatingNotification",{title:"Recordatorio"})),!1}}extractTitleFromText(e,t){let i=e.replace(t,"").trim();return i=i.replace(/\s+/g," ").trim(),i.length>50&&(i=i.substring(0,47)+"..."),i||"Recordatorio"}updateModalContent(e,t,i){let o=e.querySelector(".notelert-date-container"),r=e.querySelector(".notelert-time-container"),a=e.querySelector("#quick-actions-container"),n=e.querySelector("#location-list-container");this.notificationType==="location"?(o&&(o.style.display="none"),r&&(r.style.display="none"),a&&(a.style.display="none"),n?n.style.display="block":this.renderLocationList(e)):(o&&(o.style.display="block"),r&&(r.style.display="block"),a&&(a.style.display="block"),n&&(n.style.display="none"))}renderLocationList(e){let t=e.querySelector("#location-list-container");t&&t.remove();let i=this.plugin.settings.savedLocations||[];if(i.length===0){let a=e.createEl("div",{attr:{style:`
            padding: 20px;
            text-align: center;
            color: var(--text-muted);
            background: var(--background-secondary);
            border-radius: 6px;
            margin: 15px 0;
          `}});a.id="location-list-container",a.textContent=c(this.language,"datePicker.noSavedLocations");return}let o=e.createEl("h3",{text:c(this.language,"datePicker.selectLocationTitle"),attr:{style:`
          margin: 15px 0 10px 0;
          font-size: 16px;
          font-weight: 600;
          color: var(--text-normal);
          flex-shrink: 0;
        `}}),r=e.createEl("div",{attr:{style:`
          height: 400px;
          max-height: 400px;
          overflow-y: auto;
          overflow-x: hidden;
          padding: 10px;
          margin: 10px 0;
          background: var(--background-primary);
          border: 2px solid var(--interactive-accent);
          border-radius: 8px;
          box-sizing: border-box;
          flex-shrink: 0;
        `}});r.id="location-list-container",i.forEach((a,n)=>{let s=r.createEl("div",{attr:{style:`
            padding: 12px 15px;
            margin: 8px 0;
            border: 2px solid var(--background-modifier-border);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--background-primary);
            width: 100%;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: space-between;
          `}});s.id=`location-item-${n}`;let u=a.name||`Ubicaci\xF3n ${n+1}`,d=s.createEl("div",{text:u,attr:{style:"font-weight: 500; font-size: 14px; flex: 1;"}}),p=s.createEl("div",{text:"\u2713",attr:{style:`
            font-size: 18px;
            color: var(--interactive-accent);
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.2s;
            margin-left: 10px;
          `}});p.id=`check-icon-${n}`,s.locationData=a,s.checkIcon=p;let g=()=>{i.forEach((f,h)=>{let b=document.getElementById(`location-item-${h}`),P=document.getElementById(`check-icon-${h}`);if(b&&P){let k=b.querySelector("div:first-child");b.style.background="var(--background-primary)",b.style.borderColor="var(--background-modifier-border)",k&&(k.style.color="var(--text-normal)"),P.style.opacity="0"}}),s.style.background="var(--interactive-accent)",s.style.borderColor="var(--interactive-accent)",d.style.color="var(--text-on-accent)",p.style.opacity="1",this.selectedLocation=a};s.addEventListener("click",g),s.addEventListener("mouseenter",()=>{this.selectedLocation!==a&&(s.style.background="var(--background-modifier-hover)",s.style.borderColor="var(--interactive-accent)")}),s.addEventListener("mouseleave",()=>{this.selectedLocation!==a&&(s.style.background="var(--background-primary)",s.style.borderColor="var(--background-modifier-border)")})})}async selectLocationFromSaved(){return new Promise(async e=>{try{let t=new w.Modal(this.app);t.titleEl.setText(c(this.language,"datePicker.selectSavedLocation"));let{contentEl:i}=t;i.empty(),i.setAttribute("style",`
          min-width: 300px; 
          max-width: 600px; 
          width: 95vw;
          max-height: 85vh; 
          overflow: hidden;
          padding: 20px;
          box-sizing: border-box;
          display: flex;
          flex-direction: column;
          margin: 0 auto;
        `);let o=t.modalEl;o&&(o.style.zIndex="10000",o.style.position="fixed");let r=i.createEl("div",{attr:{style:`
              margin-bottom: 15px;
              padding: 12px;
              background: var(--background-secondary);
              border: 2px solid var(--background-modifier-border);
              border-radius: 8px;
              font-size: 11px;
              height: 150px;
              min-height: 150px;
              max-height: 200px;
              overflow-y: auto;
              overflow-x: hidden;
              font-family: 'Courier New', monospace;
              box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
              flex-shrink: 0;
            `}});r.id="location-select-debug-container",r.innerHTML=`
          <div style="font-weight: 700; margin-bottom: 8px; color: var(--text-accent); font-size: 12px; border-bottom: 1px solid var(--background-modifier-border); padding-bottom: 6px;">
            \u{1F50D} Debug - Ubicaciones Guardadas
          </div>
          <div id="location-select-debug-info" style="color: var(--text-normal); line-height: 1.6; word-wrap: break-word; min-height: 100px;"></div>
        `;let a=d=>{let p=document.getElementById("location-select-debug-info");if(p){let g=new Date().toLocaleTimeString(),f=p.innerHTML||"",h=d.includes("\u274C")||d.includes("Error")?"var(--text-error)":d.includes("\u2705")?"var(--text-success)":"var(--text-normal)";p.innerHTML=`${f}<div style="margin: 4px 0; padding: 4px 8px; font-size: 11px; color: ${h}; border-left: 3px solid ${h}; background: var(--background-secondary); border-radius: 3px; word-wrap: break-word; white-space: pre-wrap;"><span style="opacity: 0.7;">[${g}]</span> ${d}</div>`;let b=document.getElementById("location-select-debug-container");b&&(b.scrollTop=b.scrollHeight)}};a("\u{1F50D} Iniciando b\xFAsqueda de ubicaciones guardadas..."),a("\u{1F4E5} Recargando settings..."),this.plugin.loadSettings?(await this.plugin.loadSettings(),a("\u2705 Settings recargados")):a("\u26A0\uFE0F loadSettings no disponible, usando settings actuales");let n=this.plugin.settings.savedLocations||[];if(a(`\u{1F4CA} Ubicaciones encontradas: ${n.length}`),a(`\u{1F4CB} Settings object: ${JSON.stringify(this.plugin.settings).substring(0,200)}...`),n.length>0?n.forEach((d,p)=>{a(`\u{1F4CD} [${p+1}] ${d.name||"Sin nombre"} - Lat: ${d.latitude}, Lon: ${d.longitude}`)}):(a("\u274C No se encontraron ubicaciones en savedLocations"),a(`\u{1F50D} Tipo de savedLocations: ${typeof this.plugin.settings.savedLocations}`),a(`\u{1F50D} savedLocations es null/undefined: ${this.plugin.settings.savedLocations===null||this.plugin.settings.savedLocations===void 0}`)),n.length===0){a("\u26A0\uFE0F No hay ubicaciones para mostrar"),new w.Notice(c(this.language,"datePicker.noSavedLocations")),t.open();return}let s=i.createEl("h3",{text:"Selecciona una ubicaci\xF3n:",attr:{style:`
            margin: 15px 0 10px 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--text-normal);
            flex-shrink: 0;
            display: block !important;
            visibility: visible !important;
          `}}),u=i.createEl("div",{attr:{style:`
            flex: 1;
            min-height: 250px;
            max-height: 450px;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 15px;
            margin: 10px 0;
            background: var(--background-primary);
            border: 3px solid var(--interactive-accent);
            border-radius: 8px;
            box-sizing: border-box;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative;
            z-index: 100;
          `}});u.id="location-list-container",a("\u{1F3A8} Creando elementos de la lista..."),a("\u{1F4E6} Contenedor creado con ID: location-list-container"),a(`\u{1F4CF} Altura del contenedor: ${u.offsetHeight}px`),n.forEach((d,p)=>{a(`\u{1F4DD} Creando item ${p+1}: ${d.name||"Sin nombre"}`);let g=u.createEl("div",{attr:{style:`
              padding: 15px;
              margin: 10px 0;
              border: 2px solid var(--interactive-accent);
              border-radius: 6px;
              cursor: pointer;
              transition: all 0.2s;
              background: var(--background-primary);
              width: 100%;
              box-sizing: border-box;
              display: block !important;
              visibility: visible !important;
              opacity: 1 !important;
              position: relative;
              z-index: 10;
            `}});g.id=`location-item-${p}`,g.addEventListener("mouseenter",()=>{g.style.background="var(--background-modifier-hover)"}),g.addEventListener("mouseleave",()=>{g.style.background="var(--background-primary)"});let f=d.name||`Ubicaci\xF3n ${p+1}`;g.createEl("div",{text:f,attr:{style:"font-weight: 500; margin-bottom: 4px; font-size: 14px;"}}),d.address&&g.createEl("div",{text:d.address.length>60?d.address.substring(0,60)+"...":d.address,attr:{style:"font-size: 12px; color: var(--text-muted); margin-bottom: 4px; word-wrap: break-word;"}}),g.createEl("div",{text:`\u{1F4CD} ${d.latitude?.toFixed(6)||"0"}, ${d.longitude?.toFixed(6)||"0"}`,attr:{style:"font-size: 11px; color: var(--text-muted);"}}),g.addEventListener("click",()=>{a(`\u2705 Ubicaci\xF3n seleccionada: ${d.name}`),t.close(),e(d)}),a(`\u2705 Item ${p+1} creado con ID: location-item-${p}`)}),a(`\u2705 Lista creada con ${n.length} ubicaciones`),a(`\u{1F4CF} Altura final del contenedor: ${u.offsetHeight}px`),a(`\u{1F441}\uFE0F Elementos hijos del contenedor: ${u.children.length}`),setTimeout(()=>{let d=document.getElementById("location-list-container");d&&(a("\u{1F50D} Verificando contenedor despu\xE9s de renderizado..."),a(`  - display: ${window.getComputedStyle(d).display}`),a(`  - visibility: ${window.getComputedStyle(d).visibility}`),a(`  - opacity: ${window.getComputedStyle(d).opacity}`),a(`  - height: ${window.getComputedStyle(d).height}`),a(`  - overflow: ${window.getComputedStyle(d).overflow}`))},100),t.open()}catch(t){this.plugin.log(`Error cargando settings: ${t}`),new w.Notice("Error cargando ubicaciones guardadas"),e(null)}})}async createNotificationFromLocation(e){try{let t=`:#${e.name}`,i=this.editor.getLine(this.cursor.line),o=i.substring(0,this.cursor.ch-2),r=i.substring(this.cursor.ch),a=o+t+r;this.editor.setLine(this.cursor.line,a);let n={line:this.cursor.line,ch:o.length+t.length};this.editor.setCursor(n);let s=this.plugin.app.workspace.getActiveFile(),u=s?s.basename:"Nota",p=this.editor.getLine(this.cursor.line).replace(/:#[^\s]+/g,"").trim(),g={text:a.trim(),title:u,message:p,date:new Date().toISOString().split("T")[0],time:"00:00",fullMatch:t,startIndex:0,endIndex:a.length,filePath:s?.path,lineNumber:this.cursor.line+1,location:e.name,latitude:e.latitude,longitude:e.longitude,radius:e.radius,type:"location"};return await this.plugin.createNotificationAndMarkProcessed(g),this.plugin.log(`Notificaci\xF3n de ubicaci\xF3n creada: ${g.title} en ${e.name}`),!0}catch(t){return this.plugin.log(`Error creando notificaci\xF3n de ubicaci\xF3n: ${t}`),new w.Notice(c(this.language,"notices.errorCreatingNotification",{title:"Recordatorio de ubicaci\xF3n"})),!1}}showLoadingState(e){if(e.__originalText=e.textContent,e.disabled=!0,e.style.opacity="0.6",e.style.cursor="not-allowed",e.innerHTML=`
      <span style="display: inline-block; margin-right: 8px;">
        <svg width="16" height="16" viewBox="0 0 24 24" style="animation: spin 1s linear infinite;">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none" opacity="0.25"/>
          <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" opacity="0.75"/>
        </svg>
      </span>
      ${c(this.language,"datePicker.confirmButton")||"Confirmando..."}
    `,!document.getElementById("notelert-spinner-style")){let t=document.createElement("style");t.id="notelert-spinner-style",t.textContent=`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `,document.head.appendChild(t)}}hideLoadingState(e){let t=e.__originalText||c(this.language,"datePicker.confirmButton")||"Confirmar";e.textContent=t,e.disabled=!1,e.style.opacity="1",e.style.cursor="pointer"}addVisualFeedback(e,t){try{let i=t.match(/:@([^,]+),\s*([^\s]+)/);if(i){let o=i[1],r=i[2],a=`\u23F0${o}, ${r}`,n=`==${a}==`,s=e.replace(t,n);this.editor.setLine(this.cursor.line,s),this.plugin.log(`Feedback visual a\xF1adido: solo ${a} resaltado`)}}catch(i){this.plugin.log(`Error a\xF1adiendo feedback visual: ${i}`)}}};function xe(l,e,t){if(!t.settings.enableDatePicker||!t.settings.useNewSyntax)return;let i=l.getCursor(),r=l.getLine(i.line).substring(0,i.ch);if(r.endsWith(":@")){t.log("Detectado :@ - abriendo date picker"),ve(l,i,t);return}r.endsWith(":#")&&(t.log("Detectado :# - abriendo date picker"),ve(l,i,t))}function ve(l,e,t){let o=l.getLine(e.line);new X(t.app,t,t.settings.language,l,e,o,()=>{t.log("Date picker cancelado")}).open()}var M=B(require("obsidian"));function Ee(l,e){let t=encodeURIComponent(l.title),i=l.message;i=i.replace(/:@[^,\s]+,\s*[^\s]+/g,""),i=i.replace(/:#[^\s]+/g,""),i=i.trim().replace(/\s+/g," ");let o=encodeURIComponent(i),r=l.date,a=l.time,n=l.type||(l.location?"location":"time"),s="";l.location&&(s=`&location=${encodeURIComponent(l.location)}`,l.latitude!==void 0&&l.longitude!==void 0&&(s+=`&latitude=${l.latitude}&longitude=${l.longitude}`),l.radius!==void 0&&(s+=`&radius=${l.radius}`));let u="";if(l.filePath&&l.lineNumber){let d=`obsidian://open?vault=${encodeURIComponent(e.vault.getName())}&file=${encodeURIComponent(l.filePath)}&line=${l.lineNumber}`;u=`&returnLink=${encodeURIComponent(d)}`}return`notelert://add?title=${t}&message=${o}&date=${r}&time=${a}&type=${n}${s}${u}`}async function Y(l,e,t,i,o){try{if(!M.Platform.isMobile){if(!t.pluginToken||t.pluginToken.trim()===""){new M.Notice(`\u{1F511} Token del plugin requerido

Para usar emails premium desde el plugin, necesitas:
1. Tener plan Premium activo
2. Generar tu token en la app m\xF3vil (Settings > Token del Plugin)
3. Pegar el token en Settings > Notelert > Plugin Token`);return}if(!t.userEmail){new M.Notice(c(t.language,"notices.desktopConfigRequired")||"\u274C Configura tu email en Settings para usar Notelert en desktop");return}if(l.type==="location"){new M.Notice(c(t.language,"notices.locationNotSupportedDesktop")||"\u274C Las notificaciones de ubicaci\xF3n solo est\xE1n disponibles en m\xF3vil");return}let a=`${l.date}T${l.time}:00`,n=new Date(a);if(isNaN(n.getTime())){new M.Notice(`\u274C Fecha inv\xE1lida: ${a}`),i(`Error: Fecha inv\xE1lida - ${a}`);return}let s=l.message;s=s.replace(/:@[^,\s]+,\s*[^\s]+/g,""),s=s.replace(/:#[^\s]+/g,""),s=s.trim().replace(/\s+/g," ");let u=pe();i("Programando email para desktop:"),i(`  - T\xEDtulo: ${l.title}`),i(`  - Mensaje: ${s}`),i(`  - Email: ${t.userEmail}`),i(`  - Fecha: ${n.toISOString()}`),i(`  - Notification ID: ${u}`);let d=new M.Notice("\u23F3 Programando email...",0),p=await ue(t.userEmail,l.title,s,n,u,t.pluginToken);if(d.hide(),p.success&&p.notificationId){let g={notificationId:p.notificationId,title:l.title,message:s,scheduledDate:n.toISOString(),createdAt:new Date().toISOString()};o&&o(g),new M.Notice(c(t.language,"notices.emailScheduled")||"\u2705 Email programado correctamente"),i(`Email programado: ${p.notificationId}`)}else{let g=p.error||"Error al programar email";throw new M.Notice(`\u274C ${g}`),i(`Error programando email: ${g}`),new Error(g)}}else{let a=Ee(l,e);i(`Ejecutando deeplink: ${a}`),typeof window!="undefined"&&(window.location.href=a)}}catch(r){throw r?.message&&r.message.includes("Error al programar email")||(i(`Error creando notificaci\xF3n: ${r}`),new M.Notice(c(t.language,"notices.errorCreatingNotification",{title:l.title}))),r}}var Z=class extends ke.Plugin{async onload(){console.log("Cargando plugin Notelert..."),await this.loadSettings(),this.addSettingTab(new W(this.app,this)),this.addStatusBarItem().setText("Notelert: Activo"),this.settings.enableDatePicker&&this.registerEvent(this.app.workspace.on("editor-change",(e,t)=>{xe(e,t,this)})),console.log("Plugin Notelert cargado correctamente")}onunload(){console.log("Descargando plugin Notelert...")}async loadSettings(){this.settings=Object.assign({},ce,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async createNotificationInternal(e){await Y(e,this.app,this.settings,t=>this.log(t),async t=>{this.settings.scheduledEmails||(this.settings.scheduledEmails=[]),this.settings.scheduledEmails.push(t),await this.saveSettings()})}async createNotificationAndMarkProcessed(e){try{return await this.createNotificationInternal(e),!0}catch(t){return this.log(`Error procesando notificaci\xF3n confirmada: ${t}`),!1}}log(e){this.settings.debugMode&&console.log(`[Notelert] ${e}`)}},He=Z;
